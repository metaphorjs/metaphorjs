(function(){function B(l){return"function"==typeof l}function w(l){return"string"===typeof l||l===""+l}function I(l){return"object"===typeof l&&5===ha(l)}function J(){}function X(l){if(l&&void 0!=!l.length&&l!==""+l){for(var g=[],c=-1,a=l.length>>>0;++c!==a;g[c]=l[c]);return g}return l?[l]:[]}function ia(l){return"object"==typeof l&&3===ha(l)&&!l.nodeType&&l.constructor===Object}function sa(l){return!0===l||!1===l}function q(){var l=!1,g=!1,c=X(arguments),a=c.shift(),b,d,e;sa(c[c.length-1])&&(l=c.pop());
sa(c[c.length-1])&&(g=l,l=c.pop());for(;c.length;)if(b=c.shift())for(d in b)if(b.hasOwnProperty(d)&&void 0!==(e=b[d]))if(g)if(a[d]&&ia(a[d])&&ia(e))q(a[d],e,l,g);else{if(!0===l||void 0==a[d])ia(e)?(a[d]={},q(a[d],e,l,!0)):a[d]=e}else if(!0===l||void 0==a[d])a[d]=e;return a}function rb(l){return"undefined"===typeof window?!1:l===window||l&&l.document&&l.location&&l.alert&&l.setInterval}function Ra(l,g){if(l===g)return!0;if(null===l||null===g)return!1;if(l!==l&&g!==g)return!0;var c=typeof l,a;if(c===
typeof g&&"object"===c)if(I(l)){if(!I(g))return!1;if((c=l.length)===g.length){for(a=0;a<c;a++)if(!Ra(l[a],g[a]))return!1;return!0}}else{if(10===ha(l))return 10===ha(g)&&l.getTime()===g.getTime();if(9===ha(l)&&9===ha(g))return l.toString()===g.toString();if(rb(l)||rb(g)||I(g))return!1;c={};for(a in l)if("$"!==a.charAt(0)&&!B(l[a])){if(!Ra(l[a],g[a]))return!1;c[a]=!0}for(a in g)if(!c.hasOwnProperty(a)&&"$"!==a.charAt(0)&&void 0!==g[a]&&!B(g[a]))return!1;return!0}return!1}function Ca(l,g){if("undefined"!=
typeof window&&l===window)throw Error("Cannot copy window object");if("undefined"!=typeof global&&l===global)throw Error("Cannot copy global object");if(g){if(l===g)throw Error("Objects are identical");if(I(l))for(var c=g.length=0,a=l.length;c<a;c++)g.push(Ca(l[c]));else{for(c in g)delete g[c];for(c in l)l.hasOwnProperty(c)&&("$"==c.charAt(0)||B(l[c])?g[c]=l[c]:g[c]=Ca(l[c]))}}else(g=l)&&(I(l)?g=Ca(l,[]):10===ha(l)?g=new Date(l.getTime()):9===ha(l)?g=new RegExp(l.source):ia(l)&&(g=Ca(l,{})));return g}
function V(l,g,c,a){return setTimeout(function(){l.apply(g,c||[])},a||0)}function La(l){if(null===l||"object"!=typeof l)return!1;l=ha(l);return 2<l||-1==l}function sb(l,g){var c=function(){};c.prototype=l.prototype;c=new c;l=l.apply(c,g);return La(l)||!1===l?l:c}function Nb(l,g,c,a,b,d){b=b||"before";return function(){if("instead"==b)return g.apply(c||a,arguments);if("before"==b){var e=g.apply(c||a,arguments);var f=!1!==e?l.apply(a||c,arguments):null}else f=l.apply(a||c,arguments),e=g.apply(c||a,
arguments);return d?e:f}}function Ob(l){return!l||"string"===typeof l&&(l=l.toLowerCase(),"false"===l||"no"===l||"0"===l)?!1:!0}function Ma(){return!1}function Sa(){return!0}function Y(l){if(!l)return!1;var g;if("object"!=(g=typeof l)&&"function"!=g)return!1;l=l.then;return B(l)?l:!1}function Ta(l){var g=Da.global(),c="regex_"+l;return g.get(c)||g.add(c,new RegExp(l))}function ab(l){return l.replace(/-./g,function(g){return g.charAt(1).toUpperCase()})}function tb(l,g){if(!l||!w(l))return null;try{var c=
new DOMParser;var a=c.parseFromString(l,g||"text/xml")}catch(b){T(b),a=void 0}if(!a||a.getElementsByTagName("parsererror").length)throw Error("Invalid XML: "+l);return a}function bb(l){l=ha(l);return 3>l&&-1<l}function ub(l,g,c){c||(c="asc");l=l.slice();if(ia(g)&&g.fn){var a=g.fn;var b=g.context}l.sort(function(d,e){if(a)return a.call(b,d,e);var c=typeof d,k=d,h=e;if(c!=typeof e)return 0;"object"===c&&(B(g)?(k=g(d),h=g(e)):(k=d[g],h=e[g]));if("number"===typeof k)return k-h;k=(""+k).toLowerCase();
h=(""+h).toLowerCase();return k===h?0:k>h?1:-1});return"desc"==c?l.reverse():l}function ra(l){return l.substr(0,1).toUpperCase()+l.substr(1)}var vb={templates:{"a*b":"<p>a * b = {{--814}}</p>","a+b":"<p>a + b = {{--817}}</p>",app1:'<h1>MetaphorJs Feature test</h1><div class="cases"><div class="case"><h4>Bindings (read only)</h4><label class="case-label">Inline</label><div id="inline-binding" class="test">{{--823}}</div><label class="case-label">mjs-bind</label><div id="binding" {bind}="--81G" class="test"></div><label class="case-label">mjs-bind-html</label><div id="html-binding" {bind-html}="--81J" class="test"></div><label class="case-label">Plain attribute (href)</label><p class="test"><a id="attr-binding-href" [href]="http://{{--823}}.com">{{--81G}}</a></p></div><div class="case"><h4>Bindings (read only)</h4><label class="case-label">Input field (value)</label><p class="test"><input id="binding-input-value" type="text" [value]="this.a"></p><label class="case-label">Input field (mjs-bind) (locked)</label><p class="test"><input id="binding-input-bind" type="text" {bind}="--81V" {bind.$locked}></p><label class="case-label">Checkbox (mjs-bind)</label><p class="test"><input id="binding-checkbox" type="checkbox" {bind}="--81Z"></p><label class="case-label">Radio (mjs-bind) (locked)</label><p class="test"><input id="radio-bind-1" checked="checked" type="radio" value="inline1" name="radio-bind" {bind}="--823" {bind.$locked}> <input id="radio-bind-2" type="radio" value="inline2" name="radio-bind"> <input id="radio-bind-3" type="radio" value="inline3" name="radio-bind"></p></div><div class="case"><h4>Bindings (read only)</h4><label class="case-label">Select (mjs-bind)</label><p class="test"><select id="select-bind" {bind}="--81V"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></p><label class="case-label">Textarea (mjs-bind)</label><p class="test"><textarea id="textarea-bind-attr" {bind}="--823"></textarea></p><label class="case-label">Textarea (inline)</label><p class="test"><textarea id="textarea-bind-inline">{{--823}}</textarea></p></div><div class="case"><h4>Muplitple inline binding</h4><div id="multiple-inline-binding" class="test">{{--823}}<b>{{--81G}}</b>{{--81J}}</div></div><div class="case"><h4>Filters</h4><label class="case-label">Uppercase (mjs-bind)</label><div id="filter-uppercase-binding" class="test" {bind}="this.text | uppercase"></div><label class="case-label">Uppercase (inline)</label><div id="filter-uppercase-inline" class="test">{{this.text | uppercase}}</div><label class="case-label">Lowercase (inline)</label><div id="filter-lowercase-inline" class="test">{{this.text | lowercase}}</div><label class="case-label">Limit to (string)</label><div id="filter-limit-string" class="test">{{this.text | limitTo:this.a}}</div></div><div class="case"><h4>Filters</h4><label class="case-label">Linkify</label><p id="filter-linkify" class="test" {bind-html}="this.linkified | linkify"></p></div><div class="case"><h4>Expressions</h4><label class="case-label">.a + .b</label><div id="expr-a-plus-b" class="test">{{--88F}}</div><label class="case-label">.bool ? "true" : "false"</label><div id="expr-bool" class="test">{{--88G}}</div></div><div class="case"><h4>Model</h4><label class="case-label">Input (number) (.a)</label><p class="test"><input {model}="this.a" type="number" data-type="number" id="model-input-a"></p><label class="case-label">Checkbox (.bool)</label><p class="test"><input id="model-checkbox-bool" type="checkbox" {model}="this.bool"></p><label class="case-label">Radio (.inline)</label><p class="test"><input id="model-radio-1" checked="checked" type="radio" name="r" value="inline1" {model}="this.inline">1<label><input id="model-radio-2" type="radio" name="r" value="inline2">2</label><input id="model-radio-3" type="radio" name="r" value="inline3">3</p><label class="case-label">Select (.a)</label><p class="test"><select id="model-select-a" {model}="this.a" data-type="number"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></p></div><div class="case"><h4>Model</h4><label class="case-label">Textarea (.text)</label><p class="test"><textarea id="model-textarea" {model}="this.text"></textarea></p><label class="case-label">Input (string .text)</label><p class="test"><input type="text" id="model-input" {model}="this.text"></p></div><div class="case"><h4>mjs-class</h4><label class="case-label">Plain attribute</label><div class="test"><p id="class-inline" [class]="this.inline">---</p></div><label class="case-label">mjs-class (string)</label><div class="test"><p id="class-string" {class}="--823">---</p></div><label class="case-label">mjs-class ({bool: .bool, inline1: .a == 0})</label><div class="test"><p id="class-object" {class}="--84D">---</p></div></div><div class="case"><h4>mjs-if, mjs-show, mjs-hide</h4><div id="if-bool" {if}="--81Z" class="test" {if.$animate}>this should appear if .bool = true</div><div id="show-bool" {show}="--81Z" class="test" {show.$animate}>this should show if .bool = true</div><div id="hide-bool" {hide}="--81Z" class="test" {hide.$animate}>this should hide if .bool = true</div></div><div class="case"><h4>mjs-include</h4><label class="case-label">immediate</label><div {include}="test-template" {include.$animate}><p>transcluded text</p></div><label class="case-label">immediate (via tag)</label><mjs-include src="test-template"><p>transcluded text</p></mjs-include><label class="case-label">ajax</label><div {include}="template.html"><p>Transcluded text</p></div></div><div class="case"><h4>mjs-validate</h4><form name="myForm" {validate} {class.error}="--84X" {class.$animate}><div><input name="field1" data-validate-required {class}="--850"></div><div {class}="--852"><label><input type="radio" name="radio1" value="1" data-validate-required> -- 1</label><label><input type="radio" name="radio1" value="2"> -- 2</label><label><input type="radio" name="radio1" value="3"> -- 3</label></div><div><input type="submit" value="Submit"> <input type="reset" value="Reset"></div></form></div><div class="case" {init}="--85D"><h4>dynamic list</h4><label><input id="radio-sep-1" type="radio" name="sep" value="/\\n|,/" {model}="this.sep"> /\\n|,/</label><label><input type="radio" name="sep" value="/\\n/"> /\\n/</label><label><input type="radio" name="sep" value=","> ,</label><br><br><textarea {model}="split:this.sep >> this.dynamicList" {model.$binding}="input"></textarea><ul><li {each}="item in this.dynamicList" {bind}="--85Q" {bind.$recursive}></li></ul></div><div class="case"><h4>mjs-options</h4><label class="case-label">Generated from .alist</label><p class="test"><select {bind}="--81V" {options}="this.alist"><option>not selected</option></select></p><label class="case-label">Generated from .dynamicList</label><p class="test"><select {options}="{\n                        name: this.item,\n                        value: this.$index,\n                        group: this.$index - (this.$index % 2),\n                        disabledGroup: this.$index == 0,\n                        disabled: this.$index == 4\n                        } in this.dynamicList"><option>default value</option></select></p></div><div class="case" {cmp}="Test.TplComponent" id="tplComponentTest"><h2>{{--88H}}</h2>mjs-include change template:<br><a href="#" (click)="--865">a + b</a>|<a href="#" (click)="--867">a * b</a><div {include}="--869" {include.$animate} id="tplComponetInc"></div></div><div class="case" {cmp}="Test.StringTemplate"></div><div class="case" {cmp}="Test.ChangeTemplate">mjs-cmp change template:<br><a href="#" (click)="--86E">tpl1</a>|<a href="#" (click)="--86G">tpl2</a></div><div class="case"><h4>Router</h4><div {router}="Test.MyView" {router.$animate}></div>pushUrl:<a href="/1">/1</a>|<a href="/2">/2</a>|<a href="/3">/3</a>|<a href="http://www.kuindji.com">outside</a><br><br></div><div class="case" {ignore}>This element is ignored by renderer: {{--88I}}</div><div class="case" {router} {router.$cmp}="--86S" {router.$default-cmp}:="Test.ViewComponent1"><p>change cmp:<a href="#" (click)="--86V">Cmp1</a>|<a href="#" (click)="--86X">Cmp2</a></p></div></div><div class="cases"><div class="case double" {init}="--870"><h4>mjs-each (attr)</h4><input {model}="this.newItem" (key.enter)="--873"> <input type="button" {disabled}="--875" (click)="--876" value="Add item"><ul {show}="--81Z" {show.$animate}><li {each}="item in this.list | filter:this.listFilter | sortBy:\'txt\':this.sortBy" {each.$animate} {each.$animate-move}><label {class}="--87A"><input type="checkbox" {model}="this.item.bool"> {{--88J}} - {{--88K}} - {{--88L}} - {{--88M}} - {{--88N}} - {{--88O}}</label><a href="#" (click)="--87D">x</a></li></ul><input {model}="this.listFilter" placeholder="Search"><a href="#" (click)="--87G">asc</a><a href="#" (click)="--87I">desc</a></div><div class="case double"><h4>mjs-each (tag)</h4><mjs-each value="item in this.list | filter:this.listFilter | sortBy:\'txt\':this.sortBy"><div><label {class}="--87A"><input type="checkbox" {model}="this.item.bool"> {{--88J}} - {{--88K}} - {{--88L}} - {{--88M}} - {{--88N}} - {{--88O}}</label><a href="#" (click)="--87D">x</a></div></mjs-each></div><div class="case" id="newComponent">Dynamically created component on existing element will go here</div><div class="case" id="renderToComponent">Dynamically created component with renderTo will go here</div><div class="case double" {cmp}="Test.MyComponent" {cmp.$as}="ctrl"><p {cmp-prop}="para">Component\'s transcluded text + {{--88I}}</p><a href="#" (click)="--87V">reverse</a>|<a href="#" (click)="--87X">create new component on existing element</a>|<a href="#" (click)="--87Z">create new component and render to</a>|<a href="#" (click)="--881">create new dialog</a><br><br><button (click)="--885">Load store</button><button (click)="--887">Clear store</button><ul><li {each}="item in this.store" {each.$animate}>{{--88P}}</li></ul></div><div class="case double" id="myComponent1" {cmp}="Test.MyComponent"><p>This is another instance with deferred value: {{--88Q}}</p></div><div class="case double"><tagc $as:="ctrl" $test:="Value from config"></tagc></div></div>',
app2:'<div class="case"><h4>app\'s resolved value</h4><p class="test">{{--89I}}</p></div><div class="case"><h4>recursive rendering</h4><p><a href="#" (click)="--88Y">Change level 2</a></p><p class="test">This is level 1:<span {bind}="--891" {bind.$recursive}></span></p></div><div class="case"><h4>lang substitution</h4><label class="case-label">using normal expression with filter: \'key\' | l</label><p class="test">{{\'key\' | l}}</p><p class="test" {bind}="\'subkey1\' | l" {bind.$recursive}></p></div><div class="case"><h4>pluralization</h4><p><a href="#" (click)="--89B">Increase B</a></p><label class="case-label">using normal expression:</label><p class="test">{{--89J}} {{\'plr\' | p:this.b}}</p><p><input type="number" data-type="number" {model}="this.people"></p><p class="test" {bind}="\'viewing\' | p:this.people" {bind.$recursive}></p></div>',
"cmp1-template":"<h2>{{--88H}}</h2><div {transclude}></div>",dirs:'<div class="form_select" (click)="--89O" {class.loading}="--89P" {class.disabled}="--89Q" {class.search}="--89R" {class.multiple}="--89S" {class.black}="--89T"><input type="hidden" #el_hidden_field [name]="this.field.hiddenInputName" [value]="this.field.$$selection | join:\',\'"><i #el_icon_down (click)="--89W">\x3c!-- include icons/down.html --\x3e</i><a class="form_select__label" {each}="item in this.field.getMultiSelection()" style="display: inline-block !important;">{{--8AZ}}<i class="delete icon" (click)="--89Z"></i></a><input type="text" #el_search class="search" [disabled]="this.field.disabled" {show}="--89R" {show.$display}="inline-block" (focus)="--8A1" (blur)="--8A2" (key.backspace)="--8A3" {model}="this.searchQuery"><span class="sizer" #el_sizer {if}="--8A5" {bind}="--8A6"></span><div class="default text" #el_default_text (click)="--8A8" {show}="--8A9" {show.$display}="inline-block" {show.$save-state}="--8AA" {bind}="--8AB"></div><div class="text" #el_text (click)="--8A8" {class.default}="--8AD" {show}="--8AE" {show.$save-state}="--8AF" {show.$display}="inline-block" {bind}="--8AG"></div>\x3c!-- replaces two previous text blocks with invisible placeholder --\x3e<div style="display: none" class="default text" {show}="--8AI" {show.$display}="inline-block">&nbsp;</div><select class="form-select_hidden-select" #el_hidden_select (click)="--8AK" (change)="--8AL" {show}="--8AM" {show.$display}="block" {options}="this.field._getSelectOptions()"></select><div class="form-select-menu" #el_menu {class.black}="--89T"><div class="items" #el_menu_items><div class="disabled item" #el_menu_disabled {if}="--8AQ" (click)="--8AR" {bind-html}="--8AS"></div><div class="empty item" #el_menu_empty style="color: #999;" {if}="--8AU" (click)="--8AV" {bind-html}="--8AW"></div><div class="item" {each}="item in this.field.store" (click)="--8AY" {bind}="--8AZ"></div></div><div class="pagination_container" {cmp}="Pagination" {cmp.$autoscroll}="false" {show}="--8B1" (click)="--8B2"></div></div></div>',
tagc:'<div class="component"><p>This is a tag component.</p><p>{{--8B8}}</p></div>',"test-template":"<p>{{--8BC}}</p><div {transclude}></div>"},templateOptions:{dirs:{includes:!0}},expressionOpts:{814:"r",817:"r","86V":"p","86X":"p","87D":"p","88I":"r","89Z":"p","8AY":"p","8AZ":"p","8B2":"p","8BC":"r"},funcs:{814:function(l,g){try{return l.$root.a*l.$root.b}catch(c){}},817:function(l,g){try{return l.$root.a+l.$root.b}catch(c){}},823:function(l,g){try{return l.inline}catch(c){}},850:function(l,g){try{return{error:l.myForm.field1.$invalid}}catch(c){}},
852:function(l,g){try{return{error:l.myForm.radio1.$invalid}}catch(c){}},865:function(l,g){try{l.tpl="a+b"}catch(c){}},867:function(l,g){try{l.tpl="a*b"}catch(c){}},869:function(l,g){try{return l.tpl}catch(c){}},870:function(l,g){try{l.newItem="",l.listFilter="",l.sortBy="asc"}catch(c){}},873:function(l,g){try{l.newItem&&(l.list.push({bool:!1,txt:l.newItem}),l.newItem="")}catch(c){}},875:function(l,g){try{return!l.newItem}catch(c){}},876:function(l,g){try{l.list.push({bool:!1,txt:l.newItem}),l.newItem=
""}catch(c){}},881:function(l,g){try{l.ctrl.createDialog()}catch(c){}},885:function(l,g){try{l.store.load()}catch(c){}},887:function(l,g){try{l.store.clear()}catch(c){}},891:function(l,g){try{return l.level1}catch(c){}},"81G":function(l,g){try{return l.text}catch(c){}},"81J":function(l,g){try{return l.html}catch(c){}},"81V":function(l,g){try{return l.a}catch(c){}},"81Z":function(l,g){try{return l.bool}catch(c){}},"84D":function(l,g){try{return{bool:l.bool,inline1:0==l.a}}catch(c){}},"84X":function(l,
g){try{return l.myForm.$invalid}catch(c){}},"85D":function(l,g){try{l.dynamicList=[]}catch(c){}},"85Q":function(l,g){try{return l.item}catch(c){}},"86E":function(l,g){try{l.tpl=l.tpl1}catch(c){}},"86G":function(l,g){try{l.tpl=l.tpl2}catch(c){}},"86S":function(l,g){try{return l.viewCmp}catch(c){}},"86V":function(l,g){try{l.$parent.viewCmp="Test.ViewComponent1"}catch(c){}},"86X":function(l,g){try{l.$parent.viewCmp="Test.ViewComponent2"}catch(c){}},"87A":function(l,g){try{return{cls3:l.item.bool}}catch(c){}},
"87D":function(l,g){try{l.$parent.list.splice(l.$getRawIndex(l.$trackId),1)}catch(c){}},"87G":function(l,g){try{l.sortBy="asc"}catch(c){}},"87I":function(l,g){try{l.sortBy="desc"}catch(c){}},"87V":function(l,g){try{l.ctrl.reverse()}catch(c){}},"87X":function(l,g){try{l.ctrl.createNew()}catch(c){}},"87Z":function(l,g){try{l.ctrl.createRender()}catch(c){}},"88F":function(l,g){try{return l.a+l.b}catch(c){}},"88G":function(l,g){try{return l.bool?"true":"false"}catch(c){}},"88H":function(l,g){try{return l.title}catch(c){}},
"88I":function(l,g){try{return l.$root.a}catch(c){}},"88J":function(l,g){try{return l.$index}catch(c){}},"88K":function(l,g){try{return l.item.txt}catch(c){}},"88L":function(l,g){try{return l.$first?"first":""}catch(c){}},"88M":function(l,g){try{return l.$last?"last":""}catch(c){}},"88N":function(l,g){try{return l.$even?"even":""}catch(c){}},"88O":function(l,g){try{return l.$odd?"odd":""}catch(c){}},"88P":function(l,g){try{return l.item.name}catch(c){}},"88Q":function(l,g){try{return l.deferred}catch(c){}},
"88Y":function(l,g){try{l.changeLevel2()}catch(c){}},"89B":function(l,g){try{l.increaseB()}catch(c){}},"89I":function(l,g){try{return l.resolved}catch(c){}},"89J":function(l,g){try{return l.b}catch(c){}},"89O":function(l,g){try{l.field.onSelfClick(l.$event)}catch(c){}},"89P":function(l,g){try{return l.loading}catch(c){}},"89Q":function(l,g){try{return l.field.disabled}catch(c){}},"89R":function(l,g){try{return l.field.searchable}catch(c){}},"89S":function(l,g){try{return l.field.multiple}catch(c){}},
"89T":function(l,g){try{return l.field.black}catch(c){}},"89W":function(l,g){try{l.field.onDropdownIconClick(l.$event)}catch(c){}},"89Z":function(l,g){try{l.$parent.field.onItemDeleteClick(l.item,l.$event)}catch(c){}},"8A1":function(l,g){try{l.field.onSearchFocus(l.$event)}catch(c){}},"8A2":function(l,g){try{l.field.onSearchBlur(l.$event)}catch(c){}},"8A3":function(l,g){try{l.field.onSearchBackspace(l.$event)}catch(c){}},"8A5":function(l,g){try{return l.field.multiple&&l.field.searchable}catch(c){}},
"8A6":function(l,g){try{return l.searchQuery}catch(c){}},"8A8":function(l,g){try{l.field.onValueTextClick(l.$event)}catch(c){}},"8A9":function(l,g){try{return!l.searchQuery&&!l.field.hasSelection()&&!!l.field.emptyText}catch(c){}},"8AA":function(l,g){try{return l.emptyShown}catch(c){}},"8AB":function(l,g){try{return l.field.emptyText}catch(c){}},"8AD":function(l,g){try{return l.focused&&""==l.searchQuery}catch(c){}},"8AE":function(l,g){try{return!l.searchQuery&&!l.field.multiple&&l.field.hasSelection()}catch(c){}},
"8AF":function(l,g){try{return l.selectedShown}catch(c){}},"8AG":function(l,g){try{return l.field.getSelectedName()}catch(c){}},"8AI":function(l,g){try{return!l.emptyShown&&!l.selectedShown&&!l.field.searchable}catch(c){}},"8AK":function(l,g){try{l.field.onHiddenSelectClick(l.$event)}catch(c){}},"8AL":function(l,g){try{l.field.onHiddenSelectChange(l.$event)}catch(c){}},"8AM":function(l,g){try{return l.field.useHiddenSelect}catch(c){}},"8AQ":function(l,g){try{return l.field.showNotFound&&l.field.store.isEmpty()}catch(c){}},
"8AR":function(l,g){try{l.field.onNotFoundClick(null,l.$event)}catch(c){}},"8AS":function(l,g){try{return l.field.notFoundText}catch(c){}},"8AU":function(l,g){try{return l.field.showEmptyItem&&!l.field.store.isEmpty()}catch(c){}},"8AV":function(l,g){try{l.field.onItemClick(null,l.$event)}catch(c){}},"8AW":function(l,g){try{return l.field.emptyItemText}catch(c){}},"8AY":function(l,g){try{l.$parent.field.onItemClick(l.item,l.$event)}catch(c){}},"8AZ":function(l,g){try{return l.$parent.field.getItemName(l.item)}catch(c){}},
"8B1":function(l,g){try{return l.pagination.hasPages()}catch(c){}},"8B2":function(l,g){try{l.$parent.field.onPaginationClick(l.$event)}catch(c){}},"8B8":function(l,g){try{return l.ctrl.config.get("test")}catch(c){}},"8BC":function(l,g){try{return l.$root.text}catch(c){}}}},n={plugin:{},mixin:{},lib:{},dom:{},regexp:{},browser:{},app:{},prebuilt:"undefined"!==typeof vb?vb:null},T=function(){var l=[],g=function(c){var a;var b=0;for(a=l.length;b<a;b++)l[b][0].call(l[b][1],c)};g.on=function(c,a){g.un(c,
a);l.push([c,a])};g.un=function(c,a){var b;var d=0;for(b=l.length;d<b;d++)if(l[d][0]===c&&l[d][1]===a){l.splice(d,1);break}};return g}(),Pb=Object.prototype.toString,ha=function(){var l={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(g){if(!g){if(null===g)return 6;if(void 0===g)return 7}var c=l[Pb.call(g)];return void 0===c?-1:1===c&&isNaN(g)?8:c}}(),Ea=function(l,g,c){var a=
l.length,b=g.length,d=0,e=0,f=!1,k=!1,h=[];if(!b)return[l];for(;d<a;d++){var m=l.charAt(d);if("\\"==m)d++;else if('"'==m)f=!f;else if("'"==m)k=!k;else if(!f&&!k&&(1==b&&m==g||1<b&&l.substring(d,d+b)==g)){if(l.substr(d-1,b)!=g&&l.substr(d+1,b)!=g||c)h.push(l.substring(e,d).replace("\\"+g,g)),e=d+b;d+=b-1}}h.push(l.substring(e).replace("\\"+g,g));return h};n.filter=n.filter||{};var F=n.lib.Expression=function(){var l=/((^|[^a-z0-9_$\]\)'"])|(this))(\.)([^0-9])/ig,g={},c={},a=[],b=n.prebuilt?n.prebuilt.funcs:
{},d=function(a){return e(a)?(a=a.substring(2),b[a]||null):null},e=function(a){return"string"===typeof a&&"--"===a.substring(0,2)},f=function(a){return!a.trim().match(/[^a-zA-Z0-9_$'"\(\)\[\]\.;]/)},k=function(a){if(!w(a))return{value:a};var b=a.substr(0,1),e=a.length-1;if('"'===b||"'"===b){if(a.indexOf(b,1)===e)return{value:a.substring(1,e)}}else{if("true"===a||"false"===a)return{value:"true"===a};if((b=parseFloat(a))==a)return{value:b}}return!1},h=function(a,b){b=b||{};"string"===typeof b&&"setter"===
b&&(b={setter:!0});var e=!0===b.asCode,d=!0===b.setter,c=!0===b.noReturn,h;if(h=k(a)){var m=a+"_static";if(g[m])return g[m];if(d)throw Error("Static value cannot work as setter");return b.asCode?"".concat("function() {","return ",a,"}"):g[m]=function(){return h.value}}try{var p=f(a);m=a+"_"+(d?"setter":c?"func":"getter");if(!p&&d)throw Error("Complex expression cannot work as setter");if(!g[m]||e){var r=a.replace(l,"$2____.$5"),H=p&&d?"".concat("try {",r," = $$$$",";} catch (thrownError) { return undefined; }"):
"".concat("try {",c?"":"return ",r,";} catch (thrownError) { return undefined; }");if(e)return"function(____, $$$$) {"+H+"}";g[m]=new Function("____","$$$$",H)}return g[m]}catch(Z){return T(Error("Error parsing expression: "+a+"; \n\n\n"+H)),T(Z),J}},m=function(b,e,d){var c=e?">>":"|";if(-1===b.indexOf(c))return b;b=Ea(b,c);e=e?b.pop():b.shift();c=[];var f;var h=0;for(f=b.length;h<f;h++){var m=Ea(b[h].trim(),":");var p=d;var g=m.shift();var l=B(g)?g:null,H=[],u=[],v=l?null:g.substr(0,1),A={neg:!1,
dblneg:!1,undeterm:!1,name:g};l?A.name=l.name:("!!"===g.substr(0,2)?(g=g.substr(2),A.dblneg=!0):"!"===v?(g=g.substr(1),A.neg=!0):"?"===v&&(g=g.substr(1),A.undeterm=!0),A.name=g);if(!l)b:{l=g;if(p)if(I(p))p.concat(a);else if(p.hasOwnProperty(l)){l=p[l];break b}g=a.length;for(p=0;p<g;p++)if(a[p]&&a[p].hasOwnProperty(l)){l=a[p][l];break b}l=null}if(B(l)){g=-1;for(p=m.length;++g<p;H.push(r(m[g])))k(m[g])||u.push(m[g]);l.$undeterministic&&(A.undeterm=!0);m={fn:l,origArgs:m,params:H,expressions:u,opt:A}}else m=
null;m&&c.push(m)}return{expr:e.trim(),pipes:c}},p=function(a,b){b=b||{};var e=-1!==a.indexOf("|"),d=-1!==a.indexOf(">>");a={fn:null,getterFn:null,setterFn:null,expr:a,pipes:[],inputPipes:[]};if(!e&&!d)return a.fn=r(a.expr,b),a;e&&(e=m(a.expr,!1,b.filters),a.expr=e.expr,a.pipes=e.pipes);d&&(e=m(a.expr,!0,b.filters),a.expr=e.expr,a.inputPipes=e.pipes,b.setter=!0);a.fn=r(a.expr,b);d?(b.setter=!1,a.getterFn=r(a.expr,b),a.setterFn=a.fn):a.getterFn=a.fn;return a},H=function(a,b,e){var d,c=b.length,f;for(d=
0;d<c;d++){var h=b[d];var k=[];var m=-1;for(f=h.params.length;++m<f;k.push(h.params[m](e)));k.unshift(e);k.unshift(a);a=h.fn.apply(e,k);h.opt.neg?a=!a:h.opt.dblneg&&(a=!!a)}return a},u=function(a,b){b=b||{};return 0===a.pipes.length&&0===a.inputPipes.length?b.setterOnly?(a.setterFn||(a.setterFn=r(a.expr,{setter:!0})),a.setterFn):a.fn:function(e,d){if(a.inputPipes.length&&!b.getterOnly){var c=H(d,a.inputPipes,e);a.setterFn||(a.setterFn=r(a.expr,{setter:!0}));a.setterFn(e,c)}a.pipes&&!b.setterOnly&&
(b.getterOnly?c=a.getterFn(e):a.inputPipes.length||(c=a.fn(e)),c=H(c,a.pipes,e));return c}},r,v,A,E,t=function(a,b){return E(A(a,b),b)},x=function(){v=t;A=p;E=u;r=h};"undefined"!==typeof window&&a.push(window);n.filter&&a.push(n.filter);x();return{setExpressionFn:function(a){r=a},getExpressionFn:function(){return r},setDeconstructorFn:function(a){A=a},getDeconstructorFn:function(){return A},setConstructorFn:function(a){E=a},getConstructorFn:function(){return E},setParserFn:function(a){v=a},getParserFn:function(){return v},
addFilterSource:function(b){a.push(b)},reset:x,expression:function(a,b){return d(a)||r(a,b)},deconstruct:function(a,b){return A(a,b)},construct:function(a,b){return E(a,b)},parse:function(a,b){return v(a,b)},func:function(a,b){b=b||{};b.noReturn=!0;b.getterOnly=!0;return d(a)||v(a,b)},setter:function(a,b){b=b||{};b.setter=!0;b.setterOnly=!0;return d(a)||v(a,b)},getter:function(a,b){b=b||{};b.setter=!1;b.getterOnly=!0;return d(a)||v(a,b)},run:function(a,b,c,f){e(a)?d(a)(b):(f=f||{},f.noReturn=!0,v(a,
f)(b,c))},get:function(a,b,c,f){if(e(a))return d(a)(b);f=f||{};f.getterOnly=!0;return v(a,f)(b,c)},set:function(a,b,e,d){d=d||{};d.setter=!0;d.setterOnly=!0;return v(a,d)(b,e)},isStatic:k,isAtom:f,isProperty:function(a){return(a=a.match(/^this\.([a-zA-Z0-9_$]+)$/))?a[1]:!1},isPrebuiltKey:e,expressionHasPipes:function(a){return 1<Ea(a,"|").length||1<Ea(a,">>").length},describeExpression:function(a){if(!a||"string"!==typeof a)return"";if(e(a))return a=a.substring(2),n.prebuilt.expressionOpts[a]||"";
if(c[a])return c[a];var b=(-1!==a.indexOf("$parent")?"p":"")+(-1!==a.indexOf("$root")?"r":"")+(1<Ea(a,"|").length?"o":"")+(1<Ea(a,">>").length?"i":"");return c[a]=b},clearCache:function(){g={}}}}(),W=function(){var l=["0","0","0"];return function(){for(var g=l.length,c;g;){g--;c=l[g].charCodeAt(0);if(57==c)return l[g]="A",l.join("");if(90==c)l[g]="0";else return l[g]=String.fromCharCode(c+1),l.join("")}l.unshift("0");return l.join("")}}(),wb=n.lib.ObservableEvent=function(){var l=function(g,c){this.name=
g;this.listeners=[];this.map={};this.hash=W();this.uni="$$"+g+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===typeof c&&null!==c?q(this,c,!0,!1):this.returnResult=c};q(l.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},$destroy:function(){for(var g in this)this[g]=null},on:function(g,c,a){if(!g)return null;
c=c||null;a=a||{};var b=this.uni,d=g[b]||++this.lid,e=b+"_"+d,f=a.first||!1;if(g[b]&&(!c||c[e])&&!a.allowDupes)return null;g[b]||(g[b]=d);c&&!c[e]&&(c[e]=!0);g={fn:g,context:c,id:d,async:!1,called:0,limit:0,start:1,count:0,append:null,prepend:null};q(g,a,!0,!1);!0===g.async&&(g.async=1);f?this.listeners.unshift(g):this.listeners.push(g);this.map[d]=g;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var k=this.triggerFilter;this.triggerFilter=function(a){return a.id===d?k?!1!==k(a):!0:!1};this.trigger.apply(this,
this.lastTrigger);this.triggerFilter=k}return d},once:function(g,c,a){a=a||{};a.limit=1;return this.on(g,c,a)},un:function(g,c){var a=-1,b=this.uni,d=this.listeners;var e=g==parseInt(g)?parseInt(g):g[b];if(!e)return!1;var f=b+"_"+e;c=c||null;for(var k=0,h=d.length;k<h;k++)if(d[k].id===e&&d[k].context===c){a=k;delete g[b];c&&delete c[f];break}if(-1===a)return!1;d.splice(a,1);delete this.map[e];return!0},hasListener:function(g,c){var a=this.listeners;if(g){g=B(g)?g[this.uni]:parseInt(g);if(!g)return!1;
for(var b=this.uni+"_"+g,d=0,e=a.length;d<e;d++)if(a[d].id===g&&(!c||c[b]))return!0;return!1}return 0<a.length},removeAllListeners:function(){var g=this.listeners,c=this.uni,a;var b=0;for(a=g.length;b<a;b++){var d=c+"_"+g[b].fn[c];delete g[b].fn[c];g[b].context&&delete g[b].context[d]}this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(g,c){if(g.append||g.prepend)c=c.slice(),g.prepend&&(c=g.prepend.concat(c)),g.append&&(c=
c.concat(g.append));return c},trigger:function(){var g=this,c=g.listeners,a=g.returnResult,b=g.triggerFilter,d=g.filterContext,e=g.expectPromises,f=g.keepPromiseOrder,k=[],h=X(arguments),m;if(g.suspended)return null;g.autoTrigger&&(g.lastTrigger=h.slice());if(0===c.length)return null;var p="all"===a||"concat"===a?[]:"merge"===a?{}:null,l;var u="first"===a?[c[0]]:c.slice();for(e&&"last"===a&&(f=!0);l=u.shift();)if(!(!l||!g.map[l.id]||(c=g._prepareArgs(l,h),b&&!1===b.call(d,l,c,g))||l.filter&&!1===
l.filter.apply(l.filterContext||l.context,c)||(l.count++,l.count<l.start))){if(l.async&&!e){var r=null;V(l.fn,l.context,c,l.async)}else e?(r=function(a,b,e){return function(d){"pipe"===b&&(e[0]=d,e=g._prepareArgs(a,e));return a.fn.apply(a.context,e)}}(l,a,h.slice()),r=m?m.then(r):l.fn.apply(l.context,c),r.catch(T)):r=l.fn.apply(l.context,c);l.called++;l.called===l.limit&&g.un(l.id);if("first"===a)return r;if(e)k.push(r),("pipe"===a||f)&&r&&(m=r);else if(null!==a)if("all"===a)p.push(r);else if("concat"===
a&&r)p=p.concat(r);else if("merge"===a)q(p,r,!0,!1);else{if("nonempty"===a&&r)return r;if("pipe"===a)p=r,h[0]=r;else if("last"===a)p=r;else{if(!1===a&&!1===r)return!1;if(!0===a&&!0===r)return!0}}}if(e){if("pipe"===a)return m;b=Promise.all(k);g.resolvePromises&&null!==a&&"all"!==a&&(b=b.then(function(b){var e,d=b.length;for(e=0;e<d;e++){var c=b[e];if("concat"===a&&c)p=p.concat(c);else if("merge"===a)q(p,c,!0,!1);else{if("nonempty"===a&&c)return c;if("last"===a)p=c;else{if(!1===a&&!1===c)return!1;if(!0===
a&&!0===c)return!0}}}return p}));return b}return p}},!0,!1);return l}(),la=n.lib.Observable=function(){var l=function(){this.events={}};q(l.prototype,{createEvent:function(g,c){g=g.toLowerCase();var a=this.events;a[g]||(a[g]=new wb(g,c));return a[g]},getEvent:function(g){g=g.toLowerCase();return this.events[g]},on:function(g,c,a,b){g=g.toLowerCase();var d=this.events;d[g]||(d[g]=new wb(g));return d[g].on(c,a,b)},once:function(g,c,a,b){b=b||{};b.limit=1;return this.on(g,c,a,b)},un:function(g,c,a){g=
g.toLowerCase();var b=this.events;b[g]&&b[g].un(c,a)},relayEvent:function(g,c){g.on(c,this.trigger,this,{prepend:"*"===c?null:[c]})},unrelayEvent:function(g,c){g.un(c,this.trigger,this)},hasListener:function(g,c,a){var b=this.events;if(g)return g=g.toLowerCase(),b[g]?b[g].hasListener(c,a):!1;for(g in b)if(b[g].hasListener())return!0;return!1},hasEvent:function(g){return!!this.events[g]},removeAllListeners:function(g){var c=this.events;if(g)c[g]&&c[g].removeAllListeners();else for(g in c)c[g].removeAllListeners()},
trigger:function(){var g=arguments[0],c=this.events,a=null;g=g.toLowerCase();if(c[g]){var b=c[g];a=b.trigger.apply(b,X(arguments).slice(1))}(b=c["*"])&&b.trigger.apply(b,arguments);return a},suspendEvent:function(g){g=g.toLowerCase();var c=this.events;c[g]&&c[g].suspend()},suspendAllEvents:function(){var g=this.events,c;for(c in g)g[c].suspend()},resumeEvent:function(g){g=g.toLowerCase();var c=this.events;c[g]&&c[g].resume()},resumeAllEvents:function(){var g=this.events,c;for(c in g)g[c].resume()},
destroyEvent:function(g){var c=this.events;c[g]&&(c[g].removeAllListeners(),c[g].$destroy(),delete c[g])},$destroy:function(){var g=this.events,c;for(c in g)this.destroyEvent(c);for(c in this)this[c]=null},getApi:function(){if(!this.api){for(var g="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent relayEvent unrelayEvent".split(" "),c={},a,b=-1,d=g.length;++b<d;a=g[b],c[a]=this[a].bind(this));this.api=c}return this.api}},
!0,!1);return l}(),ja=n.lib.MutationObserver=function(){var l=new la,g=function(){var a,b=0;for(a in this)this.hasOwnProperty(a)&&"$checkAll"!==a&&this[a].check()&&b++;return b},c=function(a,b,d,e,c){var f=W(),h="expr";c=c||{};if(d)l.on(f,d,e,{allowDupes:!0});this.id=f;this.origExpr=b;this.staticValue=this.propertyName=null;this.dataObj=a;this.exprStruct=this.getterFn=this.setterFn=this.rawInput=this.prevValue=this.currentValue=null;this.sub=[];F.isPrebuiltKey(b)?this.getterFn=F.getter(b):B(b)?this.getterFn=
b:(d=F.isStatic(b))?(h="static",this.staticValue=d.value,this.getterFn=this._staticGetter.bind(this)):a&&(d=b,a.hasOwnProperty(d)||(d=F.isProperty(b))&&a.hasOwnProperty(d))&&(h="attr",this.propertyName=d,this.getterFn=this._propertyGetter.bind(this));this.getterFn||"expr"!==h||(c.filters?I(c.filters)?c.filters.push(a):c.filters=[c.filters]:c.filters=a,this.exprStruct=d=F.deconstruct(b,{filters:c.filters}),this.getterFn=F.construct(d,{getterOnly:!0}),(d.inputPipes.length||c.setter)&&this._initSetter());
a&&(a.$$mo||(a.$$mo={$checkAll:g}),a.$$mo[b]||(a.$$mo[b]=this));this.currentValue=this._getValue();this.currentValueCopy=Ca(this.currentValue);this.type=h};q(c.prototype,{_propertyGetter:function(){return this.dataObj[this.propertyName]},_propertySetter:function(a,b){this.dataObj[this.propertyName]=b},_staticGetter:function(){return this.staticValue},check:function(){var a=this.currentValueCopy,b=this._getValue();return Ra(b,a)?!1:(this.prevValue=a,this.currentValue=b,this.currentValueCopy=Ca(b),
l.trigger(this.id,this.currentValue,this.prevValue),!0)},_initSetter:function(){var a=this.exprStruct;if("attr"===this.type)this.setterFn=this._propertySetter.bind(this);else{if(!a)throw Error("Unable to make setter out of "+this.expr);this.setterFn=F.construct(a,{setterOnly:!0});var b,d;var e=0;for(b=a.inputPipes.length;e<b;e++){var c=a.inputPipes[e];var k=0;for(d=c.expressions.length;k<d;k++)this.sub.push(n.lib.MutationObserver.get(this.dataObj,c.expressions[k],this._onSubChange,this))}}},_getValue:function(){return this.getterFn(this.dataObj)},
_onSubChange:function(){this.setValue(this.rawInput)},getValue:function(){return this.currentValue},getCopy:function(){return this.currentValueCopy},setValue:function(a){this.rawInput=a;this.setterFn||this._initSetter();this.setterFn(this.dataObj,a)},getPrevValue:function(){return this.prevValue},subscribe:function(a,b,d){d=d||{};d.allowDupes=!0;l.on(this.id,a,b,d);return this},unsubscribe:function(a,b){l.un(this.id,a,b);return this},hasInputPipes:function(){return this.exprStruct&&0<this.exprStruct.inputPipes.length},
hasOutputPipes:function(){return this.exprStruct&&0<this.exprStruct.pipes.length},$destroy:function(a){var b;if(a&&l.hasListener(this.id))return!1;a=0;for(b=this.sub.length;a<b;a++){var d=this.sub[a];d.unsubscribe(this._onSubChange,this);d.$destroy(!0)}l.destroyEvent(this.id);this.dataObj&&this.dataObj.$$mo&&this.dataObj.$$mo[this.origExpr]===this&&delete this.dataObj.$$mo[this.origExpr];for(var e in this)this.hasOwnProperty(e)&&(this[e]=null);return!0}});c.check=function(a,b){if(b){a=c.exists(a,
b);if(!a)throw Error("MutationObserver not found for expression: "+b);return a.check()}return a.$$mo?a.$$mo.$checkAll():!1};c.get=function(a,b,d,e,f){b=b.trim();var k=c.exists(a,b);return k?(d&&k.subscribe(d,e),k):new c(a,b,d,e,f)};c.exists=function(a,b){b=b.trim();return a&&a.$$mo&&a.$$mo[b]?a.$$mo[b]:!1};c.$destroy=function(a,b,d){var e,c=!0;if(a&&a.$$mo){for(e in a.$$mo)!a.$$mo.hasOwnProperty(e)||b&&e!==b||"$"===e[0]||(a.$$mo[e].$destroy(d)?delete a.$$mo[e]:c=!1);c&&delete a.$$mo}};return c}(),
cb=n.dom.commentWrap=function(l,g){g=g||"";var c=window.document.createComment(g+" - start");g=window.document.createComment(g+" - end");var a=l.parentNode;a.insertBefore(c,l);l.nextSibling?a.insertBefore(g,l.nextSibling):a.appendChild(g);return[c,g]},Da=n.lib.Cache=function(){var l,g=function(c){var a={},b=[];0==arguments.length&&(c=!0);return{addFinder:function(a,e,c){b[c?"unshift":"push"]({fn:a,context:e})},add:function(b,e,f){if(a[b]&&!1===a[b].rewritable)return a[b];a[b]={rewritable:"undefined"!=
typeof f?f:c,value:e};return e},get:function(d,e){if(!a[d]){if(b.length){var c;var k=0;for(c=b.length;k<c;k++){var h=b[k].fn.call(b[k].context,d,this);if(void 0!==h)return this.add(d,h,!0)}}return void 0!==e?this.add(d,e):void 0}return a[d].value},remove:function(b){var e=a[b];e&&!0===e.rewritable&&delete a[b];return e?e.value:void 0},exists:function(b){return!!a[b]},eachEntry:function(b,e){for(var d in a)b.call(e,a[d].value,d)},clear:function(){a={}},$destroy:function(){this===l&&(l=null);this.remove=
this.exists=this.destroy=this.get=this.add=c=a=null}}};g.global=function(){l||(l=new g(!0));return l};return g}(),db=n.lib.Namespace=function(l){l=l||{};var g=new Da(!1),c=function(a,b){var d=g.get(a);if(void 0!==d||b)return d;b=a.split(".");var e=b.length,c=l;for(d=0;d<e;d++){var k=b[d];if(void 0===c[k])return;c=c[k]}c&&g.add(a,c);return c};this.register=function(a,b){var d=a.split("."),e=d.pop();var c=d.join(".");var k=d.length,h=l;if(g[c])a=[g[c],e,a];else{if(0<k)for(c=0;c<k;c++){var m=d[c];void 0===
h[m]&&(h[m]={});h=h[m]}a=[h,e,a]}d=a[0];e=a[1];La(d)&&void 0===d[e]&&(d[e]=b,g.add(a[2],b));return b};this.exists=function(a){return void 0!==c(na,!0)};this.get=c;this.add=function(a,b){return g.add(a,b)};this.remove=function(a){return g.remove(a)};this.makeAlias=function(a,b){a=g.get(a);void 0!==a&&g.add(b,a);return a};this.$destroy=function(){var a;g.eachEntry(function(a){a&&a.$destroy&&a.$destroy()});g.$destroy();g=null;for(a in this)this[a]=null}},Rb=function(){var l=function(){this.$super&&this.$super!==
J&&this.$super.apply(this,arguments)},g=function(a,d,e){var $super=a.prototype[d]||("$constructor"===d?a:J)||J;return function(){var a=this.$super;if(this.$destroyed)return this.$super=null;this.$super=$super;var b=e.apply(this,arguments);this.$super=a;return b}},c=function(a,d,e,c){var b,h=e.prototype;for(b in d)if(d.hasOwnProperty(b)){var f=h[b];var p=d[b];a[b]=!B(p)||f&&!B(f)?p:g(e,b,p)}c||(a.$plugins=null,a.$pluginMap=null,h.$beforeInit?(a.$beforeInit=h.$beforeInit.slice(),a.$afterInit=h.$afterInit.slice(),
a.$beforeDestroy=h.$beforeDestroy.slice(),a.$afterDestroy=h.$afterDestroy.slice()):(a.$beforeInit=[],a.$afterInit=[],a.$beforeDestroy=[],a.$afterDestroy=[]))},a=function(b){b||(b=new db);var d=function(a){return function(){var e=[],d=[],c=arguments,h,f;if(!this)throw Error("Must instantiate via new: "+a);this.$plugins=[];(h=this.$constructor.apply(this,arguments))&&I(h)&&(c=h);var k=this.$plugins;var g=this.$pluginMap={};h=-1;for(f=this.$beforeInit.length;++h<f;e.push([this.$beforeInit[h],this]));
h=-1;for(f=this.$afterInit.length;++h<f;d.push([this.$afterInit[h],this]));if(k&&k.length)for(h=0,f=k.length;h<f;h++){var l=k[h];if(w(l)){var n=l;l=b?b.get(l,!0):null;if(!l)throw n+" not found";}l=new l(this,c);g[l.$class]=l;l.$beforeHostInit&&e.push([l.$beforeHostInit,l]);l.$afterHostInit&&d.push([l.$afterHostInit,l]);k[h]=l}h=-1;for(f=e.length;++h<f;e[h][0].apply(e[h][1],c));this.$init&&this.$init.apply(this,c);h=-1;for(f=d.length;++h<f;d[h][0].apply(d[h][1],c));}},e=function(){};q(e.prototype,
{$class:null,$extends:null,$plugins:null,$pluginMap:null,$mixins:null,$destroyed:!1,$destroying:!1,$constructor:J,$init:J,$beforeInit:[],$afterInit:[],$beforeDestroy:[],$afterDestroy:[],$getClass:function(){return this.$class},$is:function(a){return k(this,a)},$getParentClass:function(){return this.$extends},$intercept:function(a,b,e,d,c){var h=this[a];this[a]=Nb(h||J,b,e||this,this,d,c);return h||J},$implement:function(a){var b=this.constructor;b&&b.$parent&&c(this,a,b.$parent,!0)},$hasPlugin:function(a){return a?
!!this.$pluginMap[a]:!1},$getPlugin:function(a){return a?this.$pluginMap[a]||null:null},$bind:function(a){var b=this;return function(){if(!b.$isDestroyed())return a.apply(b,arguments)}},$isDestroyed:function(){return self.$destroying||self.$destroyed},$destroy:function(){var a=this.$beforeDestroy,b=this.$afterDestroy,e=this.$plugins,d;if(!this.$destroying&&!this.$destroyed){this.$destroying=!0;var c=-1;for(d=a.length;++c<d;a[c].apply(this,arguments));c=0;for(d=e.length;c<d;c++)e[c].$beforeHostDestroy&&
e[c].$beforeHostDestroy.call(e[c],arguments);a=this.onDestroy.apply(this,arguments);c=-1;for(d=b.length;++c<d;b[c].apply(this,arguments));c=0;for(d=e.length;c<d;c++)e[c].$destroy.apply(e[c],arguments);if(!1!==a)for(c in this)this.hasOwnProperty(c)&&(this[c]=null);this.$destroying=!1;this.$destroyed=!0}},onDestroy:function(){}});e.$self=e;e.$instantiate=function(){var a=arguments;switch(a.length){case 0:return new this;case 1:return new this(a[0]);case 2:return new this(a[0],a[1]);case 3:return new this(a[0],
a[1],a[2]);case 4:return new this(a[0],a[1],a[2],a[3]);default:return sb(this,a)}};e.$override=function(a){var b=this.$self,e=this.$parent;b&&e&&c(b.prototype,a,e)};e.$extend=function(a,b){return f(a,b,this)};e.$destroy=function(){for(var a in this)this[a]=null};var f=function(a,f,k){a=a||{};var h=a.$class,m=k||a.$extends,g=a.$mixins;k=a.$alias;var p,A;if(m)if(w(m))var n=b.get(m);else n=m,m=n.$class||"";else n=e,m="";if(m&&!n)throw m+" not found";a.$class=h;a.$extends=m;a.$mixins=null;m=Object.create(n.prototype);
a.$constructor=a.$constructor||l;c(m,a,n);if(g)for(a=0,p=g.length;a<p;a++){var t=g[a];if(w(t)){if(!b)throw Error("Mixin "+t+" not found");t=b.get(t,!0)}var x=void 0,K=m;for(x in t)t.hasOwnProperty(x)&&("$beforeInit"===x?K.$beforeInit.push(t[x]):"$afterInit"===x?K.$afterInit.push(t[x]):"$beforeDestroy"===x?K.$beforeDestroy.push(t[x]):"$afterDestroy"===x?K.$afterDestroy.push(t[x]):K[x]||(K[x]=t[x]))}g=d(h);m.constructor=g;m.$self=g;g.prototype=m;for(A in e)"prototype"!==A&&e.hasOwnProperty(A)&&(g[A]=
e[A]);for(A in n)"prototype"!==A&&n.hasOwnProperty(A)&&(g[A]=n[A]);if(f)for(A in f)"prototype"!==A&&f.hasOwnProperty(A)&&(g[A]=f[A]);g.$parent=n;g.$self=g;b&&(h&&b.register(h,g),k&&b.register(k,g));return g},k=function(a,e){return(e=w(e)&&b?b.get(e):e)?a instanceof e:!1};f.classManagerFactory=a;f.factory=function(a){var e=b?b.get(a):null,d=X(arguments).slice(1);if(!e)throw a+" not found";return e.$instantiate.apply(e,d)};f.isSubclassOf=function(a,e){var d=a,c=b?b.get:function(){};w(e)||(e=e.prototype.$class);
for(w(a)&&(d=c(a));d&&d.prototype;){if(d.prototype.$class===e)return!0;d=d.$parent}return!1};f.isInstanceOf=k;f.define=f;f.Namespace=db;f.BaseClass=e;f.ns=b;f.$destroy=function(){e.$destroy();e=null;b&&(b.$destroy(),b=null)};return f};return a}(),na=function(){var l=new db;l.register("MetaphorJs",n);l.register("mjs",n);return l}(),C=Rb(na),y=n.app.Directive=function(){var l={},g={},c={},a=[],b=!1,d=function(a,b){return a.priority-b.priority};n.directive=n.directive||{attr:l,tag:g,component:c};return C({watcher:null,
stateFn:null,scope:null,node:null,mods:null,wrapperOpen:null,wrapperClose:null,autoOnChange:!0,$init:function(a,b,d,c,m){this.config=d;this.node=b;this.scope=a;if(this.saveState=d.saveState)this.stateFn=F.parse(this.saveState,{setter:!0,setterOnly:!0});a.$on("destroy",this.onScopeDestroy,this);a.$on("reset",this.onScopeReset,this);this.initialSet()},initialSet:function(){var a;this.config.on("value",this.onChange,this);if(this.autoOnChange&&void 0!==(a=this.config.get("value")))this.onChange(a,void 0)},
getChildren:function(){return null},createCommentWrap:function(a,b){a=cb(a,b||this.$class);this.wrapperOpen=a[0];this.wrapperClose=a[1]},onScopeDestroy:function(){this.$destroy()},onScopeReset:function(){},onChange:function(a){this.saveStateOnChange(a)},saveStateOnChange:function(a){this.stateFn&&this.stateFn(this.scope,a)},onDestroy:function(){this.scope&&(this.scope.$un("destroy",this.onScopeDestroy,this),this.scope.$un("reset",this.onScopeReset,this));this.watcher&&(this.watcher.unsubscribe(this.onChange,
this),this.watcher.$destroy(!0));this.wrapperOpen&&this.wrapperOpen.parentNode.removeChild(this.wrapperOpen);this.wrapperClose&&this.wrapperClose.parentNode.removeChild(this.wrapperClose);this.$super()}},{attr:{},tag:{},getDirective:function(a,b){return na.get("MetaphorJs.directive."+a+"."+b)},registerAttribute:function(e,d,c){l[e]||(a.push({priority:d,name:e,handler:l[e]=c}),b=!1)},getAttributes:function(){b||(a.sort(d),b=!0);return a},registerTag:function(a,b){g[a]||(g[a]=b)},registerComponent:function(a,
b){b||(b=a);w(b)&&(b=na.get(b,!0));c[a]||(c[a]=b)}})}(),D=n.lib.Config=function(){var l=new la,g=function(c,a){var b;this.id=W();this.values={};this.properties={};this.cfg=a||{};this.keys=[];if(c)for(b in c)this.setProperty(b,"string"===typeof c[b]?{expression:c[b]}:c[b])};q(g.prototype,{id:null,properties:null,values:null,keys:null,cfg:null,_initMo:function(c){var a=this.properties[c];a.mo=ja.get(this.cfg.scope,a.expression);a.mo.subscribe(this._onPropMutated,this,{append:[c]})},_unsetMo:function(c){c=
this.properties[c];c.mo&&(c.mo.unsubscribe(this._onPropMutated,this),c.mo.$destroy(!0),c.mo=null)},_calcProperty:function(c){var a=this.getProperty(c);if(!a||a.disabled)return null;if(a.expression)if(a.mode||(a.mode=2),1===a.mode)var b=a.expression;else 3===a.mode?b=F.get(a.expression,this.cfg.scope):2===a.mode?(!a.mo&&this._initMo(c),b=a.mo.getValue()):4===a.mode||5===a.mode?b=F.parse(a.expression,{setter:5===a.mode,setterOnly:5===a.mode,getterOnly:4===a.mode}):7===a.mode?b={getter:F.getter(a.expression),
setter:F.setter(a.expression)}:6===a.mode&&(b=F.func(a.expression));void 0===b&&(b=a.defaultValue);b=this._prepareValue(b,a);this.values[c]=b;(a=this.cfg.setTo||a.setTo)&&(a[c]=b);return b},_prepareValue:function(c,a){if(!a.type)return c;switch(a.type){case "int":return parseInt(c);case "float":case "number":return parseFloat(c);case "bool":case "boolean":return Ob(c);case "array":case "list":return I(c)?c:[c];case "string":case "str":return""+c}return c},_onPropMutated:function(c,a,b){var d=this.properties[b],
e=d.setTo||this.cfg.setTo;c=this._prepareValue(c,d);this.values[b]=c;e&&(e[b]=c);l.trigger(this.id,b,c,a);l.trigger(this.id+"-"+b,c,a)},setProperty:function(c,a,b){var d=this.properties,e=!1;d[c]||(d[c]={},this.keys.push(c),e=!0);d=d[c];if(void 0===b)for(var f in a)a[f]!==d[f]&&(e=!0,d[f]=a[f]);else b!==d[a]&&(e=!0,d[a]=b);d.mode||(d.defaultMode?(d.mode=d.defaultMode,e=!0):!0===d.expression&&(d.mode=1,e=!0));2!==d.mode||!d.expression||d.mo||d.disabled||(this._initMo(c),e=!0);e&&void 0!==this.values[c]&&
delete this.values[c];return e},getProperty:function(c){return this.properties[c]||null},getExpression:function(c){return(c=this.getProperty(c))?c.expression||null:null},getAll:function(){var c,a={};for(c in this.properties)a[c]=void 0===this.values[c]?this._calcProperty(c):this.values[c];return a},eachProperty:function(c,a){for(var b in this.properties)c.call(a,b,this.properties[b],this)},hasProperty:function(c){return!!this.properties[c]},hasExpression:function(c){return!(!this.properties[c]||!this.properties[c].expression)},
_toggleProperty:function(c,a){var b=this.properties[c],d=b?b.disabled||!1:!1;b?d!==a&&(2===b.mode&&this[a?"_initMo":"_unsetMo"](c),b.disabled=a):this.setProperty(c,{disabled:a})},disableProperty:function(c){this._toggleProperty(c,!0)},enableProperty:function(c){this._toggleProperty(c,!1)},setMode:function(c,a){this.setProperty(c,"mode",a)},setType:function(c,a,b){this.setProperty(c,"type",a);b&&this.setProperty(c,"defaultMode",b)},setDefaultMode:function(c,a){this.setProperty(c,"defaultMode",a)},
setDefaultValue:function(c,a){this.setProperty(c,"defaultValue",a)},getKeys:function(){return this.keys},getAllValues:function(){var c,a={};var b=0;for(c=this.keys.length;b<c;b++){var d=this.keys[b];if("value"===d)var e="";else if(0===d.indexOf("value."))e=d.replace("value.","");else continue;a[e]=this.get(d)}return a},get:function(c){void 0===this.values[c]&&this._calcProperty(c);return this.values[c]},on:function(c,a,b,d){if("string"===typeof c)l.on(this.id+"-"+c,a,b,d);else l.on(this.id,c,a,b)},
un:function(c,a,b){if("string"===typeof c)l.on(this.id+"-"+c,a,b);else l.on(this.id,c,a)},setTo:function(c){this.cfg.setTo=c},check:function(c){var a=c?[c]:this.keys,b,d=c?0:!1;var e=0;for(b=a.length;e<b;e++){var f=a[e];f=this.properties[f];if(f.mo){if(c)return f.mo.check();d+=f.mo.check()?1:0}}return d},checkScope:function(c){var a=this.cfg.scope;c=F.describeExpression(this.getExpression(c));return-1!==c.indexOf("r")?a.$root.$check():-1!==c.indexOf("p")?a.$parent?a.$parent.$check():a.$root.$check():
a.$check()},clear:function(){var c=this.id,a;if(null!==this.properties){for(a in this.properties)this._unsetMo(a),l.destroyEvent(c+"-"+a);l.destroyEvent(c);this.unsubscribe=this.subscribe=J}},$destroy:function(){null!==this.properties&&this.clear();this.cfg=this.values=this.properties=null}});g.MODE_STATIC=1;g.MODE_DYNAMIC=2;g.MODE_SINGLE=3;g.MODE_GETTER=4;g.MODE_SETTER=5;g.MODE_FUNC=6;g.MODE_FNSET=7;return g}();(function(){var l=function(){return!1};l.$prebuild={defaultMode:D.MODE_STATIC,ignore:!0};
y.registerAttribute("app",100,l)})();n.lib.Scope=function(l){this.$$observable=new la;this.$$historyWatchers={};q(this,l,!0,!1);this.$parent?(this.$parent.$on("check",this.$$onParentCheck,this),this.$parent.$on("destroy",this.$$onParentDestroy,this),this.$parent.$on("freeze",this.$freeze,this),this.$parent.$on("unfreeze",this.$unfreeze,this)):(this.$root=this,this.$isRoot=!0)};q(n.lib.Scope.prototype,{$app:null,$parent:null,$root:null,$isRoot:!1,$level:0,$static:!1,$$frozen:!1,$$observable:null,$$watchers:null,
$$historyWatchers:null,$$checking:!1,$$destroyed:!1,$$changing:!1,$$tmt:null,$new:function(l){return new n.lib.Scope(q({},l,{$parent:this,$root:this.$root,$app:this.$app,$level:this.$level+1,$static:this.$static},!0,!1))},$newIsolated:function(l){return new n.lib.Scope(q({},l,{$app:this.$app,$level:self.$level+1,$static:this.$static},!0,!1))},$freeze:function(){this.$$frozen||(this.$$frozen=!0,this.$$observable.trigger("freeze",this))},$unfreeze:function(){this.$$frozen&&(this.$$frozen=!1,this.$$observable.trigger("unfreeze",
this))},$on:function(l,g,c){return this.$$observable.on(l,g,c)},$un:function(l,g,c){return this.$$observable.un(l,g,c)},$parseExpression:function(l,g){var c=this,a=F.parse(l,g);return function(b){return a(c,b)}},$watch:function(l,g,c){return ja.get(this,l,g,c)},$unwatch:function(l,g,c){if(l=ja.exists(this,l))l.unsubscribe(g,c),l.$destroy(!0)},$watchHistory:function(l,g){this.$$historyWatchers[g]||(this.$$historyWatchers[g]=l,n.lib.History.on("change-"+g,this.$$onHistoryChange,this))},$unwatchHistory:function(l){this.$$historyWatchers[l]||
(delete this.$$historyWatchers[l],n.lib.History.un("change-"+l,this.$$onHistoryChange,this))},$set:function(l,g){if("string"===typeof l)this[l]=g;else for(var c in l)this[c]=l[c];this.$check()},$$onParentDestroy:function(){this.$destroy()},$$onParentCheck:function(){this.$check()},$$onHistoryChange:function(l,g,c){this.$$historyWatchers[c]&&(g=this.$$historyWatchers[c],this[g]=l,this.$check())},$scheduleCheck:function(l){this.$$tmt||(this.$tmt=V(this.$check,this,null,l))},$check:function(){var l;
this.$$checking||this.$static||this.$$frozen||(this.$$checking=!0,this.$$tmt&&(clearTimeout(this.$$tmt),this.$$tmt=null),this.$$mo&&(l=this.$$mo.$checkAll()),this.$$checking=!1,this.$$destroyed||this.$$observable.trigger("check",l),0<l?(this.$$changing=!0,this.$check()):this.$$changing&&(this.$$changing=!1,this.$$observable.trigger("changed")))},$destroy:function(){var l,g;if(!this.$$destroyed){this.$$destroyed=!0;this.$$observable.trigger("destroy");this.$$observable.$destroy();this.$parent&&this.$parent.$un&&
(this.$parent.$un("check",this.$$onParentCheck,this),this.$parent.$un("destroy",this.$$onParentDestroy,this),this.$parent.$un("freeze",this.$freeze,this),this.$parent.$un("unfreeze",this.$unfreeze,this));this.$$mo&&ja.$destroy(this);for(l in this.$$historyWatchers)this.$unwatchHistory(l);for(g in this)this.hasOwnProperty(g)&&(this[g]=null);this.$$destroyed=!0}}},!0,!1);var ta=n.lib.Scope,Na=n.lib.Text=function(){var l=new la,g=function(a,b,c){return c?(a=ja.get(b,a),c.push(a),a.getValue()):F.get(a,
b)},c=function(a,b){for(var e=0,d=a.length,c,m,g="";e<d;)if(-1!==(c=a.indexOf("{{",e))&&-1!==(m=a.indexOf("}}",c+2))&&"\\"!==a.substr(c-1,1))g+=a.substring(e,c),m!==c+2&&(e=a.substring(c+2,m),e=e.trim(),g+=b(e)),e=m+2;else{e!==d&&(g+=a.substring(e));break}return g},a=function(a,b,f,k,h){for(var e,d=a,l=0;;){if(100<l)throw Error("Got more than 100 iterations on template: "+self.origin);h?(e=g(a,b,f),h=!1):e=c(d,function(a){return g(a,b,f)});if(!k||e===d)return e;d=e;l++}},b=function(a,b,c){c=c||{};
this.id=W();this.origin=b;this.text="";this.scope=a;this.once=this.recursive=this.fullExpr=this.destroyed=!1;if(!0===c.recursive||!1===c.recursive)this.recursive=c.recursive;if(!0===c.fullExpr||!1===c.fullExpr)this.fullExpr=c.fullExpr;if(!0===c.once||!1===c.once)this.once=c.once;this._processDelegate=this._process.bind(this);this.observers=[];this._process(!0)};q(b.prototype,{_process:function(b){if(!this.destroyed){var e=this.observers.slice();this._observeData(e,"unsubscribe");this.observers=[];
this.text=a(this.origin,this.scope,this.observers,this.recursive,this.fullExpr);this._observeData(this.observers,"subscribe");this._destroyObservers(e);b||l.trigger(this.id,this)}},_onDataChange:function(){V(this._processDelegate)},_observeData:function(a,b){var e;var d=0;for(e=a.length;d<e;d++)a[d][b](this._onDataChange,this)},_destroyObservers:function(a){var b;var d=0;for(b=a.length;d<b;d++)a[d].$destroy(!0)},getString:function(){return this.text},subscribe:function(a,b,c){return l.on(this.id,
a,b,c)},unsubscribe:function(a,b){return l.un(this.id,a,b)},check:function(){return ja.check(this.scope)},$destroy:function(){this.destroyed=!0;l.destroyEvent(this.id);this._observeData(this.observers,"unsubscribe");this._destroyObservers(this.observers)}});b.render=a;b.eachText=c;b.applicable=function(a){return a&&a.indexOf&&-1!==a.indexOf("{{")?!0:!1};return b}();n.dom=n.dom||{};var eb=n.dom.isField=function(l){var g=l.nodeName.toLowerCase();l=l.type;return"input"!=g&&"textarea"!=g&&"select"!=g||
"submit"==l||"reset"==l||"button"==l?!1:!0},ua=n.dom.getInputValue=function(){var l=/\r/,g={option:function(c){var a=c.getAttribute("value")||c.value;return void 0!==a?a:(c.innerText||c.textContent).trim()},select:function(c){for(var a,b=c.options,d=c.selectedIndex,e=(c="select-one"===c.type||0>d)?null:[],f=c?d+1:b.length,k,h=0>d?f:c?d:0;h<f;h++)if(a=b[h],k=a.disabled||a.parentNode.disabled,(a.selected||h===d)&&!k){a=n.dom.getInputValue(a);if(c)return a;e.push(a)}return e},radio:function(c){return null===
c.getAttribute("value")?"on":c.value},checkbox:function(c){return null===c.getAttribute("value")?"on":c.value}};return function(c){var a,b;if((a=g[c.type]||g[c.nodeName.toLowerCase()])&&void 0!==(b=a(c,"value")))return b;b=c.value;return w(b)?b.replace(l,""):null==b?"":b}}(),z=n.dom.getAttr=function(l,g){return l.getAttribute?l.getAttribute(g):null},M=n.dom.setAttr=function(l,g,c){return l.setAttribute(g,c)},ka=n.dom.removeAttr=function(l,g){return l.removeAttribute(g)},fb=n.dom.setInputValue=function(){var l=
{select:function(g,c){for(var a,b=g.options,d=X(c),e=b.length,f,k=-1;e--;)c=b[e],(f=-1!==d.indexOf(c.value))?(M(c,"selected","selected"),a=c.selected=!0):ka(c,"selected"),f||null===z(c,"default-option")||(k=e);a||(g.selectedIndex=k);return d}};l.radio=l.checkbox=function(g,c){if(I(c))return g.checked=-1!==c.indexOf(ua(g))};return function(g,c){if(1===g.nodeType){null===c?c="":1===ha(c)&&(c+="");var a=l[g.type]||l[g.nodeName.toLowerCase()];a&&void 0!==a(g,c,"value")||(g.value=c)}}}(),gb=n.lib.DomEvent=
function(){var l=function a(c){if(c instanceof a)return c;if(!(this instanceof a))return new a(c);for(var b in c)if(!this[b])try{this[b]=c[b]}catch(f){}this.originalEvent=c;this.type=c.type;!this.target&&c.srcElement&&(this.target=c.srcElement);var d=c.button;if(void 0===this.pageX&&null!==c.clientX){var e=this.target?this.target.ownerDocument||window.document:window.document;b=e.documentElement;e=e.body;this.pageX=c.clientX+(b&&b.scrollLeft||e&&e.scrollLeft||0)-(b&&b.clientLeft||e&&e.clientLeft||
0);this.pageY=c.clientY+(b&&b.scrollTop||e&&e.scrollTop||0)-(b&&b.clientTop||e&&e.clientTop||0)}this.which||void 0===d||(this.which=d&1?1:d&2?3:d&4?2:0);this.isDefaultPrevented=c.defaultPrevented||void 0===c.defaultPrevented&&!1===c.returnValue?Sa:Ma;this.timeStamp=c&&c.timeStamp||(new Date).getTime()};q(l.prototype,{isDefaultPrevented:Ma,isPropagationStopped:Ma,isImmediatePropagationStopped:Ma,preventDefault:function(){var c=this.originalEvent;this.isDefaultPrevented=Sa;c.returnValue=!1;c&&c.preventDefault&&
c.preventDefault()},stopPropagation:function(){var c=this.originalEvent;this.isPropagationStopped=Sa;c.cancelBubble=!0;c&&c.stopPropagation&&c.stopPropagation()},stopImmediatePropagation:function(){var c=this.originalEvent;this.isImmediatePropagationStopped=Sa;c&&c.stopImmediatePropagation&&c.stopImmediatePropagation();this.stopPropagation()}},!0,!1);return l}(),aa=n.dom.normalizeEvent=function(l){return new gb(l)},xb=function(l){function g(){a=null}var c,a;l=function(b){return function(d){var e=
aa(d||window.event),f=slice.call(arguments,1),k=0,h=0,m=0,l=0;e.type="mousewheel";"detail"in e&&(h=-1*e.detail);"wheelDelta"in e&&(h=e.wheelDelta);"wheelDeltaY"in e&&(h=e.wheelDeltaY);"wheelDeltaX"in e&&(k=-1*e.wheelDeltaX);"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(k=-1*h,h=0);var H=0===h?k:h;"deltaY"in e&&(H=h=-1*e.deltaY);"deltaX"in e&&(k=e.deltaX,0===h&&(H=-1*k));if(0!==h||0!==k){var u=Math.max(Math.abs(h),Math.abs(k));if(!a||u<a)a=u,"mousewheel"===e.type&&0===u%120&&(a/=40);"mousewheel"===e.type&&
0===u%120&&(H/=40,k/=40,h/=40);H=Math[1<=H?"floor":"ceil"](H/a);k=Math[1<=k?"floor":"ceil"](k/a);h=Math[1<=h?"floor":"ceil"](h/a);this.getBoundingClientRect&&(u=this.getBoundingClientRect(),m=e.clientX-u.left,l=e.clientY-u.top);e.deltaX=k;e.deltaY=h;e.deltaFactor=a;e.offsetX=m;e.offsetY=l;e.deltaMode=0;f.unshift(e,H,k,h);c&&clearTimeout(c);c=setTimeout(g,200);return b.apply(this,f)}}};l.events=function(){var a=window.document;return"onwheel"in a||9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll",
"MozMousePixelScroll"]};return l}(),O=n.dom.addListener=function(){var l=null,g=null;return function(c,a,b){null===l&&(c.addEventListener?(l="addEventListener",g=""):(l="attachEvent",g="on"));if("mousewheel"==a){b=xb(b);a=xb.events();var d;var e=0;for(d=a.length;e<d;e++)c[l](g+a[e],b,!1)}else c[l](g+a,b,!1);return b}}(),da=n.dom.removeListener=function(){var l=null,g=null;return function(c,a,b){null===l&&(c.removeEventListener?(l="removeEventListener",g=""):(l="detachEvent",g="on"));c[l](g+a,b)}}(),
Oa=n.dom.isAttached=function c(g){if(g===window)return!0;if(3==g.nodeType)return g.parentElement?c(g.parentElement):!0;var a=window.document.documentElement;return g===a?!0:a.contains(g)};n.browser=n.browser||{};var Sb=n.browser.isAndroid=function(){var g=null;return function(){null===g&&(g=parseInt((/android (\d+)/i.exec(navigator.userAgent)||[])[1],10)||!1);return g}}(),Ua=n.browser.isIE=function(){var g;return function(){if(null===g){var c=navigator.userAgent;g=parseInt((/msie (\d+)/i.exec(c)||
[])[1],10);isNaN(g)&&(g=parseInt((/trident\/.*; rv:(\d+)/i.exec(c)||[])[1],10)||!1)}return g}}(),yb=n.browser.hasEvent=function(){var g={},c;return function(a){if(void 0===g[a]){if("input"===a&&9==Ua())return g[a]=!1;c||(c=window.document.createElement("div"));g[a]=!!("on"+a in c)}return g[a]}}(),L=n.dom.select=function(){var g=/^[\w[:#.][\w\]*^|=!]*$/,c=/=([^\]]+)/,a=/ *, */,b=/(\([^)]*)\+/,d=/(\[[^\]]+)~/,e=/(~|>|\+)/,f=/ +/,k=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
h=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,m=/\D/,p=/[^(]*\(([^)]*)\)/,H=/\(.*/,u=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,r=window.document,v=!!r.getElementsByClassName,A=!!r.querySelectorAll,n={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!==a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,b){var e=a.nodeIndex||0,d=b[3]=b[3]?("%"===b[2]?-1:1)*b[3]:0;b=b[1];if(e)return!((e+
d)%b);var c=a.parentNode.firstChild;e++;do if(1===c.nodeType&&(c.nodeIndex=++e)&&a===c&&(e+d)%b)return 0;while(c=c.nextSibling);return 1},"nth-last-child":function(a,b){var e=a.nodeIndexLast||0,d=b[3]?("%"===b[2]?-1:1)*b[3]:0;b=b[1];if(e)return!((e+d)%b);var c=a.parentNode.lastChild;e++;do if(1===c.nodeType&&(c.nodeLastIndex=e++)&&a===c&&(e+d)%b)return 0;while(c=c.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!==
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&r.documentElement.lang!==b},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},t={},x=function(a){return t[a]||(t[a]=new RegExp("(^| +)"+a+"($| +)"))},K={"":function(a,b){return null!==z(a,b)},"=":function(a,b,e){var d;return(d=z(a,b))&&d===e},"&=":function(a,b,e){var d;return(d=z(a,b))&&x(e).test(d)},
"^=":function(a,b,e){var d;return(d=z(a,b)+"")&&!d.indexOf(e)},"$=":function(a,b,e){var d;return(d=z(a,b)+"")&&d.indexOf(e)===d.length-e.length},"*=":function(a,b,e){var d;return(d=z(a,b)+"")&&-1!==d.indexOf(e)},"|=":function(a,b,e){var d;return(d=z(a,b)+"")&&(d===e||!!d.indexOf(e+"-"))},"!=":function(a,b,e){var d;return!(d=z(a,b))||!x(e).test(d)}};return function(t,E,x){E=E||r;var q=[],ca=null,z,y;if(A&&E.querySelectorAll&&!x)try{q=X(E.querySelectorAll(t.replace(c,'="$1"')))}catch(Tb){T(Tb),ca=!0}if(!A||
ca||x)if(g.test(t))switch(x=0,t.charAt(0)){case "#":x=t.slice(1);q=r.getElementById(x);q.id!==x&&(q=r.all[x]);q=q?[q]:[];break;case ".":var w=t.slice(1);if(v)q=X((q=E.getElementsByClassName(w)).length?q:[]);else{w=" "+w+" ";ca=E.getElementsByTagName("*");for(z=0;E=ca[z++];)-1!==(" "+E.className+" ").indexOf(w)&&(q[x++]=E);q=x?q:[]}break;case ":":ca=E.getElementsByTagName("*");z=0;var B=t.replace(p,"$1");for(y=t.replace(H,"");E=ca[z++];)n[y]&&!n[y](E,B)&&(q[x++]=E);q=x?q:[];break;case "[":ca=E.getElementsByTagName("*");
z=0;E=u.exec(t);t=E[1];var Z=E[2]||"";for(w=E[3];E=ca[z++];)K[Z]&&(K[Z](E,t,w)||"class"===t&&K[Z](E,"className",w))&&(q[x++]=E);q=x?q:[];break;default:q=X((q=E.getElementsByTagName(t)).length?q:[])}else{for(var D=t.split(a),C=D.length-1,Qb=!!C,G,M,R,O,J,I,F,L,P,Q,N,S;x=D[C--];){M=(G=x.replace(b,"$1%").replace(d,"$1&").replace(e," $1 ").split(f)).length;z=0;O=" ";for(ca=E instanceof DocumentFragment?E.children:[E];R=G[z++];)if(" "!==R&&">"!==R&&"~"!==R&&"+"!==R&&ca){R=R.match(k);J=R[1]||"*";I=R[2];
F=R[3]?" "+R[3]+" ":"";t=R[4];Z=R[5]||"";y=R[7];B="nth-child"===y||"nth-last-child"===y?h.exec("even"===R[8]&&"2n"||"odd"===R[8]&&"2n%1"||!m.test(R[8])&&"0n%"+R[8]||R[8]):R[8];L=[];x=P=0;for(N=z===M;Q=ca[P++];)switch(O){case " ":if(Q.getElementsByTagName)for(S=Q.getElementsByTagName(J),Q=0;w=S[Q++];)I&&w.id!==I||F&&-1==(" "+w.className+" ").indexOf(F)||!(!t||K[Z]&&(K[Z](w,t,R[6])||"class"===t&&K[Z](w,"className",R[6])))||w.yeasss||(n[y]?n[y](w,B):y)||(N&&(w.yeasss=1),L[x++]=w);break;case "~":for(J=
J.toLowerCase();(Q=Q.nextSibling)&&!Q.yeasss;)1!==Q.nodeType||"*"!==J&&Q.nodeName.toLowerCase()!==J||I&&Q.id!==I||F&&-1===(" "+Q.className+" ").indexOf(F)||!(!t||K[Z]&&(K[Z](w,t,R[6])||"class"===t&&K[Z](w,"className",R[6])))||Q.yeasss||(n[y]?n[y](Q,B):y)||(N&&(Q.yeasss=1),L[x++]=Q);break;case "+":for(;(Q=Q.nextSibling)&&1!==Q.nodeType;);!Q||Q.nodeName.toLowerCase()!==J.toLowerCase()&&"*"!==J||I&&Q.id!==I||F&&-1===(" "+w.className+" ").indexOf(F)||!(!t||K[Z]&&(K[Z](w,t,R[6])||"class"===t&&K[Z](w,"className",
R[6])))||Q.yeasss||(n[y]?n[y](Q,B):y)||(N&&(Q.yeasss=1),L[x++]=Q);break;case ">":if(Q.getElementsByTagName)for(S=Q.getElementsByTagName(J),z=0;w=S[z++];)w.parentNode!==Q||I&&w.id!==I||F&&-1==(" "+w.className+" ").indexOf(F)||!(!t||K[Z]&&(K[Z](w,t,R[6])||"class"===t&&K[Z](w,"className",R[6])))||w.yeasss||(n[y]?n[y](w,B):y)||(N&&(w.yeasss=1),L[x++]=w)}ca=L}else O=R;if(Qb){if(!ca.concat){L=[];for(Q=0;w=ca[Q];)L[Q++]=w;ca=L}q=ca.concat(1===q.length?q[0]:q)}else q=ca}for(x=q.length;x--;)q[x].yeasss=q[x].nodeIndex=
q[x].nodeIndexLast=null}return q}}(),va=n.lib.Input=function(){var g=function(c,a,b,d){if(c.$$input){if(a)c.$$input.on("change",a,b);return c.$$input}d=d||{};this.observable=new la;this.el=c;this.inputType=c.type.toLowerCase();this.dataType=d.type||z(c,"data-type")||this.inputType;this.listeners=[];if(a)this.onChange(a,b)};q(g.prototype,{el:null,inputType:null,dataType:null,listeners:null,radio:null,keydownDelegate:null,changeInitialized:!1,$destroy:function(){var c;this.observable.$destroy();this._addOrRemoveListeners(da,
!0);this.el.$$input=null;for(c in this)this.hasOwnProperty(c)&&(this[c]=null)},_addOrRemoveListeners:function(c,a){var b=this.inputType,d=this.listeners,e=this.radio,f=this.el,k,h;var m=0;for(k=d.length;m<k;m++){var g=!!d[m][2];if(g===a){if("radio"===b)for(g=0,h=e.length;g<h;g++)c(e[g],d[m][0],d[m][1]);else c(f,d[m][0],d[m][1]);d[m][2]=!a}}},initInputChange:function(){var c=this.inputType;"radio"===c?this.initRadioInput():"checkbox"===c?this.initCheckboxInput():this.initTextInput();this._addOrRemoveListeners(O,
!1);this.changeInitialized=!0},initRadioInput:function(){var c=this.el,a=c.name;if(Oa(c))c=c.ownerDocument;else for(;c.parentNode;)c=c.parentNode;this.radio=L("input[name="+a+"]",c);this.onRadioInputChangeDelegate=this.onRadioInputChange.bind(this);this.listeners.push(["click",this.onRadioInputChangeDelegate,!1])},initCheckboxInput:function(){this.clicked=!1;this.onCheckboxInputChangeDelegate=this.onCheckboxInputChange.bind(this);this.onCheckboxInputClickDelegate=this.onCheckboxInputClick.bind(this);
this.listeners.push(["click",this.onCheckboxInputClickDelegate,!1]);this.listeners.push(["change",this.onCheckboxInputChangeDelegate,!1])},initTextInput:function(){var c=!1,a=this,b=a.listeners,d;Sb()||(b.push(["compositionstart",function(){c=!0},!1]),b.push(["compositionend",function(){c=!1;e()},!1]));var e=a.onTextInputChangeDelegate=function(b){if(!c)a.onTextInputChange(b)},f=function(a){d||(d=setTimeout(function(){e(a);d=null},0))},k=function(a){a=a||window.event;var b=a.keyCode;91===b||15<b&&
19>b||37<=b&&40>=b||f(a)};yb("input")?b.push(["input",e,!1]):(b.push(["keydown",k,!1]),yb("paste")&&(b.push(["paste",f,!1]),b.push(["cut",f,!1])));b.push(["change",e,!1])},processValue:function(c){switch(this.dataType){case "number":case "float":case "double":if(""===c||isNaN(c=parseFloat(c)))c=void 0;break;case "int":case "integer":if(""===c||isNaN(c=parseInt(c,10)))c=void 0;break;case "bool":case "boolean":return!("false"===c||"0"===c||0===c||"off"===c||!1===c||""===c)}return c},onTextInputChange:function(c){c=
this.getValue();this.observable.trigger("change",this.processValue(c))},_checkboxChange:function(){var c=this.el;this.observable.trigger("change",this.processValue(c.checked?z(c,"value")||!0:!1))},onCheckboxInputChange:function(){this.clicked||this._checkboxChange();this.clicked=!1},onCheckboxInputClick:function(){this._checkboxChange();this.clicked=!0},onRadioInputChange:function(c){c=c||window.event;this.observable.trigger("change",this.processValue((c.target||c.srcElement).value))},setValue:function(c){var a=
this.inputType,b;c=this.processValue(c);if("radio"===a){a=this.radio;var d=0;for(b=a.length;d<b;d++)a[d].checked=this.processValue(a[d].value)==c}else"checkbox"===a?(a=this.el,a.checked=!0===c||c==this.processValue(a.value)):(void 0===c&&(c=""),fb(this.el,c));this.triggerChange()},getValue:function(){var c=this.inputType,a;if("radio"===c){c=this.radio;var b=0;for(a=c.length;b<a;b++)if(c[b].checked)return this.processValue(c[b].value);return null}return"checkbox"===c?this.processValue(this.el.checked?
z(this.el,"value")||!0:!1):this.processValue(ua(this.el))},onChange:function(c,a){this.changeInitialized||this.initInputChange();this.observable.on("change",c,a)},unChange:function(c,a){this.observable.un("change",c,a)},onKey:function(c,a,b,d){this.keydownDelegate||(this.keydownDelegate=this.keyHandler.bind(this),this.listeners.push(["keydown",this.keydownDelegate,!1]),O(this.el,"keydown",this.keydownDelegate),this.observable.createEvent("key",{returnResult:!1,triggerFilter:this.keyEventFilter}));
this.observable.on("key",a,b,{key:c,prepend:d})},unKey:function(c,a,b){this.observable.un("key",a,b)},keyEventFilter:function(c,a){c=c.key;a=a[0];return"object"!==typeof c?c===a.keyCode:void 0!==c.ctrlKey&&c.ctrlKey!==a.ctrlKey||void 0!==c.shiftKey&&c.shiftKey!==a.shiftKey?!1:!(void 0!==c.keyCode&&c.keyCode!==a.keyCode)},keyHandler:function(c){c=aa(c||window.event);this.observable.trigger("key",c)},triggerChange:function(){if("createEvent"in document){var c=document.createEvent("HTMLEvents");c.initEvent("change",
!1,!0);this.el.dispatchEvent(c)}else this.el.fireEvent("onchange")}},!0,!1);g.get=function(c,a){return c.$$input?c.$$input:a&&!c.type&&(a=a.$app.getParentCmp(c,!0))&&a.getInputInterface?a.getInputInterface():new g(c)};g.getValue=ua;g.setValue=fb;return g}();y.registerAttribute("bind",1E3,y.$extend({$class:"MetaphorJs.app.Directive.attr.Bind",isInput:!1,input:null,textRenderer:null,observers:null,$init:function(g,c,a,b){a.setType("recursive","bool");a.setType("once","bool",D.MODE_STATIC);this.scope=
g;this.node=c;this.config=a;if(this.isInput=eb(c))this.input=va.get(c),this.input.onChange(this.onInputChange,this);a.setType("locked","bool");a.get("recursive")?(a.disableProperty("value"),a.disableProperty("recursive"),this.textRenderer=new Na(g,a.getExpression("value"),{recursive:!0,fullExpr:!0,once:a.get("once")}),this.textRenderer.subscribe(this.onTextRendererChange,this),this.onTextRendererChange(),g instanceof ta&&g.$on("destroy",this.onScopeDestroy,this)):this.$super(g,c,a)},onInputChange:function(g){var c=
this.config.get("value");if(this.config.get("locked")&&g!=c)this.onChange(c)},onTextRendererChange:function(){this.onChange(this.textRenderer.getString())},onChange:function(g){this.updateElement(g)},updateElement:function(g){this.isInput?this.input.setValue(g):this.node["string"===typeof this.node.textContent?"textContent":"innerText"]=g},onDestroy:function(){this.textRenderer&&(this.textRenderer.$destroy(),this.textRenderer=null);this.input&&(this.input.$destroy(),this.input=null);this.$super()}}));
y.registerAttribute("bind-html",1E3,y.attr.Bind.$extend({$class:"MetaphorJs.app.Directive.attr.BindHtml",updateElement:function(g){this.node.innerHTML=g}}));n.animate=n.animate||{};var Fa=n.animate.getPrefixes=function(){var g=["Moz","Webkit","ms","O","Khtml"],c="animationDelay",a="animationDuration",b="transitionDelay",d="transitionDuration",e="transform",f=null,k=null,h=!1;return function(){if(!h){var m=window.document.createElement("div"),p=!1,H;if(void 0!==m.style.animationName)p=!0;else{var u=
0;for(H=g.length;u<H;u++){var r=g[u];if(void 0!==m.style[r+"AnimationName"]){p=!0;c=r+"AnimationDelay";a=r+"AnimationDuration";b=r+"TransitionDelay";d=r+"TransitionDuration";e=r+"Transform";break}}}p&&("ontransitionend"in window?f="transitionend":"onwebkittransitionend"in window&&(f="webkitTransitionEnd"));k=p?{animationDelay:c,animationDuration:a,transitionDelay:b,transitionDuration:d,transform:e,transitionend:f}:{};h=!0}return k}}(),Ub=n.animate.getDuration=function(){var g=function(a){if(!a)return 0;
var b=parseFloat(a);-1===a.indexOf("ms")&&(b*=1E3);return b},c=function(a,b,e){var d,c=b.length;for(d=0;d<c;d++){var f=g(b[d])+g(e[d]);a=Math.max(f,a)}return a},a=!1,b=null,d=null,e=null,f=null;return function(k){!1===a&&(b=(a=Fa())?a.animationDuration:null,d=a?a.animationDelay:null,e=a?a.transitionDuration:null,f=a?a.transitionDelay:null);if(!a)return 0;var h=window.getComputedStyle?window.getComputedStyle(k,null):k.style;k=0;var m=(h[b]||"").split(","),g=(h[d]||"").split(","),H=(h[e]||"").split(",");
h=(h[f]||"").split(",");k=Math.max(k,c(k,m,g));return k=Math.max(k,c(k,H,h))}}(),zb=n.animate.isCssSupported=function(){var g=null;return function(){null===g&&(g=!!Fa());return g}}(),G=n.lib.Promise=function(){var g=[],c=!1,a="undefined"!==typeof process?process.nextTick:function(a){setTimeout(a,0)},b=function(){c=!0;var e=g.shift();a(function(){e[0].apply(e[1],e[2]);g.length?b():c=!1},0)},d=function(a,e,d){d=d||[];g.push([a,e,d]);c||b()},e=function(a,b){return function(e){try{b.resolve(a(e))}catch(p){b.reject(p)}}},
f=function(a,b){if(a instanceof f)return a;if(!(this instanceof f))return new f(a,b);var e;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(0<arguments.length)if(e=Y(a))a instanceof f?a.then(this.resolve.bind(this),this.reject.bind(this)):(new f(e,a)).then(this.resolve.bind(this),this.reject.bind(this));else if(B(a))try{a.call(b,this.resolve.bind(this),this.reject.bind(this))}catch(p){this.reject(p)}else this.resolve(a)};q(f.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,
_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0===this._state},isFulfilled:function(){return 1===this._state},isResolved:function(){return 1===this._state},isRejected:function(){return 2===this._state},hasListeners:function(){var a=[this._fulfills,this._rejects,this._dones,this._fails],b;var e=0;for(b=a.length;e<b;e++)if(a[e]&&a[e].length)return!0;return!1},_cleanup:function(){this._fails=this._dones=this._rejects=this._fulfills=null},_processValue:function(a,
b,e){var d;if(0===this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{if(e)try{if(d=Y(a)){a instanceof f?a.then(this._processResolveValue.bind(this),this._processRejectReason.bind(this)):(new f(d,a)).then(this._processResolveValue.bind(this),this._processRejectReason.bind(this));return}}catch(H){0===this._state&&this._doReject(H);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)d(b[0],b[1],[this._value]);
this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0===this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve,!0)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)d(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0===this._wait&&this._callRejectHandlers()},
_processRejectReason:function(a){this._processValue(a,this._doReject,!1)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,b,c){var h=new f,k=this._state;c&&(a&&(a=a.bind(c)),b&&(b=b.bind(c)));0===k||0!==this._wait?(a&&B(a)?this._fulfills.push([e(a,h),null]):this._fulfills.push([h.resolve,h]),b&&B(b)?this._rejects.push([e(b,h),null]):this._rejects.push([h.reject,h])):1===k?a&&B(a)?d(e(a,h),null,[this._value]):h.resolve(this._value):
2===k&&(b&&B(b)?d(e(b,h),null,[this._reason]):h.reject(this._reason));return h},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)try{b[0].call(b[1]||null,this._value)}catch(m){T(m)}},done:function(a,b){var e=this._state;if(1===e&&0===this._wait)try{a.call(b||null,this._value)}catch(p){T(p)}else 0===e&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)try{b[0].call(b[1]||null,this._reason)}catch(m){T(m)}},fail:function(a,
b){var e=this._state;if(2===e&&0===this._wait)try{a.call(b||null,this._reason)}catch(p){T(p)}else 0===e&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},promise:function(){return{then:this.then.bind(this),done:this.done.bind(this),fail:this.fail.bind(this),always:this.always.bind(this),"catch":this["catch"].bind(this)}},after:function(a){var b=this;if(Y(a)){b._wait++;var e=function(){b._wait--;0===b._wait&&0!==b._state&&(1===b._state?b._callResolveHandlers():
b._callRejectHandlers())};B(a.done)?a.done(e):a.then(e)}return b}},!0,!1);f.fcall=function(a,b,e){return f.resolve(a.apply(b,e||[]))};f.resolve=function(a){var b=new f;b.resolve(a);return b};f.reject=function(a){var b=new f;b.reject(a);return b};f.all=function(a){if(!a.length)return f.resolve(null);var b=new f,e=a.length,d=Array(e),c=e,k,g,v=function(a,e){d[e]=a;c--;0===c&&b.resolve(d)};for(k=0;k<e;k++)(function(e){g=a[k];g instanceof f?g.done(function(a){v(a,e)}).fail(b.reject,b):Y(g)||B(g)?(new f(g)).done(function(a){v(a,
e)}).fail(b.reject,b):v(g,e)})(k);return b};f.when=function(){return f.all(arguments)};f.allResolved=function(a){if(!a.length)return f.resolve(null);var b=new f,e=a.length,d=[],c=e,k,g=function(a){d.push(a);v()},v=function(){c--;0===c&&b.resolve(d)};for(k=0;k<e;k++){var A=a[k];A instanceof f?A.done(g).fail(v):Y(A)||B(A)?(new f(A)).done(g).fail(v):g(A)}return b};f.race=function(a){if(!a.length)return f.resolve(null);var b=new f,e=a.length,d;for(d=0;d<e;d++){var c=a[d];c instanceof f?c.done(b.resolve,
b).fail(b.reject,b):Y(c)||B(c)?(new f(c)).done(b.resolve,b).fail(b.reject,b):b.resolve(c);if(!b.isPending())break}return b};f.waterfall=function(a){if(!a.length)return f.resolve(null);var b=a.shift();b=B(b)?f.fcall(b):f.resolve(e);for(var e;e=a.shift();)Y(e)?b=b.then(function(a){return function(){return a}}(e)):B(e)?b=b.then(e):b.resolve(e);return b};f.forEach=function(a,b,e,d){var c=a.slice(),h=new f,k=[],m=0,g=function(){if(c.length){var a=c.shift(),p=m;m++;f.fcall(b,e,[a,p]).done(function(a){k.push(a);
g()}).fail(function(a){d?h.reject(a):(k.push(null),g())})}else h.resolve(k)};g();return h};f.counter=function(a){var b=new f;b.countdown=function(){a--;0===a&&b.resolve()};return b};return f}(),P=n.dom.data=function(){var g={};return function(c,a,b,d){c=c._mjsid||(c._mjsid=W());var e=g[c];if("remove"===d)a?e&&delete e[a]:delete g[c];else return void 0!==b?(e||(e=g[c]={}),e[a]=b):e?e[a]:void 0}}(),Ab=n.dom.getClsReg=function(g){return Ta("(?:^|\\s)"+g+"(?!\\S)")},Va=n.dom.hasClass=function(g,c){return c?
Ab(c).test(g.className):!1},N=n.dom.addClass=function(g,c){c&&!Va(g,c)&&(g.className+=" "+c)},S=n.dom.removeClass=function(g,c){c&&(g.className=g.className.replace(Ab(c),""))},U=function(){if("undefined"!==typeof window){var g=window;var c=g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame;var a=g.cancelAnimationFrame||g.webkitCancelAnimationFrame||g.mozCancelAnimationFrame||g.webkitCancelRequestAnimationFrame;if(c)return function(b,d,e){var f=c(d||e?function(){b.apply(d,
e||[])}:b);return function(){a(f)}}}return function(a,d,e){var b=V(a,d,e,0);return function(){clearTimeout(b)}}}(),fa=n.animate.animate=function(){var g={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},c=0,a=function(a,b,d){var e=function(){(new Date).getTime()-b>=d?a():U(e)};U(e)},b=function v(d,c,h,m,g,H,u,r){var f=function(){var a=P(d,"mjsAnimationQueue");return a&&a.length&&a[0].id==u?!1:(g.reject(d),!0)},k=function(){if(!f()){var a=h;h++;if(h===
c.length){g.resolve(d);P(d,"mjsAnimationQueue").shift();var k=P(d,"mjsAnimationQueue");k.length?(k=k[0],b(k.el,k.stages,0,k.start,k.deferred,!1,k.id,k.step)):P(d,"mjsAnimationQueue",null)}else P(d,"mjsAnimationQueue")[0].position=h,v(d,c,h,null,g,!1,u,r);S(d,c[a]);S(d,c[a]+"-active")}},p=function(){f()||(N(d,c[h]+"-active"),G.resolve(r&&r(d,h,"active")).done(function(){if(!f()){var b=Ub(d);b?a(k,(new Date).getTime(),b):U(k)}}))},n=function(){f()||(N(d,c[h]),G.waterfall([r&&r(d,h,"start"),function(){return m?
m(d):null}]).done(function(){!f()&&U(p)}))};H?U(n):n()},d=function(a,d,h,m){var f=new G,k=P(a,"mjsAnimationQueue")||[],u=++c;if(d){if(w(d))var r=g[d];else if(B(d))var v=d;else if(I(d))if(w(d[0]))r=d;else{var n=d[0];var E=d[1]}if(ia(d)){r=d.stages;v=d.fn;n=d.before;E=d.after;var t=d.options?q({},d.options):{};var x=d.context||null;var K=d.duration||null;h=h||t.start}if(zb()&&r)return k.push({el:a,stages:r,start:h,step:m,deferred:f,position:0,id:u}),P(a,"mjsAnimationQueue",k),1===k.length&&b(a,r,0,
h,f,!0,u,m),f;t=t||{};h&&(t.start=function(){h(a)});t.complete=function(){f.resolve(a)};K&&(t.duration=K);if(v&&B(v))return n&&q(a.style,n,!0,!1),h&&h(a),P(a,"mjsAnimationQueue",v.call(x,a,function(){f.resolve(a)})),f;if(window.jQuery){d=$(a);n&&d.css(n);P(a,"mjsAnimationQueue","stop");if(v&&w(v))return d[v](t),f;if(E)return d.animate(E,t),f}}h?(v=h(a),Y(v)?v.done(function(){f.resolve(a)}):f.resolve(a)):f.resolve(a);return f};d.addAnimationType=function(a,b){g[a]=b};return d}(),wa=n.animate.stop=
function(g){var c=P(g,"mjsAnimationQueue");if(I(c)&&c.length){if(c=c[0]){if(c.stages){var a=c.position;var b=c.stages;S(g,b[a]);S(g,b[a]+"-active")}c.deferred&&c.deferred.reject(c.el)}}else B(c)?c(g):"stop"===c&&$(g).stop(!0,!0);P(g,"mjsAnimationQueue",null)};(function(){var g=function(c,a,b,d){if(null!==b){if(b===Va(c,a))return;b=!b}else b=Va(c,a);b?d?fa(c,[a+"-remove"]).done(function(){S(c,a)}):S(c,a):d?fa(c,[a+"-add"]).done(function(){N(c,a)}):N(c,a)};y.registerAttribute("class",1E3,y.$extend({$class:"MetaphorJs.app.Directive.attr.Class",
initial:!0,prev:null,$init:function(c,a,b,d,e){b.setType("animate","bool");b.eachProperty(function(a){if("value"===a||0===a.indexOf("value."))b.on(a,self.onChange,self)});this.$super(c,a,b,d,e)},getCurrentValue:function(){var c=this.config.getAllValues(),a=[];c[""]&&(a.push(c[""]),delete c[""]);a.push(c);c={};var b,d;var e=0;for(b=a.length;e<b;e++){var f=a[e];if("string"===typeof f)c[f]=!0;else{if(I(f)){var k=-1;for(d=f.length;++k<d;c[f[k]]=!0);}for(k in f)if("_"===k)for(k=-1,d=f._.length;++k<d;c[f._[k]]=
!0);else c[k]=f[k]}}return c},onChange:function(){var c=this.node,a=this.getCurrentValue(),b=this.prev,d;wa(c);if(b)for(d in b)b.hasOwnProperty(d)&&void 0===a[d]&&g(c,d,!1,!1);for(d in a)a.hasOwnProperty(d)&&g(c,d,!!a[d],!this.initial&&this.config.get("animate"));this.prev=a;this.initial=!1}}))})();n.app=n.app||{};var Bb=n.lib.Provider=function(){var g=function(){this.store={}};q(g.prototype,{store:null,instantiate:function(a,b,d,e){return a.$instantiate?a.$instantiate.apply(a,d):e?sb(a,d):a.apply(b,
d)},inject:function(a,b,d,e,c){d=d||{};e=e||[];var f=this;if(B(a))if(a.inject)e=a.inject.slice(),e.push(a),a=e;else return f.instantiate(a,b,e,c);else{if(w(a))return f.resolve(a,d);a=a.slice()}e=[];var h=a.pop(),m;var g=-1;for(m=a.length;++g<m;e.push(f.resolve(a[g],d)));return G.all(e).then(function(a){return f.instantiate(h,b,a,c)})},value:function(a,b){this.store[a]={type:1,value:b}},constant:function(a,b){var d=this.store;d[a]||(d[a]={type:2,value:b})},factory:function(a,b,d,e){sa(d)&&(e=d,d=null);
this.store[a]={type:3,singleton:e,fn:b,context:d}},service:function(a,b,d){this.store[a]={type:4,singleton:d,fn:b}},provider:function(a,b){this.store[a+"Provider"]={name:a,type:5,fn:b,instance:null}},resolve:function(a,b,d){var e=this.store,f;b=b||{};d=d||[];if(void 0!==b[a])return b[a];if(f=e[a]){var k=f.type;if(1===k||2===k)return f.value;if(3===k)var h=this.inject(f.fn,f.context,b,d);else if(4===k)h=this.inject(f.fn,null,b,d,!0);else if(5===k)return f.instance||(f.instance=G.resolve(this.inject(f.fn,
null,b)).done(function(a){f.instance=a;e[f.name]={type:3,fn:a.$get,context:a}})),f.instance;f.singleton&&(f.type=1,f.value=h,3===k&&Y(h)&&h.done(function(a){f.value=a}));return b[a]=h}if(e[a+"Provider"])return this.resolve(a+"Provider",b),this.resolve(a,b);if(this===c)throw Error("Could not provide value for "+a);return c.resolve(a)},$destroy:function(){this.store=null}},!0,!1);g.global=function(){return c};var c=new g;return g}(),ea=n.dom.toFragment=function(g,c){c=(c||window.document).createDocumentFragment();
var a;if(w(g)){var b=window.document.createElement("div");b.innerHTML=g;g=b.childNodes}if(!g)return c;if(g.nodeType)c.appendChild(g);else{if(g.item){var d=g;g=[];b=-1;for(a=d.length>>>0;++b!==a;g.push(d[b]));}b=-1;for(a=g.length;++b!==a;c.appendChild(g[b]));}return c},Pa=n.dom.clone=function a(c){var b;if(I(c)){var d=[];var e=0;for(b=c.length;e<b;e++)d.push(a(c[e]));return d}if(c)switch(c.nodeType){case 1:return c.cloneNode(!0);case 3:return window.document.createTextNode(c.innerText||c.textContent);
case 11:return c.cloneNode(!0)}return null},Cb=n.dom.getAttrSet=function(){var c=/^([\[({#$])([^)\]}"':\*]+)[\])}]?([:\*!]?)$/,a=function(a,b){if(this.inflated)delete this.directive[b];else{this.directive[b]&&this.directive[b].original&&ka(a,this.directive[b].original);var e,d=this.names[b];if(d){var c=0;for(e=d.length;c<e;c++)ka(a,d[c]);delete this.names[b]}}},b={"*":D.MODE_DYNAMIC,":":D.MODE_STATIC,"!":D.MODE_SINGLE,"":null},d={"{":"dir","(":"event","[":"attr",$:"cfg"},e=function(){return{directive:{},
attribute:{},config:{},rest:{},reference:null,names:{},removeDirective:a}};return function(a){var f=e(),h,m,p=I(a)?a:a.attributes;if(a.nodeType&&a.hasAttribute&&a.hasAttribute("mjs"))return a=f=n.prebuilt.configs[a.getAttribute("mjs")],q(a,e(),!1,!1),a.inflated=!0,f;var H=0;for(h=p.length;H<h;H++){var u=p[H].name;var r=p[H].value;var v=null;if(m=u.match(c)){u=m[2];var A=m[1];v=b[m[3]];if("#"===A){f.reference=u;continue}}else if("mjs-"===u.substr(0,4))u=u.substr(4),A="{";else{f.rest[u]=r;continue}var E=
u.split(".");u=E.shift();if("$"===A)""===r&&(r=!0),m=a.tagName.toLowerCase(),f.config[ab(u)]={expression:r,mode:v,dtype:d[A]},f.names[m]||(f.names[m]=[]),f.names[m].push(p[H].name);else if("("===A||"{"===A){m=f.directive;var t=E.length?E[0]:null;m[u]||(m[u]={original:null,config:{},dtype:d[A]});t||(m[u].original=p[H].name);t&&!f.names[u]&&(f.names[u]=[]);t&&"$"===t[0]?(""===r&&(r=!0),A=ab(t.substr(1)),m[u].config[A]={mode:v,expression:r,original:p[H].name},f.names[u].push(p[H].name)):t?(A="value."+
E.join("."),m[u].config[A]={mode:v,expression:r,original:p[H].name},f.names[u].push(p[H].name)):m[u].config.value={mode:v,expression:r,original:p[H].name}}else"["===A&&(f.attribute[u]={value:r,original:p[H].name})}return f}}(),hb=n.app.Renderer=function(){var c=null,a=n.directive,b=function(a,b,e,d,c,h){var k=[];if(a&&!0!==a){if(a.nodeType){h.countdown+=1;f(a,e,d,c,h);return}k=a.slice()}k.length||(k=X(b.childNodes||b));b=k.length;h.countdown+=b;for(a=-1;++a<b;f(k[a],e,d,c,h));},d=function(a,b){if(b)if(b.nodeType)a.push(b);
else if(I(b))for(var e=-1,c=b.length;++e<c;d(a,b[e]));},e={script:!0,template:!0,"mjs-template":!0,style:!0,link:!0},f=function(a,d,c,f,h){if(a){var k=a.nodeName;h||(h={countdown:1});if(!k||!e[k.toLowerCase()])if(k=d.call(c,a),!1!==k){if(Y(k)){k.done(function(e){!1!==e&&b(e,a,d,c,f,h);0===--h.countdown&&f&&f.call(c)});return}b(k,a,d,c,f,h)}0===--h.countdown&&f&&f.call(c)}},k=new la,h=function(a,b,e,d){this.id=W();this.el=a;this.scope=b;this.texts=[];this.parent=e;this.passedAttrs=d;b instanceof ta&&
b.$on("destroy",this.$destroy,this);if(e)e.on("destroy",this.$destroy,this)};q(h.prototype,{id:null,el:null,scope:null,texts:null,parent:null,passedAttrs:null,reportFirstNode:!0,on:function(a,b,e){return k.on(a+"-"+this.id,b,e)},once:function(a,b,e){return k.once(a+"-"+this.id,b,e)},un:function(a,b,e){return k.un(a+"-"+this.id,b,e)},createChild:function(a){return new h(a,this.scope,this)},getEl:function(){return this.el},runHandler:function(a,b,e,d,c){var f=a.$isolateScope?b.$newIsolated():a.$breakScope?
b.$new():b,h=b.$app,k={$scope:f,$node:e,$nodeConfig:d,$attrSet:c,$renderer:this};d=[f,e,d,this,c];c.reference&&(f[c.reference]=e);e=h?h.inject(a,null,k,d):a.$instantiate?a.$instantiate.apply(a,d):a.apply(null,d);h&&a.$registerBy&&e&&(Y(e)?e.done(function(e){h.registerCmp(e,b,a.$registerBy)}):h.registerCmp(e,b,a.$registerBy));if(e&&e.$destroy)this.on("destroy",e.$destroy,e);else if("function"===typeof e)this.on("destroy",e);return a.$stopRenderer?!1:e&&e.getChildren?e.getChildren():e},processNode:function(b){var e=
b.nodeType,f=this.texts,h=this.scope;if(3===e)h=b.textContent||b.nodeValue,Na.applicable(h)&&(h=new Na(this.scope,h),h.subscribe(this.onTextChange,this,{append:[f.length]}),f.push({node:b,tr:h}),this.renderText(f.length-1));else if(1===e){this.reportFirstNode&&(k.trigger("first-node-"+this.id,b),this.reportFirstNode=!1);c||(c=y.getAttributes());var m=b.tagName.toLowerCase();e=[];var v=[],n,E;var t=!1;"mjs-"===m.substr(0,4)&&(m=m.substr(4));var x=Cb(b);if(x.config.ignore)return!1;var K=new D(x.config,
{scope:this.scope});this.passedAttrs&&(x.directive=q({},x.directive,this.passedAttrs.directive,!0,!0),this.passedAttrs=null);if(K=a.component[m])if(m=(x.config.as?x.config.as.expression:null)||K.tag){x.directive.cmp={name:"cmp",original:"{cmp}",config:q({},x.config,{value:{mode:D.MODE_STATIC,expression:K.prototype.$class}})};m=window.document.createElement(m);for(b.parentNode.replaceChild(m,b);b.firstChild;)m.appendChild(b.firstChild);b=m;for(w in x.rest)M(b,w,x.rest[w])}else{var w=a.attr.cmp;t=q({},
x);delete t.directive.cmp;x.config.passAttrs=t;K=new D(q({},x.config,{value:{mode:D.MODE_STATIC,expression:K}},!0,!1),{scope:this.scope,deferInit:!0});this.on("destroy",K.$destroy,K);w=this.runHandler(w,h,b,K,x);t=!0;if(!1===w)return!1;Y(w)?e.push(w):d(v,w)}else if(w=a.tag[m]){K=new D(x.config,{scope:this.scope,deferInit:!0});this.on("destroy",K.$destroy,K);w=this.runHandler(w,h,b,K,x);t=!0;x.removeDirective(b,m);if(!1===w)return!1;Y(w)?e.push(w):d(v,w)}m=0;for(n=c.length;m<n;m++)if(w=c[m].name,void 0!==
(E=x.directive[w])&&!E.handled){t=c[m].handler;t.$keepAttribute||ka(b,E.original);x.removeDirective(b,w);K=new D(E.config,{scope:this.scope});this.on("destroy",K.$destroy,K);w=this.runHandler(t,h,b,K,x);t=!0;E.handled=!0;if(!1===w)return!1;Y(w)?e.push(w):d(v,w)}!t&&x.reference&&(h[x.reference]=b);if(e.length&&!x.config.ignoreInside){var z=new G;G.all(e).done(function(a){d(v,a);z.resolve(v)});return z}for(m in x.attribute)h=x.attribute[m].value,h=new Na(this.scope,h,{recursive:!!x.config.recursive,
fullExpr:!Na.applicable(h)}),ka(b,x.attribute[m].original),h.subscribe(this.onTextChange,this,{append:[f.length]}),f.push({node:b,attr:m,tr:h}),this.renderText(f.length-1);return x.config.ignoreInside?e.length?(z=new G,G.all(e).done(function(){return z.resolve(!1)}),z):!1:v.length?v:!0}return!0},process:function(){this.el.nodeType?f(this.el,this.processNode,this,this.onProcessingFinished,{countdown:1}):b(null,this.el,this.processNode,this,this.onProcessingFinished,{countdown:0})},onProcessingFinished:function(){k.trigger("rendered-"+
this.id,this)},onTextChange:function(a,b){this.renderText(b)},renderText:function(a){a=this.texts[a];var b=a.tr.getString(),e=a.attr;e?("value"===e?a.node.value=b:"class"===e?a.node.className=b:"src"===e&&(a.node.src=b),M(a.node,e,b)):a.node.nodeValue=b},$destroy:function(){var a=this.texts,b;var e=-1;for(b=a.length;++e<b;a[e].tr.$destroy());this.parent&&this.parent.un("destroy",this.$destroy,this);k.trigger("destroy-"+this.id)}});h.skip=function(a,b){e[a]=b};return h}(),Vb=n.mixin.Promise={$$promise:null,
$beforeInit:function(){this.$$promise=new G},then:function(){return this.$$promise.then.apply(this.$$promise,arguments)},done:function(){this.$$promise.done.apply(this.$$promise,arguments);return this},always:function(){this.$$promise.always.apply(this.$$promise,arguments);return this},fail:function(){this.$$promise.fail.apply(this.$$promise,arguments);return this}};n.ajax=n.ajax||{transport:{}};var Db=n.ajax.serializeParam=function(){function c(a,e,f){var d;if(I(e)){var h=0;for(d=e.length;h<d;h++){var m=
e[h];b.test(a)?f(a,m):c(a+"["+("object"===typeof m?h:"")+"]",m,f)}}else if(ia(e))for(h in e)c(a+"["+h+"]",e[h],f);else f(a,e)}var a=/%20/g,b=/\[\]$/;return function(b){var e,d=[],k=function(a,b){b=B(b)?b():null==b?"":b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};for(e in b)c(e,b[e],k);return d.join("&").replace(a,"+")}}(),Wb=n.ajax.transport.XHR=function(){var c={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",
text:"text/plain",_default:"*/*"};return C({type:"xhr",_xhr:null,_deferred:null,_ajax:null,$init:function(a,b,d){var e;window.XMLHttpRequest&&(e=new XMLHttpRequest)||(e=new ActiveXObject("Msxml2.XMLHTTP"));this._xhr=e;this._deferred=b;this._opt=a;this._ajax=d;a.progress&&(e.onprogress=a.progress.bind(a.context));a.uploadProgress&&e.upload&&(e.upload.onprogress=a.uploadProgress.bind(a.context));e.onreadystatechange=this.onReadyStateChange.bind(this)},setHeaders:function(){var a=this._opt,b=this._xhr,
d;if(a.xhrFields)for(d in a.xhrFields)b[d]=a.xhrFields[d];a.data&&a.contentType&&b.setRequestHeader("Content-Type",a.contentTypeHeader||a.contentType);b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.setRequestHeader("Accept",a.dataType&&c[a.dataType]?c[a.dataType]+", */*; q=0.01":c._default);for(d in a.headers)b.setRequestHeader(d,a.headers[d])},onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=J,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=
J;a:{try{var d=!a.status&&location&&"file:"===location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(e){T(e)}d=!1}if(d)this._ajax.processResponse(w(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||"");else{a.responseData=null;try{a.responseData=this._ajax.returnResponse(w(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||"")}catch(e){T(thrownError)}b.reject(a)}}},abort:function(){this._xhr.onreadystatechange=
J;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(b){T(b),this._deferred&&this._deferred.reject(b)}}})}(),Xb=n.ajax.transport.Script=C({type:"script",_opt:null,_deferred:null,_ajax:null,_el:null,$init:function(c,a,b){this._opt=c;this._ajax=b;this._deferred=a},send:function(){var c=document.createElement("script");M(c,"async","async");M(c,"charset","utf-8");M(c,"src",this._opt.url);O(c,"load",
this.onLoad.bind(this));O(c,"error",this.onError.bind(this));document.head.appendChild(c);this._el=c},onLoad:function(c){this._deferred&&this._deferred.resolve(c)},onError:function(c){this._deferred.reject(c)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},onDestroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}}),Yb=n.ajax.transport.IFrame=C({type:"iframe",_opt:null,_deferred:null,_ajax:null,_el:null,_sent:!1,$init:function(c,a,b){this._opt=
c;this._ajax=b;this._deferred=a},send:function(){var c=this,a=document.createElement("iframe"),b="frame-"+W(),d=c._opt.form;M(a,"id",b);M(a,"name",b);a.style.display="none";document.body.appendChild(a);M(d,"action",c._opt.url);M(d,"target",b);O(a,"load",c.onLoad.bind(c));O(a,"error",c.onError.bind(c));c._el=a;var e=0,f=function(){e++;try{d.submit(),c._sent=!0}catch(k){T(k),2<e?c._deferred.reject(k):V(f,null,[],1E3)}};f()},onLoad:function(){var c=this._el;if(this._sent&&this._opt&&!this._opt.jsonp)try{var a=
c.contentDocument||c.contentWindow.document;var b=a.body.innerHTML;this._ajax.processResponse(b)}catch(d){T(d),this._deferred.reject(d)}},onError:function(c){this._sent&&this._deferred.reject(c)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},onDestroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}}),Ga=n.ajax.Ajax=function(){var c=/\?/,a=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,b=/#.*$/,d=/([?&])_=[^&]*/,e=new la,f=
!(!window||!window.FormData),k=function(a,b,e){var d=b?b.dataType:null;b=b?b.selector:null;if(!w(a))return a;e=e||"";if("xml"===d||!d&&0<=e.indexOf("xml"))return a=tb(a.trim()),b?L(b,a):a;if("html"===d)return a=tb(a,"text/html"),b?L(b,a):a;if("fragment"==d){e=document.createDocumentFragment();d=document.createElement("div");for(d.innerHTML=a;d.firstChild;)e.appendChild(d.firstChild);return e}if("json"===d||!d&&0<=e.indexOf("json"))return JSON.parse(a.trim());("script"===d||!d&&0<=e.indexOf("javascript"))&&
n(a);return a+""},h=function(a){return"/"==a.substr(0,1)?location.protocol+"//"+location.host+a:a},m=function(a,e){a.replace(b,"");if(!e.allowCache){var h=(new Date).getTime();a=d.test(a)?a.replace(d,"$1_="+h):a+(c.test(a)?"&":"?")+"_="+h}!e.data||"POST"==e.method||e.contentType||f&&e.data instanceof window.FormData||(e.data=w(e.data)?e.data:Db(e.data),a+=(c.test(a)?"&":"?")+e.data,e.data=null);return a},p=function(a,b,e){var d;if(!La(a)&&!B(a)&&e){var c=document.createElement("input");M(c,"type",
"hidden");M(c,"name",e);M(c,"value",a);b.appendChild(c)}else if(I(a)&&e)for(c=0,d=a.length;c<d;c++)p(a[c],b,e+"["+c+"]");else if(La(a))for(c in a)a.hasOwnProperty(c)&&p(a[c],b,e?e+"["+c+"]":c)},H=function(a){for(var b,e,d={},c=0;c<a.elements.length;c++)if(b=a.elements[c],null!==z(b,"name"))if(e="INPUT"===b.nodeName.toUpperCase()?z(b,"type").toUpperCase():"TEXT","FILE"===e)for(e=0;e<b.files.length;d[b.name]=b.files[e++].name);else if("RADIO"!==e&&"CHECKBOX"!==e||b.checked)d[b.name]=b.value;return Db(d)},
n=function(a){var b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))};return C({$mixins:[Vb],_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,$init:function(b){b.url&&(b.url=h(b.url));var d=a.exec((window?window.location.href:"").toLowerCase())||[],c=a.exec(b.url.toLowerCase());this._opt=b;!0!==b.crossDomain&&!0!==b.ignoreCrossDomain&&(b.crossDomain=
!(!c||c[1]===d[1]&&c[2]===d[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(d[3]||("http:"===d[1]?"80":"443"))));var k;b.files&&!f&&(b.transport="iframe");"iframe"!=b.transport||b.form?b.form&&(this._form=b.form,"POST"!=b.method||f||(b.transport="iframe")):(this.createForm(),b.form=this._form);if(b.form&&"iframe"!=b.transport&&"POST"==b.method)f?b.data=new FormData(b.form):(b.contentType="application/x-www-form-urlencoded",b.data=H(b.form));else if("json"===b.contentType)b.contentType=b.contentTypeHeader||
"text/plain",b.data=w(b.data)?b.data:JSON.stringify(b.data);else if(ia(b.data)&&"POST"==b.method&&f)for(k in d=b.data,b.data=new FormData,d)b.data.append(k,d[k]);b.files&&this.importFiles();b.url=m(b.url,b);this._transport=k=!b.crossDomain&&"script"!=b.transport||b.form?"iframe"==b.transport?new Yb(b,this.$$promise,this):new Wb(b,this.$$promise,this):new Xb(b,this.$$promise,this);this.$$promise.done(function(a){e.trigger("success",a)});this.$$promise.fail(function(a){e.trigger("error",a)});this.$$promise.always(function(){e.trigger("end")});
e.trigger("start");b.timeout&&(this._timeout=setTimeout(this.onTimeout.bind(this),b.timeout));b.jsonp&&this.createJsonp();!1===e.trigger("before-send",b,k)&&this.$$promise.reject();b.beforeSend&&!1===b.beforeSend.call(b.context,b,k)&&this.$$promise.reject();this.$$promise.isPending()?(V(k.send,k),this.$$promise.always(this.asyncDestroy,this)):V(this.asyncDestroy,this,[],1E3)},asyncDestroy:function(){this.$isDestroyed()||(this.$$promise.hasListeners()?V(this.asyncDestroy,this,[],1E3):this.$destroy())},
abort:function(a){this.$$promise.reject(a||"abort");this._transport.abort();return this},onTimeout:function(){this.abort("timeout")},getTransport:function(){return this._transport},createForm:function(){var a=document.createElement("form");a.style.display="none";M(a,"method",this._opt.method);M(a,"enctype","multipart/form-data");p(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},importFiles:function(){var a=this._opt,b=a.files,e=this._form;a=a.data;var d,c;var f=
0;for(d=b.length;f<d;f++){var h=b[f];if(I(h)){var k=h[0];h=h[1]}else k=window.File&&h instanceof File?h.uploadName||"upload"+(1<d?"[]":""):h.name||"upload"+(1<d?"[]":"");if(!(window.File&&h instanceof File)){var m=h;h=null}if(e)m&&e.appendChild(m);else if(h)a.append(k,h);else if(m.files&&m.files.length)for(h=0,c=m.files.length;h<c;h++)a.append(k,m.files[h])}},createJsonp:function(){var a=this._opt,b=a.jsonpParam||"callback",e=a.jsonpCallback||"jsonp_"+W();a.url+=(c.test(a.url)?"&":"?")+b+"="+e;this._jsonpName=
e;"undefined"!=typeof window&&(window[e]=this.jsonpCallback.bind(this));"undefined"!=typeof global&&(global[e]=this.jsonpCallback.bind(this));return e},jsonpCallback:function(a){try{var b=this.processResponseData(a)}catch(A){T(A);this.$$promise&&this.$$promise.reject(A);return}this.$$promise&&this.$$promise.resolve(b)},processResponseData:function(a,b){var d=this._opt;a=k(a,d,b);e.hasListener("process-response")&&e.trigger("process-response",a,this.$$promise);d.processResponse&&(a=d.processResponse.call(d.context,
a,this.$$promise));return a},returnResponse:function(a,b){return this._opt.jsonp?null:this.processResponseData(a,b)},processResponse:function(a,b){var e=this.$$promise;if(this._opt.jsonp)if(a){try{n(a)}catch(t){T(t),e.reject(t)}e.isPending()&&e.reject(Error("jsonp script didn't invoke callback"))}else e.reject(Error("jsonp script is empty"));else{try{var d=this.processResponseData(a,b)}catch(t){T(t);e.reject(t);return}e.resolve(d)}},onDestroy:function(){this._timeout&&clearTimeout(this._timeout);
this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.$destroy();this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},{prepareUrl:m,global:e})}(),Ha=function(){var c={url:null,data:null,method:"GET",headers:null,username:null,password:null,dataType:null,timeout:0,contentType:null,contentTypeHeader:null,xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,
transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,context:null,files:null},a={},b=function(b,e){e=e||{};b&&!w(b)?e=b:e.url=b;if(!e.url&&(e.form&&(e.url=z(e.form,"action")),!e.url))throw Error("Must provide url");q(e,a,!1,!0);q(e,c,!1,!0);e.method=e.method?e.method.toUpperCase():e.form?z(e.form,"method").toUpperCase()||"GET":"GET";return new Ga(e)};b.setup=function(b){q(a,b,!0,!0)};b.on=function(){Ga.global.on.apply(Ga.global,arguments)};
b.un=function(){Ga.global.un.apply(Ga.global,arguments)};b.get=function(a,e){e=e||{};e.method="GET";return b(a,e)};b.post=function(a,e){e=e||{};e.method="POST";return b(a,e)};b.load=function(a,e,c){c=c||{};w(e)||(c=e);c.dataType="fragment";return b(e,c).done(function(b){if(c.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};b.loadScript=function(a){return b(a,{transport:"script"})};b.submit=function(a,e){e=e||{};e.form=a;return b(null,e)};b.prepareUrl=function(a,b){return Ga.prepareUrl(a,
b||{})};return b}(),Ia=n.app.Template=function(){var c=new la,a=new Da,b={},d=function(a,b){a=e(b.trim());if(!a)return"";if("string"===typeof a)return a;b=window.document.createElement("div");b.appendChild(Pa(a));return b.innerHTML},e=function(e){var c=a.get(e),f=b[e]||{};"function"===typeof c&&(c=c(e));if("string"!==typeof c||f.text)c&&c.nodeType&&11!==c.nodeType&&(c="content"in c?c.content:ea(c.childNodes),a.add(e,c));else{if(!f.processed){if("\x3c!--{"===c.substr(0,5)){var h=c.indexOf("--\x3e");
f=F.get(c.substr(4,h-4),{});b[e]=f;c=c.substr(h+3)}b[e]||(b[e]={});f=b[e];f.processed=!0;f.includes&&(c=c.replace(/\x3c!--\s*include (.+?)--\x3e/ig,d));c=f.text?c:ea(c)}c=ea(c);a.add(e,c)}return c},f=function(a){var e;if(e=n.prebuilt.templates[a])return delete n.prebuilt.templates[a],n.prebuilt.templateOptions[a]&&(b[a]=n.prebuilt.templateOptions[a],delete n.prebuilt.templateOptions[a]),e},k=function(b){return a.exists(b)?a.get(b):a.add(b,Ha(b,{dataType:"fragment"}).then(function(e){return a.add(b,
e)}))};n.prebuilt&&n.prebuilt.templates&&a.addFinder(f);a.addFinder(function(a){a=window.document.getElementById(a);if(a){var b=a.tagName.toLowerCase();return"script"===b?(b=a.innerHTML,a.parentNode.removeChild(a),b):a}});return C({_watcher:null,_tpl:null,_renderer:null,_initial:!0,_fragment:null,_id:null,_originalNode:null,_intendedShadow:!1,_prevEl:null,_nextEl:null,scope:null,node:null,tpl:null,url:null,html:null,ownRenderer:!0,initPromise:null,tplPromise:null,parentRenderer:null,deferRendering:!1,
replace:!1,shadow:!1,animate:!1,passAttrs:null,$init:function(a){q(this,a,!0,!1);window.document.documentElement.createShadowRoot||(this._intendedShadow=this.shadow,this.shadow=!1);this.id=W();this.scope||(this.scope=new ta);c.createEvent("rendered-"+this.id,{returnResult:!1,autoTrigger:!0});this.tpl&&(this.tpl=this.tpl.trim());this.url&&(this.url=this.url.trim());a=this.node;var b=this.tpl||this.url;if(this.replace&&a&&a.parentNode){var e=cb(a,this.id);this._prevEl=e[0];this._nextEl=e[1]}this.shadow&&
(this._originalNode=a,this.node=a=a.createShadowRoot());a||(this.deferRendering=!0);if(b){a&&a.firstChild&&!this.shadow&&P(a,"mjs-transclude",ea(a.childNodes));if("this."===b.substr(0,5)||F.isPrebuiltKey(b))this._watcher=ja.get(this.scope,b,this.onChange,this),a=this._watcher.getValue(),"string"!==typeof a&&q(this,a,!0,!1);this.resolveTemplate();this.deferRendering&&this.ownRenderer||this.tplPromise.done(this.applyTemplate,this)}else this.html?(this._watcher=ja.get(this.scope,this.html,this.onHtmlChange,
this),this.initPromise=new G,this.onHtmlChange()):!this.deferRendering&&this.ownRenderer&&this.doRender();if(this.ownRenderer&&this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this);this.scope.$on("destroy",this.onScopeDestroy,this)},setAnimation:function(a){this.animate=a},doRender:function(){this._renderer||(this._renderer=new hb(this.node,this.scope,null,this.passAttrs),this._renderer.on("rendered",this.onRendered,this),this._renderer.on("first-node",this.onFirstNodeReported,
this),this._renderer.process())},onFirstNodeReported:function(a){c.trigger("first-node-"+this.id,a)},onRendered:function(){c.trigger("rendered-"+this.id,this)},on:function(a,b,e){return c.on(a+"-"+this.id,b,e)},un:function(a,b,e){return c.un(a+"-"+this.id,b,e)},startRendering:function(){var a=this.tpl||this.url;if(this.deferRendering&&(this.node||!1===this.node)){this.deferRendering=!1;if(this.tplPromise)return this.tplPromise.done(a?this.applyTemplate:this.doRender,this),this.initPromise;a?this.applyTemplate():
this.doRender()}return null},resolveTemplate:function(){var a=this,b=a.url,d=a._watcher?a._watcher.getValue():a.tpl||b;a._watcher&&!d&&(b=null);d&&"string"!==typeof d&&(d=d.tpl||d.url,b=null);a.initPromise=new G;a.tplPromise=new G;a.ownRenderer&&a.initPromise.resolve(!1);return(new G(function(a,c){d||b?b?a(e(d)||k(b)):a(e(d)||ea(d)):c()})).done(function(b){a._fragment=b;a.tplPromise.resolve()}).fail(a.initPromise.reject,a.initPromise).fail(a.tplPromise.reject,a.tplPromise)},onHtmlChange:function(){var a=
this.node;this._renderer&&(this._renderer.$destroy(),this._renderer=null);var b=this._watcher.getValue();if(b)this._fragment=ea(b),this.applyTemplate();else if(a)for(;a.firstChild;)a.removeChild(a.firstChild)},onChange:function(){var a=this.node;this._renderer&&(this._renderer.$destroy(),this._renderer=null);if(this._watcher.getValue())this.resolveTemplate().done(this.applyTemplate,this);else if(a)for(;a.firstChild;)a.removeChild(a.firstChild)},doApplyTemplate:function(){var a=this.node,b;if(a)if(this.replace){var e=
this._nextEl;for(b=this._prevEl;b.parentNode&&b.nextSibling&&b.nextSibling!==e;)b.parentNode.removeChild(b.nextSibling)}else if(a.firstChild)for(;a.firstChild;)a.removeChild(a.firstChild);this._intendedShadow&&this.makeTranscludes();if(this.replace){e=Pa(this._fragment);b=X(e.childNodes);if(a&&a.nodeType){var d=a?P(a,"mjs-transclude"):null;if(d){var f=L("[{transclude}], [mjs-transclude], mjs-transclude",e,!0);f.length&&P(f[0],"mjs-transclude",d)}a.parentNode&&a.parentNode.removeChild(a)}this._nextEl.parentNode.insertBefore(e,
this._nextEl);this.node=b;this.initPromise.resolve(b)}else a?a.appendChild(Pa(this._fragment)):this.node=a=Pa(this._fragment),this.initPromise.resolve(a);c.trigger("before-render-"+this.id,this);this.ownRenderer&&this.doRender()},applyTemplate:function(){var a=this.node,b=new G;!this._initial&&this.animate?(fa(a,"leave").done(this.doApplyTemplate,this).done(b.resolve,b),fa(a,"enter")):(this.doApplyTemplate(),b.resolve());this._initial=!1;return b},makeTranscludes:function(){var a=this._fragment,b=
L("content",a),e,d;var c=0;for(d=b.length;c<d;c++){var f=window.document.createElement("transclude");var k=b[c];var n=k.nextSibling;(e=z(k,"select"))&&M(f,"select",e);a.removeChild(k);a.insertBefore(f,n)}},onParentRendererDestroy:function(){this.$destroyed||!this._renderer||this._renderer.$destroyed||this._renderer.$destroy();this.$destroy()},onScopeDestroy:function(){this.$destroy()},onDestroy:function(){this._nextEl&&this._nextEl.parentNode&&this._nextEl.parentNode.removeChild(this._nextEl);this._prevEl&&
this._prevEl.parentNode&&this._prevEl.parentNode.removeChild(this._prevEl);this.shadow&&this._originalNode.createShadowRoot();this._watcher&&(this.html?this._watcher.unsubscribe(this.onHtmlChange,this):this._watcher.unsubscribe(this.onChange,this),this._watcher.$destroy(!0))}},{cache:a})}(),xa=n.app.resolve=function(c,a,b,d,e){a=a||{};e=e||[];b=b||a.scope;d=d||a.node;var f=a.config||null;a.config=f;a.scope=a.scope||b;a.node=a.node||d;0===e.length&&e.push(a);f&&(f.setType("cloak","bool",D.MODE_STATIC),
f.setType("animate","bool",D.MODE_STATIC));var k=w(c)?na.get(c):c;if(!k)throw Error("Component "+c+" not found");b&&k.$isolateScope&&(a.scope=b=b.$newIsolated());var h,m=[];c=k.template||a.template||null;var p=k.templateUrl||a.templateUrl||null,n=b?b.$app:null,u=Bb.global(),r=n?n.inject:u.inject,v=n?n:u,A=f?f.get("cloak"):null,E={$node:d||null,$scope:b||null,$config:f||null,$args:e||null};if(k.resolve)for(h in k.resolve)(function(c){var p=new G;m.push(p.done(function(b){E[c]=b;a[c]=b;e.push(b)}));
var n=k.resolve[h];B(n)?p.resolve(n(b,d,f)):p.resolve(r.call(v,n,null,q({},E,a,!1,!1)));p.fail(function(a){a instanceof Error&&T(a)})})(h);if(c||p)a.template=new Ia({scope:b,node:d,deferRendering:!0,ownRenderer:!0,shadow:k.$shadow,tpl:c,url:p,animate:f?f.get("animate"):!1}),m.push(a.template.initPromise),d&&d.firstChild&&P(d,"mjs-transclude",ea(d.childNodes));if(m.length){var t=new G;G.all(m).done(function(b){t.resolve(r.call(v,k,null,q({},E,a,!1,!1),e))}).fail(t.reject,t)}else t=G.resolve(r.call(v,
k,null,q({},E,a,!1,!1),e));d&&t.isPending()&&null!==A&&(!0!==A?N(d,A):d.style.visibility="hidden",t.then(function(){!0!==A?S(d,A):d.style.visibility=""}));d&&t.then(function(){S(d,"mjs-cloak")});return t};(function(){var c=function(a,b,d,e,c){d.setDefaultMode("value",D.MODE_STATIC);d.setType("sameScope","bool",D.MODE_STATIC);d.setType("isolateScope","bool",D.MODE_STATIC);d.setDefaultMode("as",D.MODE_STATIC);c=d.get("value");var f="string"===typeof c?na.get(c,!0):c,h=d.getAll();if(!f)throw Error("Component "+
c+" not found");var m=h.sameScope||f.$sameScope;a=h.isolateScope||f.$isolateScope?a.$newIsolated():m?a:a.$new();d={scope:a,node:b,config:d,parentRenderer:e,destroyScope:!m};xa(c,d,a,b,[d]);return f.$resumeRenderer||!!f.$shadow};c.$breakScope=!1;y.registerAttribute("cmp",200,c)})();var ya=n.lib.Queue=function(){var c=function(a){a=a||{};this._queue=[];this._map={};this.id="$$"+W();this._f=this._finish.bind(this);for(var b in a)this[b]=a[b]};c.REPLACE=1;c.ONCE=2;c.MULTIPLE=3;c.ONCE_EVER=4;q(c.prototype,
{_queue:null,_map:null,_nextRequested:!1,_running:!1,length:0,id:null,async:!0,auto:!0,thenable:!1,stack:!1,context:null,mode:c.MULTIPLE,add:function(a,b,d,e,f,k){var h=this.id,m=a[h]||W();b={id:m,fn:a,context:b,args:d,async:k};e=e||this.mode;if(e===c.ONCE_EVER&&a[h])return a[h];a[h]=m;if(this._map[m])if(e===c.REPLACE)this.remove(m);else if(e===c.ONCE)return m;this._queue[f?"unshift":"push"](b);this._map[m]=b;this.length=this._queue.length;this.auto&&this.next();return m},append:function(a,b,d,e,
c){return this.add(a,b,d,e,!1,c)},prepend:function(a,b,d,e,c){return this.add(a,b,d,e,!0,c)},remove:function(a){var b=this._queue,d;var e=0;for(d=b.length;e<d;e++)if(b[e].id===a){b.splice(e,1);break}delete this._map[a]},isEmpty:function(){return 0===this.length},isRunning:function(){return this._running},next:function(){var a=this,b;if(a._running)a._nextRequested=!0;else{a._nextRequested=!1;var d=a._queue[a.stack?"pop":"shift"]();a.length=a._queue.length;if(d){a._running=!0;delete a._map[d.id];var e=
function(){try{b=d.fn.apply(d.context||a.context,d.args||[])}catch(k){T(k)}finally{Y(b)?(b.catch(T),b.then(a._f,a._f)):a._finish()}},c=d.async||a.async||!1;!c&&e();"raf"===c&&U(e);c&&"raf"!==c&&V(e,null,null,1===ha(c)?c:0)}}},_finish:function(){this._running&&(this._running=!1,(this.auto||this._nextRequested)&&this.next())},$destroy:function(){this.context=this._map=this._queue=null;this._running=this._nextRequested=!1;this.next=J}},!0,!1);return c}(),ib=n.app.ListRenderer=C({id:null,cfg:null,model:null,
itemName:null,tpl:null,renderers:null,parentEl:null,prevEl:null,nextEl:null,trackBy:null,trackByWatcher:null,animateMove:!1,animate:!1,trackByFn:null,griDelegate:null,tagMode:!1,queue:null,buffered:!1,bufferPlugin:null,$constructor:function(c,a,b,d,e){b.setDefaultMode("trackBy",D.MODE_STATIC);d=b.getAll();this.cfg=b;this.scope=c;this.tagMode="mjs-each"===a.nodeName.toLowerCase();this.animateMove=!this.tagMode&&!d.buffered&&d.animateMove&&zb();this.animate=!this.tagMode&&!d.buffered&&d.animate;this.id=
d.id||W();this.animate&&this.$plugins.push(d.animatePlugin||"MetaphorJs.plugin.ListAnimated");d.observable&&this.$plugins.push(d.observable||"MetaphorJs.plugin.Observable");d.buffered&&!this.tagMode&&(this.buffered=!0,this.$plugins.push(d.buffered||"MetaphorJs.plugin.ListBuffered"));d.plugin&&this.$plugins.push(d.plugin);!1===b.get("trackby")&&(this.trackBy=!1)},$init:function(c,a,b,d,e){var f=this.tagMode?z(a,"value"):b.getExpression("value");this.parseExpr(f);this.tpl=this.tagMode?ea(a.childNodes):
a;this.renderers=[];f=cb(a,"list -"+this.id);this.prevEl=f[0];this.nextEl=f[1];this.parentEl=a.parentNode;this.node=null;this.queue=new ya({async:!1,auto:!0,thenable:!0,stack:!1,context:this,mode:ya.ONCE});this.parentEl.removeChild(a);this.afterInit(c,a,b,d,e);this.queue.add(this.render,this,[X(this.watcher.getValue())])},afterInit:function(c,a){a=this.cfg;this.watcher=ja.get(c,this.model,this.onChange,this);this.trackBy=a.get("trackBy");!1!==this.trackBy&&(this.trackBy&&"$"!==this.trackBy?this.trackByWatcher=
ja.get(c,this.trackBy,this.onChangeTrackBy,this):"$"===this.trackBy||this.watcher.hasInputPipes()||(this.trackBy="$$"+this.watcher.id));this.griDelegate=this.scopeGetRawIndex.bind(this)},trigger:J,render:function(c){var a=this.renderers,b=this.tpl,d;var e=0;for(d=c.length;e<d;e++)a.push(this.createItem(b.cloneNode(!0),c,e));this.doRender()},doRender:function(){var c=window.document.createDocumentFragment(),a=this.renderers,b=this.tagMode,d;var e=0;for(d=a.length;e<d;e++)a[e].hidden||(b?c.appendChild(ea(a[e].el)):
c.appendChild(a[e].el),a[e].attached=!0);this.parentEl.insertBefore(c,this.nextEl);this.doUpdate();this.trigger("render",this)},doUpdate:function(c,a,b,d){var e=this.renderers;c=c||0;var f=e.length;a=a||f-1;var k=this.watcher.getValue(),h=this.getTrackByFunction();for(a>f-1&&(a=f-1);c<=a;c++)b&&e[c].action!==b||this.renderItem(c,e,k,h,d)},renderItem:function(c,a,b,d,e){b=b||this.watcher.getValue();a=a||this.renderers;d=d||this.getTrackByFunction();var f=a[c],k=f.scope;a=a.length-1;var h=!(c%2);e&&
f.rendered||(k.$index=c,k.$first=0===c,k.$last=c===a,k.$even=h,k.$odd=!h,k.$trackId=d(b[c]),k.$getRawIndex=this.griDelegate,f.renderer?k.$check():(f.renderer=new hb(f.el,k),f.renderer.process(),f.rendered=!0))},createItem:function(c,a,b){var d=this.itemName,e=this.scope.$new(),f=this.tagMode;e.$on("changed",this.scope.$check,this.scope);e[d]=this.getListItem(a,b);c=f?X(c.childNodes):c;return{index:b,action:"enter",el:c,firstEl:f?c[0]:c,lastEl:f?c[c.length-1]:c,scope:e,attached:!1,rendered:!1,hidden:!1}},
onChange:function(c,a){this.queue.prepend(this.applyChanges,this,[a],ya.REPLACE)},applyChanges:function(c){var a=this.renderers,b=this.tpl,d=0,e=X(this.watcher.getValue()),f=null,k=this.animateMove,h=[],m=this.itemName,p=a.slice(),n=!1;if(!1===this.trackBy){a=this.renderers.slice();f=0;n=!1;var u=0;for(c=e.length;u<c;u++){var r=this.createItem(b.cloneNode(!0),e,u);h.push(r)}}else{var v=c.length;r=e.length;var A=Array(v+1);var q=Array(v+1),t,x,w=0;if(v==r&&0===v)v={changes:0,distance:0,prescription:[]};
else{for(t=0;t<=v;t++)A[t]=Array(r+1),q[t]=Array(r+1),A[t][0]=t,q[t][0]="D";for(t=0;t<=r;t++)A[0][t]=t,q[0][t]="I";for(t=1;t<=v;t++)for(x=1;x<=r;x++){var y=Ra(c[t-1],e[x-1])?0:1;A[t][x-1]<A[t-1][x]&&A[t][x-1]<A[t-1][x-1]+y?(A[t][x]=A[t][x-1]+1,q[t][x]="I"):A[t-1][x]<A[t-1][x-1]+y?(A[t][x]=A[t-1][x]+1,q[t][x]="D"):(A[t][x]=A[t-1][x-1]+y,q[t][x]=1===y?"R":"-")}var z=[];t=v;x=r;do y=q[t][x],z.push(y),"-"!==y&&w++,"R"===y||"-"===y?(t--,x--):"D"===y?t--:x--;while(0!==t||0!==x);v={changes:w/z.length,distance:A[v][r],
prescription:z.reverse()}}v=v.prescription;r=this.getTrackByFunction();A=[];x={};w=0;for(q=c.length;w<q;w++)(t=r(c[w]))&&(x[t]=w);y=0;z={};w=0;for(q=v.length;w<q;w++)c=v[w],"D"!==c&&(t=r(e[y]),void 0!==t&&!0!==z[t]&&void 0!==(u=x[t])?(A.push(u),z[t]=!0):A.push(c),y++);v=A;u=0;for(c=v.length;u<c;u++)r=v[u],1===ha(r)?(A=r,r=a[A],A!==d&&null===f&&(f=u),r.action="move",r.scope[m]=this.getListItem(e,u),n=k,h.push(r),a[A]=null,d++):(null===f&&(f=u),r=this.createItem(b.cloneNode(!0),e,u),h.push(r))}this.renderers=
h;this.reflectChanges({oldRenderers:a,updateStart:f,newRenderers:h,origRenderers:p,doesMove:n})},reflectChanges:function(c){this.applyDomPositions(c.oldRenderers);this.doUpdate(c.updateStart||0);this.removeOldElements(c.oldRenderers);this.trigger("change",this)},removeOldElements:function(c){var a,b,d;var e=0;for(a=c.length;e<a;e++){if((b=c[e])&&b.attached)if(b.attached=!1,!this.tagMode&&b.el.parentNode)b.el.parentNode.removeChild(b.el);else{var f=0;for(d=b.el.length;f<d;f++)b.el[f].parentNode&&b.el[f].parentNode.removeChild(b.el[f])}b&&
b.scope&&b.scope.$destroy()}},applyDomPositions:function(c){c=this.renderers;var a=this.parentEl,b=this.tagMode,d=this.nextEl,e,f;var k=0;for(e=c.length;k<e;k++){var h=c[k];var m=h.el;var p=null;if(h.hidden)m.parentNode&&(b?m.parentNode.removeChild(ea(m)):m.parentNode.removeChild(m),h.attached=!1);else{for(f=Math.max(k-1,0);0<=f;f--)if(c[f].attached){p=c[f].lastEl.nextSibling;break}p||(p=d);h.firstEl!==p&&(p&&h.lastEl.nextSibling!==p?a.insertBefore(b?ea(m):m,p):p||a.appendChild(b?ea(m):m));h.attached=
!0}}},getListItem:function(c,a){return c[a]},onChangeTrackBy:function(c){this.trackByFn=null;this.trackBy=c},getTrackByFunction:function(){var c;this.trackByFn||((c=this.trackBy)&&"$"!==c?B(c)?this.trackByFn=c:this.trackByFn=function(a){return a&&!bb(a)?a[c]:void 0}:this.trackByFn=function(a){return bb(a)?a:void 0});return this.trackByFn},scopeGetRawIndex:function(c){if(void 0===c)return-1;var a=this.watcher.getValue(),b=this.getTrackByFunction(),d;var e=0;for(d=a.length;e<d;e++)if(b(a[e])===c)return e;
return-1},parseExpr:function(c){c=c.split(" ");var a;var b=0;for(a=c.length;b<a;b++){var d=c[b];if(""!==d&&"in"!==d)if(f){var e=c.slice(b).join(" ");break}else var f=d}this.model=e;this.itemName=f||"item"},onDestroy:function(){var c=this.renderers,a;var b=0;for(a=c.length;b<a;b++)c[b].renderer&&!c[b].renderer.$destroyed&&c[b].renderer.$destroy();this.trackByWatcher&&(this.trackByWatcher.unsubscribe(this.onChangeTrackBy,this),this.trackByWatcher.$destroy(!0));this.queue.$destroy();this.watcher&&(this.watcher.unsubscribe(this.onChange,
this),this.watcher.$destroy(!0))}},{$stopRenderer:!0,$registerBy:"id"});(function(){var c=[],a=function(a,d,e,f,k){e.disableProperty("value");a:{var b="mjs-each"===d.nodeName.toLowerCase()?z(d,"value"):e.getExpression("value");var m=b.split(" in ");b=F.get(1===m.length?b:m[1],a);m=0;for(var p=c.length;m<p;m++)if(b instanceof c[m][0]){b=c[m][1];break a}b=null}return new (b||ib)(a,d,e,f,k)};a.registerType=function(a,d){c.push([a,d])};a.$stopRenderer=!0;a.$registerBy="id";a.$prebuild={skip:!0};a.registerType(Array,
ib);y.registerAttribute("each",100,a);y.registerTag("each",a)})();var za=n.dom.getStyle=function(c,a,b){if(window.getComputedStyle){if(c===window)return a?b?0:null:{};c=window.getComputedStyle(c,null)}else c=c.currentStyle||c.style||{};a=a?c[a]:c;return b?parseFloat(a)||0:a},Zb=function(){var c;return function(){if(void 0===c){var a=window.document,b=a.createElement("div"),d=a.createElement("div");a=a.body;d.style&&window.getComputedStyle?(b.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",
b.appendChild(d),d.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",d.innerHTML="",a.appendChild(b),d="4px"===window.getComputedStyle(d,null).width,a.removeChild(b),c=d):c=!1}return c}}(),Wa=function(c,a){var b=/^([+-]?(?:d*.|)d+(?:[eE][+-]?d+|))(?!px)[a-z%]+$/i,d=["Top","Right","Bottom","Left"],e=c?"inner"===c?"padding":"":"content";return function(c,k){if(c===window)return c.document.documentElement["client"+
a];if(9===c.nodeType)return k=c.documentElement,Math.max(c.body["scroll"+a],k["scroll"+a],c.body["offset"+a],k["offset"+a],k["client"+a]);a:{var f=a.toLowerCase(),m=e||(!0===k?"margin":"border");k=za(c);var p=!0,n="width"===f?c.offsetWidth:c.offsetHeight,u="border-box"===k.boxSizing;if(0>=n||null==n){n=c.style[f];if(b.test(n)){k=n;break a}p=u&&(Zb()||n===c.style[f]);n=parseFloat(n)||0}c=n;m=m||(u?"border":"content");f=m===(p?"border":"content")?4:"width"===f?1:0;for(u=0;4>f;f+=2)"margin"===m&&(u+=
parseFloat(k[m+d[f]])),p?("content"===m&&(u-=parseFloat(k["padding"+d[f]])),"margin"!==m&&(u-=parseFloat(k["border"+d[f]+"Width"]))):(u+=parseFloat(k["padding"+d[f]]),"padding"!==m&&(u+=parseFloat(k["border"+d[f]+"Width"])));k=c+u}return k}},jb=n.dom.getWidth=Wa("","Width"),kb=n.dom.getHeight=Wa("","Height"),Eb=function(c){var a=c?"pageYOffset":"pageXOffset",b=c?"scrollTop":"scrollLeft";c=window.document;var d=c.body,e=c.documentElement,f=function(a,b){return 0>a&&!1===b?0:a};var k=void 0!==window[a]?
function(){return window[a]}:e.clientHeight?function(){return e[b]}:function(){return d[b]};return function(a,c){return a&&a!==window?a&&1==a.nodeType&&a!==d&&a!==e?f(a[b],c):f(k(),c):f(k(),c)}},Aa=n.dom.getScrollTop=Eb(!0),Ba=n.dom.getScrollLeft=Eb(!1),$b=n.lib.EventBuffer=function(){var c=function(a,b,d){var e="$$"+b+"_"+d;if(a[e])return a[e];a[e]=this;this.id=e;this.breaks={};this.watchers={};this.node=a;this.event=b;this.observable=new la;this.interval=d||0;this.handlerDelegate=this.handler.bind(this);
this.triggerDelegate=this.trigger.bind(this);this.up()};q(c.prototype,{observable:null,handlerDelegate:null,triggerDelegate:null,watchers:null,breaks:null,running:!1,lastEvent:null,currentEvent:null,interval:null,id:null,handler:function(a){this.running?a&&(this.lastEvent=a):this.next(a)},next:function(a){var b=this.interval;if(a=a||this.lastEvent)this.lastEvent=null,this.running=!0,this.currentEvent=a,"raf"===b?U(this.triggerDelegate):setTimeout(this.triggerDelegate,b)},watchWidth:function(){this.addWatcher("width",
jb)},watchHeight:function(){this.addWatcher("width",kb)},watchScrollTop:function(){this.addWatcher("scrollTop",Aa)},watchScrollLeft:function(){this.addWatcher("scrollLeft",Ba)},addWatcher:function(a,b,d){this.watchers[a]||(this.watchers[a]={fn:b,context:d,prev:null,current:parseInt(b.call(d,this.node),10)})},removeWatcher:function(a){delete this.watchers[a]},breakFilter:function(a,b,d){if(!this.watchers[d.watcher])return!1;var e=a.breakValue,c=a.breakLuft||0,k=e-(a.breakLowLuft||c);a=e+(a.breakHighLuft||
c);c=this.watchers[d.watcher];d=c.current;c=c.prev;var h=Math.min(c,d),m=Math.max(c,d);if("!="===e)return c!=d;b[0].breakPosition=d<k?-1:d>=a?1:0;return h<=k&&k<=m||h<=a&&a<=m},onBreak:function(a,b,d,e,c){var f=a+"_"+b;c=c||{};c.breakValue=b;this.breaks[f]||(this.breaks[f]=this.observable.createEvent(f,{watcher:a,triggerFilter:this.breakFilter,filterContext:this}));this.breaks[f].on(d,e,c)},unBreak:function(a,b,d,e,c){a=a+"_"+b;this.breaks[a]&&(this.breaks[a].un(d,e),this.breaks[a].hasListener()||
(this.observable.destroyEvent(a),this.breaks[a]=null,delete this.breaks[a]));c&&this.destroyIfIdle()},on:function(a,b,d){this.observable.on(this.event,a,b,d)},un:function(a,b,d){this.observable.un(this.event,a,b);d&&this.destroyIfIdle()},trigger:function(){var a=this.currentEvent,b=this.watchers,d=this.breaks,e=this.node,c,k;this.observable.trigger(this.event,a);for(c in b)b[c].prev=b[c].current,b[c].current=parseInt(b[c].fn.call(b[c].context,e,a),10);for(k in d)d[k].trigger(a);this.running=!1;this.currentEvent=
null;this.next()},up:function(){O(this.node,this.event,this.handlerDelegate)},down:function(){da(this.node,this.event,this.handlerDelegate)},destroyIfIdle:function(){if(this.observable&&!this.observable.hasListener())return this.$destroy(),!0},$destroy:function(){delete this.node[this.id];this.down();this.observable.$destroy()}});c.get=function(a,b,d){var e="$$"+b+"_"+d;return a[e]?a[e]:a[e]=new c(a,b,d)};return c}();n.lib.EventHandler=function(c,a,b,d){this.config=d;this.event=c;this.prevEvent={};
this.scope=a;this.node=b;this.buffer=this.handler=null;if(d.hasExpression("if"))d.on("if",this.onIfChange,this);this.up()};q(n.lib.EventHandler.prototype,{onIfChange:function(c){this[c?"up":"down"]()},createHandler:function(){var c=this,a=c.scope,b,d=function(b){if(!c.$destroyed&&!c.$destroying){var e,d=!1,h=void 0,m=!1,p=c.config.getAll(),n=c.config.get("value");void 0!==p.preventDefault&&(d=p.preventDefault);void 0!==p.stopPropagation&&(m=p.stopPropagation);void 0!==p.returnValue&&(h=p.returnValue);
void 0!==p.keyCode&&(e=p.keyCode);b=aa(b||window.event);if(e&&("number"===typeof e&&e!==b.keyCode||-1===e.indexOf(b.keyCode)))return null;a.$event=b;a.$eventNode=c.node;a.$prevEvent=c.prevEvent[b.type];n&&(e=n.call(p.context||null,a))&&ia(e)&&(void 0!==e.preventDefault&&(d=e.preventDefault),void 0!==e.stopPropagation&&(m=e.stopPropagation),void 0!==e.returnValue&&(h=e.returnValue));m&&b.stopPropagation();d&&b.preventDefault();if(c.$destroyed||c.$destroying)return void 0!==h?h:void 0;a.$event=null;
a.$eventNode=null;c.prevEvent[b.type]=b;c.config.checkScope("value");if(void 0!==h)return h}};return(b=c.config.get("async"))?function(a){V(d,null,[a],"number"==typeof b?b:null)}:d},up:function(){var c=this.config,a=c.get("buffer");if(!c.hasExpression("if")||c.get("if"))this.handler=this.createHandler(),a?(this.buffer=$b.get(this.node,this.event,a),this.buffer.on(this.handler)):O(this.node,this.event,this.handler)},down:function(){this.buffer?(this.buffer.un(this.handler),this.buffer.destroyIfIdle(),
this.buffer=null):da(this.node,this.event,this.handler)},$destroy:function(){this.down();this.config.clear()}});var ac=n.lib.EventHandler;(function(){var c="click dblclick mousedown mouseup mouseover mouseout mousemove keydown keyup keypress change focus blur copy cut paste load mousewheel touchstart touchend touchcancel touchleave touchmove".split(" "),a,b=function(a){a.setProperty("preventDefault",{type:"bool",defaultValue:!0,defaultMode:D.MODE_STATIC});a.setType("stopPropagation","bool",D.MODE_STATIC);
a.setType("if","bool");a.eachProperty(function(b){"value"!==b&&0!==b.indexOf("value.")||a.setMode(b,D.MODE_FUNC)});return a};var d=0;for(a=c.length;d<a;d++)(function(a){y.registerAttribute(a,1E3,function(e,d,c,m,p){var f=new ac(a,e,d,b(c));return function(){f.$destroy();f=null}})})(c[d]);y.registerAttribute("submit",1E3,function(a,d,c){b(c);var e=c.get("value"),f=function(){e(a);c.checkScope("value")};va.get(d).onKey(13,f);return function(){va.get(d).unKey(13,f);e=f=null}});c=null})();y.registerAttribute("show",
500,y.$extend({$class:"MetaphorJs.app.Directive.attr.Show",initial:!0,initialSet:function(){this.config.setType("animate","bool",D.MODE_STATIC);this.$super()},runAnimation:function(c){var a=this,b=a.node.style,d=function(){b.display=c?a.config.get("display")||"":"none"};a.initial||!a.config.get("animate")?d():fa(a.node,c?"show":"hide",function(){if(c)return new G(function(e){U(function(){b.display=a.config.get("display")||"";e()})})}).done(d)},onChange:function(c){this.runAnimation(c);this.initial=
!1;this.$super(c)}}));y.registerAttribute("hide",500,y.attr.Show.$extend({$class:"MetaphorJs.app.Directive.attr.Hide",onChange:function(c){this.runAnimation(!c);this.initial=!1;this.saveStateOnChange(c)}}));y.registerAttribute("if",500,y.$extend({$class:"MetaphorJs.app.Directive.attr.If",parentEl:null,prevEl:null,nextEl:null,el:null,initial:!0,cfg:null,animate:!1,$init:function(c,a,b,d,e){b.setType("value","bool");b.setType("once","bool",D.MODE_STATIC);this.createCommentWrap(a,"if");this.$super(c,
a,b,d,e)},onScopeDestroy:function(){this.wrapperClose=this.wrapperOpen=null;this.$super()},onChange:function(){var c=this,a=c.config.get("value"),b=c.wrapperOpen.parentNode,d=c.node,e=function(){b.insertBefore(d,c.wrapperClose)},f=function(){b.removeChild(d)};a?c.initial||!c.config.get("animate")?e():fa(d,"enter",e):d.parentNode&&(c.initial||!c.config.get("animate")?f():fa(d,"leave").done(f));c.$super(a);c.initial?c.initial=!1:c.config.get("once")&&c.$destroy()}}));y.registerAttribute("in-focus",
500,y.$extend({$class:"MetaphorJs.app.Directive.attr.InFocus",initialSet:function(){this.config.setType("value","bool");this.$super()},onChange:function(c){c&&V(this.node.focus,this.node,[],300)}}));y.registerAttribute("include",1100,function(c,a,b,d,e){b.disableProperty("value");b.setType("asis","bool",D.MODE_STATIC);b.setType("animate","bool",D.MODE_STATIC);e=b.get("html");c={scope:c,node:a,parentRenderer:d,animate:b.get("animate"),ownRenderer:!b.get("asis")};e?c.html=e:c.url=b.getExpression("value");
var f=new Ia(c);d.on("destroy",function(){f.$destroy();f=null});return!1});y.registerAttribute("init",250,function(){var c=function(a,b,d){d.eachProperty(function(b,d){"value"!==b&&0!==b.indexOf("value.")||F.run(d.expression,a,null,{noReturn:!0})});d.clear()};c.$prebuild={noReturn:!0};return c}());(function(){var c={enter:13,esc:27,backspace:8};y.registerAttribute("key",1E3,function(a,b,d,e,f){d.disableProperty("value");d.eachProperty(function(a,b){0===a.indexOf("value.")&&"{"!==b.expression.charAt(0)&&
d.setMode(a,D.MODE_FUNC)});e=function(e,d){"function"===typeof d&&(d={handler:d});var f=d.handler,h=d.context||a;delete d.handler;delete d.context;d.keyCode||(d.keyCode=c[e]||parseInt(e,10));var k=function(b){a.$event=b;f(a);a.$event=null;a.$check()};va.get(b).onKey(d,k,h);return function(){va.get(b).unKey(d,k,h)}};f=d.getAllValues();var k,h=[];for(k in f)f.hasOwnProperty(k)&&f[k]&&h.push(e(k,f[k]));return function(){var a;var b=0;for(a=h.length;b<a;b++)h[b]();h=null}})})();y.registerAttribute("model",
1E3,y.$extend({$class:"MetaphorJs.app.Directive.attr.Model",inProg:!1,input:null,binding:null,updateRoot:!1,changeCb:null,initial:!1,autoOnChange:!1,$init:function(c,a,b,d,e){var f=b.getExpression("value"),k=F.describeExpression(f);b.setMode("value",D.MODE_FNSET);b.setProperty("checkRoot",{type:"bool",defaultValue:-1!==k.indexOf("r")});b.setProperty("checkParent",{type:"bool",defaultValue:-1!==k.indexOf("p")});b.setProperty("binding",{defaultValue:"both",mode:D.MODE_STATIC});b.hasExpression("change")&&
(this.changeFn=F.func(b.get("change")));this.node=a;this.input=va.get(a,c);this.binding=b.get("binding");this.mo=ja.get(c,f,null,null,{setter:!0});this.mo.subscribe(this.onChange,this);this.input.onChange(this.onInputChange,this);this.$super(c,a,b,d,e);c=this.input.getValue();a=this.mo.getValue();this.initial=!0;if(a!==c)if("input"!==this.binding&&void 0!==a)this.onChange(a);else if("scope"!==this.binding&&void 0!==c)this.onInputChange(c);this.initial=!1},initialSet:J,onInputChange:function(c){var a=
this.scope;"scope"!==this.binding&&(c&&w(c)&&-1!==c.indexOf("\\{")&&(c=c.replace(/\\{/g,"{")),this.mo.getValue()!=c&&(this.mo.setValue(c),this.inProg=!0,a instanceof ta?this.config.get("checkRoot")?a.$root.$check():this.config.get("checkParent")?a.$parent?a.$parent.$check():a.$root.$check():a.$check():this.config.check("value"),this.inProg=!1))},onDestroy:function(){this.input.$destroy();this.mo&&(this.mo.unsubscribe(this.onChange,this),this.mo.$destroy(!0));this.$super()},onChange:function(){var c=
this.mo.getValue(),a=this.binding,b;"input"===a||this.inProg||(window.document.activeElement!==this.node&&(this.binding="scope"),(b=Ua())&&8>b?V(this.input.setValue,this.input,[c]):this.input.setValue(c),this.binding=a);this.changeFn&&!this.initial&&this.changeFn(this.scope)}},{$prebuild:{skip:!0}}));y.registerAttribute("options",100,y.$extend({$class:"MetaphorJs.app.Directive.attr.Options",model:null,store:null,getterFn:null,defOption:null,prevGroup:null,groupEl:null,fragment:null,$init:function(c,
a,b){b.disableProperty("value");var d=b.getExpression("value");this.parseExpr(d);this.config=b;this.node=a;this.scope=c;for(this.defOption=a.options.length?a.options[0]:null;a.firstChild;)a.removeChild(a.firstChild);this.defOption&&M(this.defOption,"default-option","");try{var e=F.get(this.model,c);C.isInstanceOf(e,"MetaphorJs.model.Store")?this.bindStore(e,"on"):this.watcher=ja.get(c,this.model,this.onChange,this)}catch(f){T(f)}this.watcher?this.renderAll():this.store&&this.renderStore()},bindStore:function(c,
a){c[a]("update",this.renderStore,this);this.store=c},renderStore:function(){this.render(this.store.current)},renderAll:function(){this.render(X(this.watcher.getValue()))},onChange:function(){this.renderAll()},renderOption:function(c,a,b){var d=this.groupEl||this.fragment,e=Ua();b.item=c;b.$index=a;c=this.defaultOptionTpl&&ia(c)?c:this.getterFn(b);void 0!==c.group&&(c.group=""+c.group);c.group!==this.prevGroup&&(c.group?(this.groupEl=d=window.document.createElement("optgroup"),M(d,"label",c.group),
c.disabledGroup&&M(d,"disabled","disabled"),this.fragment.appendChild(d)):(d=this.fragment,this.groupEl=null));this.prevGroup=c.group;a=window.document.createElement("option");M(a,"value",c.value||"");a.text=c.name;e&&9>e&&(a.innerHTML=c.name);c.disabled&&M(a,"disabled","disabled");d.appendChild(a)},render:function(c){var a=this.node,b=ua(a),d=this.defOption,e=this.scope.$new(),f=Ua(),k;this.fragment=window.document.createDocumentFragment();for(this.groupEl=this.prevGroup=null;a.firstChild;)a.removeChild(a.firstChild);
var h=0;for(k=c.length;h<k;h++)this.renderOption(c[h],h,e);d&&a.insertBefore(d,a.firstChild);e.$destroy();if(f&&8>f){var m=a.nextSibling;var p=a.parentNode;p.removeChild(a)}a.appendChild(this.fragment);this.fragment=null;f&&8>f&&p.insertBefore(a,m);fb(a,b)},parseExpr:function(c){var a=c.indexOf(" in ");if(-1===a){var b=c;c="{name: this.item, value: this.$index}";this.defaultOptionTpl=!0}else b=c.substr(a+4),c=c.substr(0,a),this.defaultOptionTpl=!1;this.model=b;this.getterFn=F.getter(c)},onDestroy:function(){this.store&&
this.bindStore(this.store,"un");this.$super()}},{$prebuild:{skip:!0}}));(function(){var c="selected checked disabled readonly open required".split(" "),a,b=y.$extend({propName:null,$init:function(a,b,d,c){this.propName=c;d.setType("value","bool");this.$super(a,b,d)},onChange:function(a){var b=this.propName;a?M(this.node,b,b):ka(this.node,b)}});var d=0;for(a=c.length;d<a;d++)(function(a){y.registerAttribute(""+a,1E3,function(e,d,c){return new b(e,d,c,a)})})(c[d])})();y.registerAttribute("ref",200,
function(c,a,b){b.setDefaultMode("value",D.MODE_STATIC);c[b.get("value")]=a});y.registerAttribute("router",200,function(c,a,b,d){b.setProperty("scrollOnChange",{type:"bool",defaultMode:D.MODE_STATIC});b.setProperty("value",{defaultMode:D.MODE_STATIC,defaultValue:"MetaphorJs.app.Router"});b.setDefaultMode("defaultCmp",D.MODE_STATIC);d={scope:c,node:a,config:b};xa(b.get("value"),d,c,a,[d]);return!1});y.registerAttribute("source-src",1E3,y.$extend({$class:"MetaphorJs.app.Directive.attr.SourceSrc",usePreload:!0,
attr:null,lastPromise:null,src:null,$constructor:function(c,a,b,d,e){b.setType("deferred","bool",D.MODE_STATIC);b.setType("noCache","bool",D.MODE_STATIC);b.setDefaultMode("plugin",D.MODE_STATIC);b.get("deferred")&&this.$plugins.push("plugin.SrcDeferred");if(b.get("plugin")){d=b.get("plugin").split(",");var f;e=0;for(f=d.length;e<f;e++)this.$plugins.push(d[e].trim())}this.$super(c,a,b)},onChange:function(){this.doChange()},doChange:function(){if(!this.$destroyed&&!this.$destroying){var c=this.config.get("value");
c&&(this.src=c,this.config.get("noCache")&&(c+=(-1!==c.indexOf("?")?"&amp;":"?")+"_"+(new Date).getTime()),this.node&&(this.doChangeSource(c),this.onSrcChanged()))}},doChangeSource:function(c){var a=this.node,b=L("source",a),d=window.document.createElement("source"),e;if(b.length){var f=0;for(e=b.length;f<e;f++)a.removeChild(b[f])}M(d,"src",c);a.appendChild(d)},onSrcChanged:function(){}}));var Fb=n.dom.preloadImage=function(){function c(e){if(void 0!==a[e])return!1===a[e]?G.reject(e):G.resolve(a[e]);
if(b[e])return b[e];1E3<d&&(a={},d=0);var c=window.document,k=c.createElement("img"),h=k.style,m=new G;b[e]=m;m.always(function(){delete b[e]});O(k,"load",function(){a[e]||(a[e]={src:e,width:k?k.width:null,height:k?k.height:null},d++);m&&m.resolve(a[e]);k&&k.parentNode&&k.parentNode.removeChild(k);m=h=k=null});O(k,"error",function(){a[e]=!1;k&&k.parentNode&&k.parentNode.removeChild(k);m&&m.reject(e)});m.abort=function(){k&&k.parentNode&&k.parentNode.removeChild(k);m&&m.reject(e);m=h=k=null};h.position=
"absolute";h.visibility="hidden";h.left="-10000px";h.top="0";c.body.appendChild(k);k.src=e;return m}var a={},b={},d=0;c.check=function(e){return void 0!==a[e]?a[e]:b[e]||null};return c}();y.registerAttribute("src",1E3,y.$extend({$class:"MetaphorJs.app.Directive.attr.Src",queue:null,usePreload:!0,noCache:!1,attr:null,lastPromise:null,src:null,$constructor:function(c,a,b,d,e){b.setType("deferred","bool",D.MODE_STATIC);b.setType("noCache","bool",D.MODE_STATIC);b.setType("noPreload","bool",D.MODE_STATIC);
b.setDefaultMode("preloadSize",D.MODE_STATIC);b.setDefaultMode("plugin",D.MODE_STATIC);b.get("deferred")&&this.$plugins.push("MetaphorJs.plugin.SrcDeferred");b.get("preloadSize")&&this.$plugins.push("MetaphorJs.plugin.SrcSize");if(b.get("plugin")){d=b.get("plugin").split(",");var f;e=0;for(f=d.length;e<f;e++)this.$plugins.push(d[e].trim())}this.$super(c,a,b)},$init:function(c,a,b,d,e){if(this.usePreload=!b.get("noPreload"))a.style.visibility="hidden";this.queue=new ya({auto:!0,async:!0,mode:ya.REPLACE,
thenable:!0});this.$super(c,a,b,d,e)},onChange:function(){this.cancelPrevious();this.usePreload&&(this.node.style.visibility="hidden");this.queue.add(this.doChange,this)},doChange:function(){if(!this.$destroyed&&!this.$destroying){var c=this.config.get("value");c&&(this.src=c,this.config.get("noCache")&&(c+=(-1!==c.indexOf("?")?"&amp;":"?")+"_"+(new Date).getTime()),this.usePreload?(this.lastPromise=Fb(c))&&this.lastPromise.done(this.onImagePreloaded,this):this.node&&(this.node.src=c,M(this.node,
"src",c),this.onSrcChanged()))}},cancelPrevious:function(){this.lastPromise&&(this.lastPromise.isPending()&&this.lastPromise.abort(),this.lastPromise=null)},onImagePreloaded:function(){var c=this,a=c.src;c&&c.node&&U(function(){c.node&&(c.node.src=a,M(c.node,"src",a),c.onSrcChanged(),c.node.style.visibility="",c.scope.$scheduleCheck(50))});c.lastPromise=null},onSrcChanged:function(){},onScopeReset:function(){this.cancelPrevious();this.$super()},onDestroy:function(){this.$destroyed||(this.cancelPrevious(),
this.queue.$destroy(),this.$super())}}));var Qa=n.dom.removeStyle=function(){var c=window.document.createElement("div");return c.style&&c.style.removeProperty?function(a,b){a.style.removeProperty(b)}:function(a,b){a.style.removeAttribute(b)}}();y.registerAttribute("style",1E3,y.$extend({$class:"MetaphorJs.app.Directive.attr.Style",$init:function(c,a,b,d,e){var f=this;b.eachProperty(function(a){if(0===a.indexOf("value."))b.on(a,f.onChange,f)});this.$super(c,a,b)},getCurrentValue:function(){var c=this.config.getAllValues();
c[""]&&(q(c,c[""]),delete c[""]);return c},onChange:function(){var c=this.node,a=c.style,b=this.getCurrentValue(),d=this.prev,e;for(e in d)b&&void 0!==b[e]||Qa(c,e);if(b)for(e in b)d=ab(e),void 0!==b[e]&&null!==b[e]?a[d]=b[e]:Qa(c,e);this.prev=b}}));var Gb=n.dom.transclude=function(c,a){for(var b=c.parentNode,d;b;){d=P(b,"mjs-transclude");if(void 0!==d)break;b=b.parentNode}if(d){c.firstChild&&P(c,"mjs-transclude",ea(c.childNodes));b=c.parentNode;var e=c.nextSibling;d=Pa(d);var f=X(d.childNodes);a?
(b.removeChild(c),b.insertBefore(d,e)):c.appendChild(d);return f}return null};y.registerAttribute("transclude",1E3,function(c,a,b,d,e){return Gb(a)});y.registerAttribute("update-on",1E3,function(c,a,b,d,e){var f=function(a){b.eachProperty(function(e){if(0===e.indexOf("value.")){var d=e.replace("value.","");e=b.get(e);e.$destroyed||e.$destroying||e&&(fn=e[a]||e["$"+a])&&fn.call(e,d,c.$check,c)}})};f("on");return function(){f&&(f("un"),f=cfgs=null)}});var bc=n.app.StoreRenderer=ib.$extend({store:null,
$constructor:function(c,a,b,d,e){var f=b.getAll();f.pullNext&&(f.buffered&&(f.bufferedPullNext=!0,f.buffered=!1),this.$plugins.push("string"===typeof f.pullNext?f.pullNext:"MetaphorJs.plugin.ListPullNext"));this.$super(c,a,b,d,e)},afterInit:function(c,a,b,d,e){this.store=c=F.get(this.model,c);this.watcher=ja.get(c,"this.current",this.onChange,this);!1!==this.trackByFn&&(this.trackByFn=c.getRecordId.bind(c));this.griDelegate=c.indexOfId.bind(c);this.bindStore(c,"on")},bindStore:function(c,a){c[a]("update",
this.onStoreUpdate,this);c[a]("clear",this.onStoreUpdate,this);c[a]("destroy",this.onStoreDestroy,this)},onStoreUpdate:function(){this.watcher.check()},getListItem:function(c,a){return this.store.getRecordData(c[a])},onStoreDestroy:function(){this.watcher&&(this.onStoreUpdate(),this.watcher.unsubscribe(this.onChange,this),this.watcher.$destroy(!0),this.watcher=null)},onDestroy:function(){this.store.$destroyed||this.bindStore(this.store,"un");this.$super()}},{$stopRenderer:!0,$registerBy:"id"}),Hb=
function(){var c=function(a,b,c){if(B(b))return b(a,c);if(""===b||void 0===b)return!0;if(void 0!==a){if(sa(a))return a===b;if(b instanceof RegExp)return b.test(""+a);if("strict"===c)return""+a===""+b;if(!0===c||null===c||void 0===c)return-1!=(""+a).toLowerCase().indexOf((""+b).toLowerCase());if(!1===c)return-1==(""+a).toLowerCase().indexOf((""+b).toLowerCase())}return!1},a=function(a,b,f){if(B(b))return b(a,f);if(bb(a))return void 0===b.$?!0:c(a,b.$,f);var e,d;for(e in b)if("$"===e)for(d in a){if(c(a[d],
b.$,f))return!0}else if(c(a[e],b[e],f))return!0;return!1},b=function(b,e,c){ia(e)||B(e)||(e={$:e});var d=[],f;var m=-1;for(f=b.length;++m<f;)a(b[m],e,c)&&d.push(b[m]);return d};b.compare=a;return b}();n.model=n.model||{};var ma=n.mixin.Observable={$$observable:null,$$callbackContext:null,$$events:null,$beforeInit:function(c){this.$$observable=new la;this.$initObservable(c)},$initObservable:function(c){var a=this.$$observable,b;if(c&&c.callback){var d=c.callback,e=d.context||d.scope||d.$context,f=
q({},this.$$events,d.$events,!0,!1);for(b in f)a.createEvent(b,f[b]);d.context=null;d.scope=null;for(b in d)if(d[b])a.on(b,d[b],e||this);c.callback=null;e&&(this.$$callbackContext=e)}else if(this.$$events)for(b in this.$$events)a.createEvent(b,this.$$events[b])},on:function(){var c=this.$$observable;return c?c.on.apply(c,arguments):null},un:function(){var c=this.$$observable;return c?c.un.apply(c,arguments):null},once:function(){var c=this.$$observable;return c?c.once.apply(c,arguments):null},trigger:function(){var c=
this.$$observable;return c?c.trigger.apply(c,arguments):null},$beforeDestroy:function(){this.$$observable.trigger("before-destroy",this)},$afterDestroy:function(){this.$$observable.trigger("destroy",this);this.$$observable.$destroy();this.$$observable=null}},oa=n.model.Model=function(){var c={},a={};return C({$mixins:[ma],type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,$init:function(a){this.fields||(this.fields={});q(this,{record:{load:null,save:null,"delete":null,id:null,
data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);q(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,d){return this.getProp("record",a,d)},setRecordProp:function(a,d){this.record[a]=d},getStoreProp:function(a,d){return this.getProp("store",a,d)},setStoreProp:function(a,d){this.store[a]=d},getProp:function(a,d,e){a=this[a];return a[d]&&a[d][e]||
a[e]||this[e]||null},setProp:function(a,d){return this[a]=d},_prepareRequestUrl:function(a,d){a=a.replace(/:([a-z0-9_\-]+)/gi,function(a,b){var e=d[b];return void 0!=e?(delete d[b],e):a});return/:([a-z0-9_\-]+)/.test(a)?null:a},_makeRequest:function(a,d,e,c){var b=this,f=b[a],m=q({},w(f[d])||B(f[d])?{url:f[d]}:f[d]),p=b.getProp(a,d,"id"),n=b.getProp(a,d,"root"),u=b.getProp(a,d,"url"),r=b.getProp(a,d,"json"),v={};if(!m)if(u)m={url:u};else throw a+"."+d+" not defined";if(w(m)||B(m))m={url:m};if(!m.url){if(!u)throw a+
"."+d+" url not defined";m.url=u}v.url=m.url;m.ajax&&q(v,m.ajax,!0,!1);if(m.validate&&(u=m.validate.call(b,e,c),!1===u))return G.reject(u);if(m.resolve){if((u=m.resolve.call(b,e,c))&&Y(u))return u;if(u)return G.resolve(u)}v.data=q({},m.data,b.extra,f.extra,f[d]?f[d].extra:null,v.data,c,!0,!0);if(B(m.url)){e=m.url(v.data);var A=new G;e.then(function(e){"record"===a?b._processRecordResponse(d,e,A):"store"===a&&b._processStoreResponse(d,e,A)});return A}e&&p&&(v.data[p]=e);c&&n&&"load"!==d&&(v.data[n]=
c);v.url=b._prepareRequestUrl(v.url,v.data);if(!v.url)return G.reject();v.method||(v.method="controller"!==a?"load"===d?"GET":"POST":"GET");r&&v.data&&"GET"!==v.method&&(v.contentType="text/plain",v.data=JSON.stringify(v.data));v.context=b;if("record"===a){v.processResponse=function(a,e){b.lastAjaxResponse=a;b._processRecordResponse(d,a,e)};var y=b._processRecordRequest(Ha(v),d,e,c)}else"store"===a?(v.processResponse=function(a,e){b.lastAjaxResponse=a;b._processStoreResponse(d,a,e)},y=b._processStoreRequest(Ha(v),
d,e,c)):"controller"===a&&(v.processResponse=function(a,e){b.lastAjaxResponse=a;b._processControllerResponse(d,a,e)},y=b._processControllerRequest(Ha(v),d,e,c));m.processRequest&&m.processRequest.call(b,y,e,c);return y},_processRecordRequest:function(a,d,e,c){return a},_processRecordResponse:function(a,d,e){var b=this.getRecordProp(a,"id"),c=this.getRecordProp(a,"root");b=(c=c?d[c]:d)&&c[b]||d[b];this._getSuccess("record",a,d)?e.resolve({id:b,data:this.extendPlainRecord(c)}):e.reject(d)},_processStoreRequest:function(a,
c,e,f){return a},_processStoreResponse:function(a,c,e){var b=this.getStoreProp(a,"root"),d=this.getStoreProp(a,"total");b=b?c[b]:c;d=d?c[d]:null;this._getSuccess("store",a,c)?e.resolve({data:b,total:d}):e.reject(c)},_processControllerRequest:function(a,c,e,f){return a},_processControllerResponse:function(a,c,e){this._getSuccess("controller",a,c)?e.resolve(c):e.reject(c)},_getSuccess:function(a,c,e){a=this.getProp(a,c,"success");return"function"===typeof a?a(e):a&&void 0!=e[a]?e[a]:!0},runController:function(a,
c,e){return this._makeRequest("controller",a,c,e)},loadRecord:function(a){return this._makeRequest("record","load",a)},saveRecord:function(a,c,e){return this._makeRequest("record",a.getId()?"save":"create",a.getId(),q({},a.storeData(a.getData(c)),e))},deleteRecord:function(a){return this._makeRequest("record","delete",a.getId())},loadStore:function(a,c){return this._makeRequest("store","load",null,c)},saveStore:function(a,c){return this._makeRequest("store","save",null,c)},deleteRecords:function(a,
c){return this._makeRequest("store","delete",c)},extendPlainRecord:function(a){var b=this.getRecordProp(null,"extend");return b?q(a,b,!1,!1):a},getFields:function(){return this.fields},getRecordId:function(a){var b=this.getRecordProp("load","id");return(a.getId?a.getId():a[b])||null},restoreField:function(a,c,e){var b=this.fields[c];if(b){switch(w(b)?b:b.type){case "int":e=parseInt(e);break;case "bool":case "boolean":w(e)?(e=e.toLowerCase(),e=!("off"===e||"no"===e||"0"===e||"false"==e||"null"==e)):
e=e?!0:!1;break;case "double":case "float":e=parseFloat(e);break;case "date":b.parseFn?e=b.parseFn(e,b.format):Date.parse?e=Date.parse(e,b.format):("timestamp"===b.format&&(e=1E3*parseInt(e)),e=new Date(e))}b.restore&&(e=b.restore.call(a,e,c))}return this.onRestoreField(a,c,e)},onRestoreField:function(a,c,e){return e},storeField:function(a,c,e){var b=this.fields[c];if(b){switch(w(b)?b:b.type){case "bool":case "boolean":e=e?"1":"0";break;case "date":e=b.formatFn?b.formatFn(e,b.format):Date.format?
Date.format(e,b.format):"timestamp"===b.format?e.getTime()/1E3:e.format?e.format(b.format):e.toString();break;default:e=e.toString()}b.store&&(e=b.store.call(a,e,c))}return this.onStoreField(a,c,e)},onStoreField:function(a,c,e){return e}},{create:function(a,d){return"MetaphorJs.model.Model"===a?C.factory(a,d):d?C.factory(a,d):c[a]?c[a]:c[a]=C.factory(a)},addToCache:function(b){var c=b.getId(),e=b.$getClass();b instanceof n.model.Record||!e||(a[e]||(a[e]={}),a[e][c]=b)},getFromCache:function(b,c){return a[b]&&
a[b][c]?a[b][c]:null},removeFromCache:function(b,c){a[b]&&a[b][c]&&delete a[b][c]}})}(),Ja=n.model.Record=C({$mixins:[ma],id:null,data:null,orig:null,modified:null,loaded:!1,loading:!1,dirty:!1,model:null,standalone:!0,stores:null,importUponSave:!1,importUponCreate:!1,$init:function(c,a,b){var d=arguments.length;1===d?(b=c,a=c=null):2===d&&(b=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};b=b||{};this.$super(b);w(this.model)?this.model=oa.create(this.model):this.model instanceof
oa||(this.model=new oa(this.model));this.id=c;a?this.importData(a):!1!==b.autoLoad&&c&&this.load();"MetaphorJs.model.Record"!==this.$getClass()&&oa.addToCache(this)},isLoaded:function(){return this.loaded},isLoading:function(){return this.loading},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(c){c=c.getId();-1==this.stores.indexOf(c)&&this.stores.push(c)},detachStore:function(c){c=c.getId();var a;this.$destroyed||
-1==(a=this.stores.indexOf(c))||(this.stores.splice(a,1),0!=this.stores.length||this.standalone||this.$destroy())},setDirty:function(c){this.dirty!=c&&(this.dirty=!!c,this.trigger("dirty-change",this,c))},importData:function(c){var a={},b;if(c){for(b in c)a[b]=this.model.restoreField(this,b,c[b]);this.data=a}this.orig=q({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(c){var a={},b;for(b in c)a[b]=this.model.storeField(this,b,c[b]);return a},getId:function(){return this.id},
getData:function(c){var a={};if(c){var b;c=w(c)?[c]:c;var d=0;for(b=c.length;d<b;d++)a[c[d]]=this.data[c[d]]}else for(d in c=this.data,c)"$"!==d.substr(0,1)&&(a[d]=c[d]);return a},getChanged:function(){return q({},this.modified)},isChanged:function(c){return this.modified[c]||!1},get:function(c){return this.data[c]},setId:function(c){!this.id&&c&&(this.id=c)},set:function(c,a){var b=this.data[c];a=this.model.restoreField(this,c,a);this.data[c]=a;b!=a&&(this.modified[c]=!0,this.setDirty(!0),this.trigger("change",
this,c,a,b),this.trigger("change-"+c,this,c,a,b))},revert:function(){this.dirty&&(this.data=q({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var c=this;c.loading=!0;c.trigger("before-load",c);return c.model.loadRecord(c.id).always(function(){c.loading=!1}).done(function(a){c.setId(a.id);c.importData(a.data);c.trigger("load",c)}).fail(function(){c.trigger("failed-load",c)})},save:function(c,a){var b=this;b.trigger("before-save",b);var d=b.getId()?b.importUponSave:b.importUponCreate;
return b.model.saveRecord(b,c,a).done(function(a){a.id&&b.setId(a.id);d&&b.importData(a.data);b.trigger("save",b)}).fail(function(a){b.trigger("failed-save",b)})},"delete":function(){var c=this;c.trigger("before-delete",c);return c.model.deleteRecord(c).done(function(){c.trigger("delete",c);c.$destroy()}).fail(function(){c.trigger("failed-delete",c)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},onDestroy:function(){oa.removeFromCache(this.$getClass(),
this.id);this.$super()}}),Ib=n.model.Store=function(){var c={};return C({$mixins:[ma],id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,loadingPromise:null,$init:function(a,b,d){this.items=[];this.current=[];this.map={};this.currentMap=
{};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!w(a)&&(d=b,b=a,a=null);b=b||{};a&&(b.url=a);this.$super(b);q(this,b,!0,!1);this.id=this.id||W();this.publicStore&&(c[this.id]=this);this.initModel(b);this.$$observable.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():d&&(I(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&(this.loaded=!0);this.sourceStore&&this.initSourceStore(this.sourceStore,"on")},setModel:function(a){this.model=a;this.initModel({})},initModel:function(a){w(this.model)?
this.model=oa.create(this.model):this.model instanceof oa||(this.model=new oa(this.model));a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},initSourceStore:function(a,b){a[b]("update",this.onSourceStoreUpdate,this)},onSourceStoreUpdate:function(){this.$$observable.suspendAllEvents();this.clear();this.addMany(this.sourceStore.toArray());this.$$observable.resumeAllEvents();this.trigger("update",this)},getId:function(){return this.id},isLoaded:function(){return this.loaded},
isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},isEmpty:function(){return 0===this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,b){null===
b?delete this.extraParams[a]:this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},getParams:function(){return q({},this.extraParams)},clearParams:function(){this.extraParams={}},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;var b=!1;this.each(function(a){return a.isDirty()?(b=!0,!1):!0},null,a);return b},getDirty:function(a){var b=[];if(this.model.isPlain())return b;
this.each(function(a){a.isDirty()&&b.push(a)},null,a);return b},getModel:function(){return this.model},toArray:function(){return this.current.slice()},_loadAjaxData:function(a,b){var c=this;b=b||{};if(b.silent||!1!==c.trigger("before-load",c))c.ajaxData=a,c.model._processStoreResponse("load",a,{resolve:function(a){c._onModelLoadSuccess(a,b)},reject:function(a){c._onModelLoadFail(a,b)}})},_loadArray:function(a,b){b=b||{};(b.silent||!1!==this.trigger("before-load",this))&&I(a)&&(this._load(a,b),this.totalLength=
this.length)},_load:function(a,b){var c=b.prepend;b=b||{};a=a||[];c?this.insertMany(0,a,!0,!0):this.addMany(a,!0,!0);this.loaded=!0;this.loading=!1;this.trigger("loading-end",this);this.onLoad();b.skipUpdate||this.update();b.silent||this.trigger("load",this)},load:function(a,b){var c=this,e=c.model.store,f=e.start;e=e.limit;var k=c.pageSize;c.loadingPromise&&c.loadingPromise.abort&&c.loadingPromise.abort();b=b||{};if(c.local)return null;a=q({},c.extraParams,a||{});null===k||a[f]||a[e]||(f&&(a[f]=
c.start),e&&(a[e]=k));if(!b.silent&&!1===c.trigger("before-load",c))return null;c.loading=!0;c.trigger("loading-start",c);return c.loadingPromise=c.model.loadStore(c,a).done(function(a){c.$destroyed||(c.loadingPromise=null,c.ajaxData=c.model.lastAjaxResponse,c._onModelLoadSuccess(a,b))}).fail(function(a){c.$destroyed||(c.loadingPromise=null,c.ajaxData=c.model.lastAjaxResponse,c._onModelLoadFail(a,b))})},_onModelLoadSuccess:function(a,b){b=b||{};if(!b.noopOnEmpty||a.data.length)!b.prepend&&!b.append&&
this.clearOnLoad&&0<this.length&&this.clear(!0),this.totalLength=parseInt(a.total),this._load(a.data,b)},_onModelLoadFail:function(a,b){this.onFailedLoad();b.silent||this.trigger("failed-load",this,a)},onLoad:J,onFailedLoad:J,save:function(a){var b=this,c={},e=0;if(b.local)return null;if(b.model.isPlain())throw Error("Cannot save plain store");b.each(function(a){a.isDirty()&&(c[a.getId()]=a.storeData(a.getData()),e++)});return!e||!a&&!1===b.trigger("before-save",b,c)?null:b.model.saveStore(b,c).done(function(e){b._onModelSaveSuccess(e,
a)}).fail(function(e){b._onModelSaveFail(e,a)})},_onModelSaveSuccess:function(a,b){var c,e=a.data;if(e&&e.length)for(a=0,c=e.length;a<c;a++){var f=this.getRecordId(e[a]);(f=this.getById(f))&&f.importData(e[a])}this.onSave();b||this.trigger("save",this)},_onModelSaveFail:function(a,b){this.onFailedSave(a);b||this.trigger("failed-save",this,a)},onSave:J,onFailedSave:J,deleteById:function(a,b,c){var e=this,d;if(e.local)return null;if(!a||I(a)&&!a.length)throw Error("Record id required");I(a)||(a=[a]);
var k=0;for(d=a.length;k<d;k++){var h=e.getById(a[k]);e.remove(h,b,c);h instanceof Ja&&h.$destroy()}return b||!1!==e.trigger("before-delete",e,a)?e.model.deleteRecords(e,a).done(function(){e.totalLength-=a.length;e.onDelete();b||e.trigger("delete",e,a)}).fail(function(){e.onFailedDelete();b||e.trigger("failed-delete",e,a)}):null},onDelete:J,onFailedDelete:J,deleteAt:function(a,b,c){var e=this.getAt(a);if(!e)throw Error("Record not found at "+a);return this["delete"](e,b,c)},"delete":function(a,b,
c){return this.deleteById(this.getRecordId(a),b,c)},deleteRecords:function(a,b,c){var e=[],d;var k=0;for(d=a.length;k<d;k++)e.push(this.getRecordId(a[k]));return this.deleteById(e,b,c)},loadOr:function(a){return this.local||this.isLoading()||this.isLoaded()?n.lib.Promise.resolve(this):this.load(null,a)},addPrevPage:function(a){a=a||{};a.append=!1;a.prepend=!0;a.noopOnEmpty=!0;return this.loadPrevPage(a)},addNextPage:function(a){a=a||{};a.append=!0;a.prepend=!1;a.noopOnEmpty=!0;return this.local||
this.totalLength&&!(this.length<this.totalLength)?n.lib.Promise.resolve():this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){return this.local||this.totalLength&&!(this.length<this.totalLength)?n.lib.Promise.resolve():(this.start+=this.pageSize,this.load(null,a))},loadPrevPage:function(a){return!this.local&&0<this.start?(this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,a)):n.lib.Promise.resolve()},loadPage:function(a,b){return this.local?n.lib.Promise.resolve():
(this.start=parseInt(a,10),0>this.start&&(this.start=0),this.load(null,b))},getRecordId:function(a){return a instanceof Ja?a.getId():this.model?this.model.getRecordId(a)||a[this.idProp]||null:a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?a:a.data},processRawDataItem:function(a){if(a instanceof Ja)return a;if(this.model.isPlain())return this.model.extendPlainRecord(a);var b=this.model.type,c=this.getRecordId(a),e;c&&(e=oa.getFromCache(b,c));e||(e=C.factory(b,c,a,{model:this.model,
standalone:!1}));return e},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,this);b[a]("dirty-change",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,b,c,e){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,b,c){return this.removeAt(0,1,a,b,c)},unshift:function(a,b,c){return this.insert(0,a,b,c)},pop:function(a,b,c){return this.removeAt(this.length-
1,1,a,b,c)},addMany:function(a,b,c){var e,d=this.length;var k=0;for(e=a.length;k<e;k++)this.insert(d+k,a[k],!0,!0);c||this.update();0<e&&!b&&this.trigger("add",a)},add:function(a,b,c){return this.insert(this.length,a,b,c)},onAdd:J,removeAt:function(a,b,c,e,f){var d=0,h=this.length;if(0!==h&&null!==a){for(;0>a;)a=h+a;null==b&&(b=1);for(f||(a=this.items.indexOf(this.current[a]));a<this.length&&0<=a&&d<b;){this.length--;f=this.items[a];this.items.splice(a,1);h=this.getRecordId(f);void 0!==h&&(delete this.map[h],
delete this.currentMap[h]);this.onRemove(f,h);e||this.update();c||this.trigger("remove",f,h);if(f instanceof Ja){if(this.bindRecord("un",f),f.detachStore(this),1===b)return f.$destroyed?void 0:f}else if(1===b)return f;d++}}},removeRange:function(a,b,c,e,f){var d=this.length;if(0!==d){if(null==a&&null==b)return this.clear(c);for(null==a&&(a=0);0>a;)a=d+a;for(null==b&&(b=d-1);0>b;)b=d+a;return this.removeAt(a,b-a+1,c,e,f)}},onRemove:J,insertMany:function(a,b,c,e){var d;var k=0;for(d=b.length;k<d;k++)this.insert(a+
k,b[k],!0,!0);0<d&&!e&&this.update();0<d&&!c&&this.trigger("add",b)},insert:function(a,b,c,e){var d=!1;b=this.processRawDataItem(b);var k=this.getRecordId(b);this.map[k]&&(this.$$observable.suspendAllEvents(),this.removeId(k),this.$$observable.resumeAllEvents());a>=this.length?(this.items.push(b),d=!0):this.items.splice(a,0,b);this.length++;this.maxLength&&this.length>this.maxLength&&(d?this.pop(c,!0):this.shift(c,!0));void 0!==k&&(this.map[k]=b);b instanceof Ja&&(b.attachStore(this),this.bindRecord("on",
b));this.onAdd(a,b);e||this.update();c||this.trigger("add",[b]);return b},replace:function(a,b,c,e){var d=this.items.indexOf(a);this.removeAt(d,1,!0,!0,!0);this.insert(d,b,!0,!0);e||this.update();this.onReplace(a,b);c||this.trigger("replace",a,b);return b},replaceId:function(a,b,c,e){a=this.indexOfId(a);return this.replace(this.getAt(a),b,c,e)},onReplace:J,remove:function(a,b,c){a=this.indexOf(a,!0);return-1!==a?this.removeAt(a,1,b,c,!0):null},removeId:function(a,b,c){a=this.indexOfId(a,!0);if(-1!==
a)return this.removeAt(a,1,b,c,!0)},contains:function(a,b){return-1!==this.indexOf(a,b)},containsId:function(a,b){return b?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(a){var b=this.getRange();this._reset();this.onClear();a||this.trigger("clear",this,b)},onClear:J,reset:function(){this._reset();this.start=0},_reset:function(a){var b;if(!a)for(a=0,b=this.items.length;a<b;a++){var c=this.items[a];c instanceof Ja&&(this.bindRecord("un",c),c.detachStore(this))}this.totalLength=this.currentLength=
this.length=0;this.items=[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(a,b){return b?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,b){return b?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,b){return b?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,b){return this.indexOf(this.getById(a,b),b)},each:function(a,b,c){c=c?this.items.slice():this.current.slice();for(var e=0,d=c.length;e<d&&!1!==a.call(b,
c[e],e,d);e++);},eachId:function(a,b,c){var e=this;e.each(function(c,d,h){return a.call(b,e.getRecordId(c),d,h)},null,c)},collect:function(a,b){var c=[],e=!this.model.isPlain();this.each(function(b){(b=e?b.get(a):b[a])&&c.push(b)},null,b);return c},first:function(a){return a?this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},getRange:function(a,b,c){c=c?this.items:this.current;var e=[];if(1>c.length)return e;a=a||0;b=Math.min(void 0==b?
this.length-1:b,this.length-1);if(a<=b)for(;a<=b;a++)e.push(c[a]);else for(;a>=b;a--)e.push(c[a]);return e},findBy:function(a,b,c,e){a=this.findIndexBy(a,b,c,e);return-1===a?void 0:this.getAt(a,e)},findIndexBy:function(a,b,c,e){e=e?this.items:this.current;c=c||0;for(var d=e.length;c<d;c++)if(a.call(b,e[c],this.getRecordId(e[c])))return c;return-1},find:function(a,b,c,e){var d=!this.model.isPlain(),k,h=this.findIndexBy(function(e){k=d?e.get(a):e[a];return c?k===b:k==b},this,0,e);return-1!==h?this.getAt(h,
e):null},findExact:function(a,b,c){return this.find(a,b,!0,c)},findBySet:function(a,b){var c=null,e,f;this.each(function(b){e=!0;for(f in a)if(a[f]!=b[f]){e=!1;break}return e?(c=b,!1):!0},null,b);return c},update:function(){var a=this,b=a.filtered,c=a.sorted,e=a.model.isPlain();a.currentLength=a.length;a.currentMap=a.map;a.current=a.items;if(b){var f=a.filterBy,k=a.filterOpt,h,m;a.current=h=[];a.currentMap=m={};a.each(function(b){Hb.compare(e?b:b.data,f,k)&&(h.push(b),m[a.getRecordId(b)]=b)},null,
!0);a.currentLength=a.current.length}if(c){var p=a.sortBy,n=!a.model.isPlain();b=function(a){return n?a.get(p):a[p]};a.current=ub(a.current,B(p)?{fn:p}:b,a.sortDir)}a.trigger("update",a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=
null;this.update()},onDestroy:function(){delete c[this.id];this.sourceStore&&this.initSourceStore(this.sourceStore,"un");this.clear();this.trigger("destroy",this);this.$super()}},{lookupStore:function(a){return c[a]||null},eachStore:function(a,b){for(var d in c)if(!1===a.call(b,c[d]))break}})}();y.getDirective("attr","each").registerType(Ib,bc);y.registerTag("transclude",function(c,a){return Gb(a,!0)});n.filter.collect=function(c,a,b){a=[];var d;if(!c)return a;var e=0;for(d=c.length;e<d;e++){var f=
c[e][b];void 0!=f&&a.push(f)}return a};n.filter.filter=function(c,a,b,d){return Hb(c,b,d)};n.filter.get=function(c,a,b){for(a=(""+b).split(".");b=a.shift();)if(c=c[b],void 0===c)return;return c};n.filter.join=function(c,a,b){b=b||", ";return c&&c.length?(I(c)||(c=X(c)),c.join(b)):""};n.filter.l=function(c,a){return a.$app.lang.get(c)};n.filter.limitTo=function(c,a,b){a=w(c);if(!I(c)&&!a)return c;b=Infinity===Math.abs(Number(b))?Number(b):parseInt(b,10);if(a)return b?0<=b?c.slice(0,b):c.slice(b,c.length):
"";a=[];b>c.length?b=c.length:b<-c.length&&(b=-c.length);if(0<b)var d=0;else d=c.length+b,b=c.length;for(;d<b;d++)a.push(c[d]);return a};n.filter.linkify=function(c,a,b){return c?c.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,'<a href="$1"'+(b?' target="'+b+'"':"")+">$1</a>"):""};n.filter.lowercase=function(c){return(""+c).toLowerCase()};n.filter.map=function(c,a,b){var d=[],e=na.get(b,!0)||window[b]||F.get(b,a);c=c||[];if(e)for(a=0,b=c.length;a<b;a++)d.push(e(c[a]));
return d};n.filter.moment=function(c,a,b){return c?moment(c).format(Da.global().get(b,b)):""};n.filter.numeral=function(c,a,b){return numeral(c).format(Da.global().get(b,b))};n.filter.offset=function(c,a,b){a=w(c);if(!I(c)&&!a)return c;b=Infinity===Math.abs(Number(b))?Number(b):parseInt(b,10);return a?c.substr(b):c.slice(b)};n.filter.p=function(c,a,b){return a.$app.lang.plural(c,parseInt(b,10)||0)};n.filter.pl=function(c,a,b){return a.$app.lang.plural(b,parseInt(c,10)||0)};(function(){var c=n.filter.preloaded=
function(a,b){if(!a)return!1;a=Fb.check(a);return!0!==a&&a?Y(a)?(a.always(function(){b.$check()}),!1):!0:!!a};c.$undeterministic=!0;return c})();n.filter.r=function(c,a){return a.$app.lang.get(key)};n.filter.sortBy=function(c,a,b,d){return ub(c,b,d)};n.filter.split=function(c,a,b,d){d=d||void 0;b=b||"/\\n|,/";if(!c)return[];c=""+c;"/"===b.substr(0,1)&&"/"===b.substr(b.length-1)&&(b=Ta(b.substring(1,b.length-1)));c=c.split(b,d);a=-1;for(b=c.length;++a<b;c[a]=c[a].trim());return c};n.filter.toArray=
function(c){if(ia(c)){var a=[],b;for(b in c)c.hasOwnProperty(b)&&a.push({key:b,value:c[b]});return a}return X(c)};n.filter.ucfirst=function(c){return c.substr(0,1).toUpperCase()+c.substr(1)};n.filter.uppercase=function(c){return(""+c).toUpperCase()};var Jb=n.app.init=function(c,a,b,d){var e=n.directive.attr,f=Cb(c,function(a){return!!e[a]}),k=f.directive.app?f.directive.app.config:{},h;if(f.names.app){var m=0;for(h=f.names.app.length;m<h;m++)ka(c,f.names[m])}try{var p=xa(a||"MetaphorJs.app.App",q({},
k),b,c,[c,b]);return!1!==d?p.done(function(a){a.run()}):p}catch(H){return T(H),G.reject(H)}},Kb=n.dom.onReady=function(c,a){var b=!1,d=!0,e=a||window,f=function(a){if("readystatechange"!=a.type||"complete"==h.readyState)da("load"==a.type?e:h,a.type,f),!b&&(b=!0)&&c.call(e,a.type||a)},k=function(){try{m.doScroll("left")}catch(p){setTimeout(k,50);return}f("poll")};var h=e.document;var m=h.documentElement;if("complete"==h.readyState)c.call(e,"lazy");else{if(h.createEventObject&&m.doScroll){try{d=!e.frameElement}catch(p){}d&&
k()}O(h,"DOMContentLoaded",f);O(h,"readystatechange",f);O(e,"load",f)}};(n.app.run=function(c,a){var b=c||window;if(!b)throw Error("Window object neither defined nor provided");Kb(function(){var c=L("[mjs-app]",b.document),e;var f=-1;for(e=c.length;++f<e;){var k=c[f];Jb(k,z(k,"mjs-app"),a,!0)}},b)})();n.validator=n.validator||{};var Lb=n.validator.messages={required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",
date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} and {1} characters long.",range:"Please enter a value between {0} and {1}.",
max:"Please enter a value less than or equal to {0}.",min:"Please enter a value greater than or equal to {0}."},Mb=n.validator.checkable=function(c){return/radio|checkbox/i.test(c.type)},lb=n.dom.eachNode=function e(a,b,d){var f,k=a.childNodes;if(!1!==b.call(d,a))for(a=-1,f=k.length>>>0;++a!==f;e(k[a],b,d));},Xa=n.validator.getLength=function(a,b){var d=0;switch(b.nodeName.toLowerCase()){case "select":return lb(b,function(a){a.selected&&d++}),d;case "input":if(Mb(b)){if(b.form)lb(b.form,function(a){a.type==
b.type&&a.name==b.name&&a.checked&&d++});else{var e;if(Oa(b))a=b.ownerDocument;else for(a=b;a.parentNode;)a=a.parentNode;a=L("input[name="+b.name+"]",a);var f=0;for(e=a.length;f<e;f++)a[f].checked&&d++}return d}}return a.length},ba=n.validator.empty=function(a,b){if(!b)return void 0==a||""===a;switch(b.nodeName.toLowerCase()){case "select":return a=ua(b),!a||0==a.length;case "input":if(Mb(b))return 0==Xa(a,b)}return 0==a.trim().length},cc=n.regexp.url=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,
dc=n.regexp.email=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;
(function(){return n.validator.methods={required:function(a,b,d){return!1===d?!0:!ba(a,b)},regexp:function(a,b,d){d=d instanceof RegExp?d:new RegExp(d);return ba(a,b)||d.test(a)},notregexp:function(a,b,d){d=d instanceof RegExp?d:new RegExp(d);return ba(a,b)||!d.test(a)},minlength:function(a,b,d){return ba(a,b)||(b?Xa(a.trim(),b)>=d:a.toString().length>=d)},maxlength:function(a,b,d){return ba(a,b)||(b?Xa(a.trim(),b)<=d:a.toString().length<=d)},rangelength:function(a,b,d){var e=b?Xa(a.trim(),b):a.toString().length;
return ba(a,b)||e>=d[0]&&e<=d[1]},min:function(a,b,d){return ba(a,b)||parseInt(a,10)>=d},max:function(a,b,d){return ba(a,b)||parseInt(a,10)<=d},range:function(a,b,d){a=parseInt(a,10);return ba(a,b)||a>=d[0]&&a<=d[1]},email:function(a,b){return ba(a,b)||dc.test(a)},url:function(a,b){return ba(a,b)||cc.test(a)},date:function(a,b){return ba(a,b)||!/Invalid|NaN/.test(new Date(a))},dateiso:function(a,b){return ba(a,b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return ba(a,b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},
digits:function(a,b){return ba(a,b)||/^\d+$/.test(a)},creditcard:function(a,b){if(ba(a,b))return!0;if(/[^0-9-]+/.test(a))return!1;b=0;var d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;0<=e;e--){var f=a.charAt(e);f=parseInt(f,10);d&&9<(f*=2)&&(f-=9);b+=f;d=!d}return 0==b%10},accept:function(a,b,d){d=w(d)?d.replace(/,/g,"|"):"png|jpe?g|gif";return ba(a,b)||a.match(new RegExp(".("+d+")$","i"))},equalto:function(a,b,d,e){d=(b=e.getValidator().getField(d))?b.getElem():d;return a==ua(d)},notequalto:function(a,
b,d,e){d=(b=e.getValidator().getField(d))?b.getElem():d;return a!=ua(d)},zxcvbn:function(a,b,d){return zxcvbn(a).score>=parseInt(d)}}})();var Ya=n.validator.format=function(a,b){if(B(b))return a;I(b)||(b=[b]);var d,e=b.length;for(d=-1;++d<e;a=a.replace(new RegExp("\\{"+d+"\\}","g"),b[d]));return a},ec=n.validator.Field=function(){var a={allowSubmit:!0,alwaysCheck:!1,alwaysDisplayState:!1,data:null,ignore:null,disabled:!1,cls:{valid:"",error:"",ajax:""},errorBox:{cls:"",fn:null,tag:"",position:"after",
elem:null,enabled:!0},callback:{scope:null,destroy:null,statechange:null,errorchange:null,submit:null,check:null,beforeAjax:null,afterAjax:null,displaystate:null},rules:{},messages:{}},b=function(a){if(!a)return{};var b=function(b,e,d){var f=a[b],h=!1;if(void 0!==f){switch(d){case "string":h=w(f);break;case "function":h=B(f);break;case "boolean":h=sa(f)}h&&(a[b]={},a[b][e]=f)}};b("errorBox","enabled","boolean");b("errorBox","tag","string");b("errorBox","fn","function");return a},d=n.validator.methods;
return C({$mixins:[ma],vldr:null,elem:null,rules:null,cfg:null,input:null,enabled:!0,valid:null,dirty:!1,id:null,prev:"",error:null,errorRule:null,pending:null,rulesNum:0,displayState:!1,data:null,checking:!1,checkTmt:null,errorBox:null,customError:!1,$init:function(e,d,k){d=d||{};var f;this.cfg=f=q({},a,b(n.validator.Field.defaults),b(d),!0,!0);this.input=va.get(e);this.input.onChange(this.onInputChange,this);this.input.onKey(13,this.onInputSubmit,this);this.elem=e;this.vldr=k;this.enabled=!e.disabled;
this.id=z(e,"name")||z(e,"id");this.data=d.data;this.rules={};f.messages=q({},Lb,f.messages,!0,!0);M(e,"data-validator",k.getVldId());this.input.radio&&this.initRadio();f.rules&&this.setRules(f.rules,!1);this.readRules();this.prev=this.input.getValue();f.disabled&&this.disable()},getValidator:function(){return this.vldr},initRadio:function(){var a=this.input.radio,b=this.vldr.getVldId(),d;var h=0;for(d=a.length;h<d;h++)M(a[h],"data-validator",b)},setRules:function(a,b){b=void 0==b?!0:b;for(var e in a)this.setRule(e,
a[e],!1);b?this.check(!1):this.setValidState(null);return this},setRule:function(a,b,d){var e=this.rules;d=void 0==d?!0:d;null===b?(e[a]&&this.rulesNum--,delete e[a]):(e[a]||this.rulesNum++,e[a]=b,null!==this.valid&&this.setValidState(!1));d?this.check(!1):this.setValidState(null);return this},setMessage:function(a,b){this.cfg.messages[a]=b;return this},setMessages:function(a){for(var b in a)this.setMessage(b,a[b]);return this},getMessages:function(){return q({},this.cfg.messages)},readRules:function(){var a=
this.elem,b=a.className,k={};for(m in d)if(d.hasOwnProperty(m)){var h=z(a,m)||z(a,"data-validate-"+m);void 0!=h&&!1!==h&&("minlength"!==m&&"maxlength"!==m||-1!==parseInt(h,10))&&(k[m]=h,(h=z(a,"data-message-"+m))&&this.setMessage(m,h))}if(h=z(a,"remote"))k.remote=h;if(b){b=b.split(" ");var m=0;for(h=b.length;m<h;m++)if(a=b[m].trim(),d[a]||"remote"===a)k[a]=!0}for(m in k)this.setRule(m,k[m],!1)},getRules:function(){return this.rules},hasRule:function(a){return this.rules[a]?!0:!1},getValue:function(){return this.input.getValue()},
getUserData:function(){return this.data},setUserData:function(a){var b=this.data;this.data=a;return b},isEmpty:function(){return ba(this.getValue(),this.elem)},enable:function(){this.enabled=!0;this.vldr.reset();return this},disable:function(){this.enabled=!1;!1===this.valid&&(this.setValidState(!0),this.doDisplayState());return this},enableDisplayState:function(){this.displayState=!0},disableDisplayState:function(){this.displayState=!1},isDisplayStateEnabled:function(){return this.displayState},
toggleErrorBox:function(a){var b=this.cfg,e=b.errorBox.enabled;b.errorBox.enabled=a;!e&&a&&a.displayState&&!1===this.valid()&&this.doDisplayState()},isEnabled:function(){return this.enabled},getElem:function(){return this.elem},getName:function(){return this.id},getError:function(){return this.error},getErrorRule:function(){return this.errorRule},isValid:function(){return this.isEnabled()?this.customError?!1:!0===this.valid&&!this.pending||0===this.rulesNum:!0},getExactValidState:function(){return this.valid},
setCustomError:function(a,b){this.customError=a?!0:!1;this.setValidState(a?!1:!0);this.setError(!0===a?null:a,b);this.doDisplayState()},reset:function(){this.abort();this.dirty=!1;this.prev="";this.setValidState(null);this.setError(null);this.doDisplayState();return this},abort:function(){this.pending&&(this.pending.abort(),this.pending=null);return this},check:function(a){var b=this.rules,e=this.cfg,h=this.elem;if(!this.isEnabled())return!0;if(this.customError)return!1;if(0==this.rulesNum&&!1!==
this.valid)return!0;if(this.checking)return this.checkTmt||(this.checkTmt=setTimeout(this.checkTimeout.bind(this),100)),!0===this.valid;this.checking=!0;if(!(!0===a||b.equalTo||b.notEqualTo||this.dirty||null===this.valid||e.alwaysCheck))return this.pending||this.doDisplayState(),this.checking=!1,!0===this.valid;var m=!0,p=!1,n=this.getValue(),u,r;for(r in b)if("remote"===r){if(this.dirty||e.alwaysCheck||null===this.valid||!0===a)if(n||b[r].checkEmpty)p=!0}else if(!0!==(u=(B(b[r])?b[r]:d[r]).call(this.$$callbackContext,
n,h,b[r],this))){m=!1;this.setError(Ya(u||e.messages[r]||"",b[r]),r);break}p=p&&m;m&&this.setError(null);p?this.ajaxCheck():(this.setValidState(m),this.doDisplayState());this.checking=this.dirty=!1;this.trigger("check",this,this.valid);return!0===this.valid&&!p},doDisplayState:function(){var a=this.cfg,b=this.isValid(),d=a.cls.error,h=a.cls.valid,m=this.elem;this.displayState||a.alwaysDisplayState||(b=null);null===this.valid&&(b=null);d&&(!1===b?N(m,d):S(m,d));h&&(!0===b?N(m,h):S(m,h));d=this.getErrorBox();
h=this.error;d&&(!1===b&&h&&(d.innerHTML=state.error),d.style.display=!1===b&&h&&a.errorBox.enabled?"block":"none");this.trigger("display-state",this,b,this.error)},getErrorBox:function(){var a=this.cfg.errorBox;return a.tag||a.fn||a.selector?(!this.errorBox&&a.enabled&&this.createErrorBox(),this.errorBox):null},onDestroy:function(){ka(this.elem,"data-validator");this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);this.input.$destroy()},isPending:function(){return null!==this.pending},
setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("state-change",this,a))},setError:function(a,b){if(this.error!=a||this.errorRule!=b)this.error=a,this.errorRule=b,this.trigger("error-change",this,a,b)},checkTimeout:function(){this.checkTmt=null;this.checking||this.check(!1)},onInputChange:function(a){this.prev!==a&&(this.dirty=!0,this.customError=!1,this.abort(),this.pending||this.check(!1),this.prev=this.input.getValue())},onInputSubmit:function(a){a=aa(a);if(!(a.isDefaultPrevented&&
a.isDefaultPrevented()||!1!==this.trigger("submit",this,a)))return a.preventDefault(),!1},createErrorBox:function(){var a=this.cfg.errorBox,b=a.tag,d=a.cls,h=a.fn,m=a.position;a=a.elem;h?this.errorBox=h.call(this.$$callbackContext,this):a?this.errorBox=a:(this.errorBox=window.document.createElement(b),this.errorBox.className=d,b=(b=this.input.radio)?b[b-1]:this.elem,"appendParent"==m?b.parentNode.appendChild(this.errorBox):"before"==m?b.parentNode.insertBefore(this.errorBox,b):b.parentNode.insertBefore(this.errorBox,
b.nextSibling))},ajaxCheck:function(){var a=this.elem,b=this.rules.remote,d=this.getValue(),h=this.cfg;b=q({},w(b)?{url:b}:b,!0);b.data=b.data||{};b.data[b.paramName||z(a,"name")||z(a,"id")]=d;b.handler||(b.dataType="text");b.cache=!1;h.cls.ajax&&N(a,h.cls.ajax);this.trigger("before-ajax",this,b);this.pending=Ha(b);this.pending.done(this.onAjaxSuccess.bind(this));this.pending.fail(this.onAjaxError.bind(this))},onAjaxSuccess:function(a){var b=this.rules,e=this.cfg;this.pending=null;var d=!0;b.remote.handler?
(a=b.remote.handler.call(this.$$callbackContext,this,a),!0!==a&&(this.setError(Ya(a||e.messages.remote||"",b.remote),"remote"),d=!1)):a?(this.setError(a,"remote"),d=!1):this.setError(null);e.cls.ajax&&S(this.elem,e.cls.ajax);this.setValidState(d);this.doDisplayState();this.trigger("after-ajax",this)},onAjaxError:function(a,b){var e=this.cfg,d=a.responseData,f=this.rules;d&&f.remote.handler&&(d=f.remote.handler.call(this.$$callbackContext,this,d),!0!==d&&this.setError(Ya(d||e.messages.remote||"",f.remote),
"remote"));e.cls.ajax&&S(this.elem,e.cls.ajax);this.pending=null;"abort"!=b&&"abort"!=a&&(this.setValidState(!1),this.doDisplayState(),this.trigger("after-ajax",this))}},{defaults:{},messages:{}})}(),fc=n.validator.Group=function(){var a={alwaysCheck:!1,alwaysDisplayState:!1,disabled:!1,value:null,elem:null,errorBox:null,errorField:null,data:null,cls:{valid:"",error:""},fields:[],rules:{},messages:{},callback:{scope:null,destroy:null,statechange:null,errorchange:null,displaystate:null}},b=n.validator.methods;
return C({$mixins:[ma],fields:null,rules:null,cfg:null,vldr:null,enabled:!1,invalid:null,valid:null,displayState:!1,rulesNum:0,error:null,data:null,errorBox:null,el:null,$init:function(b,e){b=b||{};var d;this._vldr=e;this.cfg=d=q({},a,n.validator.Group.defaults,b,!0,!0);this.data=b.data;this.el=b.elem;this.fields={};this.rules={};d.messages=q({},Lb,d.messages,!0,!0);d.rules&&this.setRules(d.rules,!1);if(d.fields){var k=0;for(b=b.fields.length;k<b;k++)this.add(e.getField(d.fields[k]))}this.enabled=
!d.disabled},enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},isValid:function(){return!this.enabled||0===this.invalid&&!0===this.valid},getExactValidState:function(){return this.valid},reset:function(){this.invalid=0;this.setValidState(null);this.setError(null);this.doDisplayState();return this},getUserData:function(){return this.data},getName:function(){return this.cfg.name},setRules:function(a,b){b=void 0==
b?!0:b;for(var e in a)this.setRule(e,a[e],!1);b?this.check():this.setValidState(null);return this},setRule:function(a,b,f){var e=this.rules;f=void 0==f?!0:f;null===b?(e[a]&&this.rulesNum--,delete e[a]):(e[a]||this.rulesNum++,e[a]=b,null!==this.valid&&this.setValidState(!1));f?this.check():this.setValidState(null);return this},getRules:function(){return q({},this.rules)},hasRule:function(a){return this.rules[a]?!0:!1},setError:function(a){var b=this.cfg;this.error!=a&&(b.errorField?(this.vldr.getField(b.errorField).setError(a),
this.error=null):(this.error=a,this.trigger("error-change",this,a)))},getError:function(){return this.error},getFields:function(){return this.fields},enableDisplayState:function(){this.displayState=!0;return this},disableDisplayState:function(){this.displayState=!1;return this},check:function(){var a=this.cfg,e=this.fields,f=this.rules;if(!this.enabled||0==this.rulesNum)return this.setValidState(null),this.doDisplayState(),!0;this.countInvalid();if(0<this.invalid)return this.setValidState(null),this.doDisplayState(),
!0;var k={},h=!0,m=null,p;if(a.value){for(p in e)k[p]=e[p].getValue();m=a.value.call(this.$$callbackContext,k,this)}for(p in f)if(!0!==(e=(B(f[p])?f[p]:b[p]).call(this.$$callbackContext,m,null,f[p],this,k))){h=!1;e||a.messages[p]?this.setError(Ya(e||a.messages[p]||"",f[p])):this.setError(null);break}h&&this.setError(null);this.setValidState(h);this.doDisplayState();return!0===this.valid},doDisplayState:function(){var a=this.valid,b=this.cfg;this.displayState||b.alwaysDisplayState||(a=null);if(b.errorBox){var f=
this.getErrorBox();null!==a?f&&(f.innerHTML=this.error||"",f.style.display=!1===this.valid?"block":"none"):f&&(f.style.display="none")}f=b.cls.error;b=b.cls.valid;a=this.valid;f&&(!1===a?N(this.el,f):S(this.el,f));b&&(!0===a?N(this.el,b):S(this.el,b));this.trigger("display-state",this,this.valid)},getErrorBox:function(){var a=this.cfg,b=this.fields,f=a.errorBox;if(b[f])return b[f].getErrorBox();this.errorBox||(B(a.errorBox)?this.errorBox=a.errorBox.call(this.$$callbackContext,this):this.errorBox=
a.errorBox);return this.errorBox},onDestroy:function(){var a=this.fields,b;for(b in a)a[b]&&this.setFieldEvents(a[b],"un");this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox)},add:function(a){var b=this.fields,d=a.getName();b[d]||(b[d]=a,this.setFieldEvents(a,"on"))},setFieldEvents:function(a,b){a[b]("state-change",this.onFieldStateChange,this)},remove:function(a){var b=this.fields,d=a.getName();b[d]&&(delete b[d],this.setFieldEvents(a,"un"));return this},setValidState:function(a){this.valid!==
a&&(this.valid=a,this.trigger("state-change",this,a))},countInvalid:function(){var a=this.fields;this.invalid=0;for(var b in a)this.invalid+=a[b].isValid()?0:1},onFieldStateChange:function(a,b){this.trigger("field-state-change",this,a,b);this.check()}},{defaults:{}})}(),gc=n.validator.Validator=function(){var a={},b={form:null,all:{},fields:{},rules:{},cls:{valid:"",error:"",checking:""},groups:{},callback:{scope:null,destroy:null,reset:null,beforesubmit:null,submit:null,statechange:null,check:null,
displaystate:null,displaystatechange:null}},d=C({$mixins:[ma],id:null,el:null,cfg:null,enabled:!1,invalid:null,pending:0,grps:0,outside:!0,submitted:!1,displayState:!1,isForm:!1,isField:!1,submitButton:null,hidden:null,preventFormSubmit:!1,fields:null,groups:null,$init:function(e,f,k){var h=e.nodeName.toLowerCase();this.id=W();a[this.id]=this;M(e,"data-validator",this.id);this.el=e;f&&!w(f)&&(k=f,f=null);this.cfg=e=q({},b,d.defaults,d[f],k,!0,!0);this.$initObservable(e);this.isForm="form"===h;this.isField=
/input|select|textarea/.test(h);this.fields={};this.groups={};this.$$observable.createEvent("submit",!1);this.$$observable.createEvent("beforesubmit",!1);this.onRealSubmitClickDelegate=this.onRealSubmitClick.bind(this);this.resetDelegate=this.reset.bind(this);this.onSubmitClickDelegate=this.onSubmitClick.bind(this);this.onFormSubmitDelegate=this.onFormSubmit.bind(this);var m;this.initFields();h=this.fields;for(m in e.rules)h[m]&&h[m].setRules(e.rules[m],!1);e.rules=null;for(m in e.groups)this.addGroup(m,
e.groups[m]);this.initForm("bind");delete e.rules;delete e.fields;delete e.groups;this.enabled=!0},getVldId:function(){return this.id},getElem:function(){return this.el},getGroup:function(a){return this.groups[a]||null},getField:function(a){return this.fields[a]||null},enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},enableDisplayState:function(){var a=this.fields,b=this.groups,d;if(!0!==this.displayState){this.displayState=
!0;for(d in a)a[d].enableDisplayState();for(d in b)b[d].enableDisplayState();this.trigger("display-state-change",this,!0)}return this},disableDisplayState:function(){var a=this.groups,b=this.fields,d;if(!1!==this.displayState){this.displayState=!1;for(d in b)b[d].disableDisplayState();for(d in a)a[d].disableDisplayState();this.trigger("display-state-change",this,!1)}return this},isDisplayStateEnabled:function(){return this.displayState},isValid:function(){return!1===this.enabled?!0:0===this.invalid&&
0===this.pending&&0===this.grps&&!0===this.outside},getErrors:function(a){var b=!0===a?[]:{},e,d,m,p=[this.fields,this.groups];if(!this.isEnabled())return b;for(m=0;2>m;m++){var n=p[m];for(d in n)null===n[d].getExactValidState()&&n[d].check(),n[d].isValid()||(e=n[d].getError())&&(a?b.push(e):b[d]=e)}return b},check:function(){var a=this.fields,b=this.groups;if(!this.isEnabled())return!0;var d=this.isValid(),h;for(h in a)a[h].check();for(h in b)b[h].check();this.outside=!1!==this.trigger("check",this);
a=this.isValid();d!=a&&(this.doDisplayState(),this.trigger("state-change",this,!1));return a},add:function(a,b){if(!eb(a)||null!==z(a,"data-no-validate")||null!==z(a,"data-validator"))return this;var e=z(a,"name")||z(a,"id"),d=this.cfg,f=this.fields;if(!e)return this;e=d.fields&&d.fields[e]?d.fields[e]:b||{};w(e)&&(e={rules:[e]});e=q({},d.all||{},e,!0,!0);if(e.ignore)return this;e.callback||(e.callback={context:this.$$callbackContext});a=new ec(a,e,this);e=a.getName();if(f[e])return this;f[e]=a;this.setFieldEvents(a,
"on");this.displayState&&a.enableDisplayState();this.isEnabled()&&null!==this.invalid&&a.check();return this},addGroup:function(a,b){var e=this.groups;e[a]||(b.name=a,e[a]=new fc(b,this),this.setGroupEvents(e[a],"on"),this.isEnabled()&&null!==this.invalid&&e[a].check());return this},focusInvalid:function(){var a=this.fields,b;for(b in a)if(!a[b].isValid()){a[b].getElem().focus();break}},reset:function(){var a=this.fields,b=this.groups,d;this.submitted=!1;this.disableDisplayState();for(d in b)b[d].reset();
for(d in a)a[d].reset();this.pending=0;this.invalid=null;this.grps=0;this.outside=!1;this.doDisplayState();this.trigger("reset",this);return this},submit:function(){var a=this.el;if(this.isForm)if(B(a.submit))!1!==this.trigger("before-submit",this)&&!1!==this.trigger("submit",this)&&a.submit();else this.onSubmit();else this.onSubmit()},setFieldEvents:function(a,b){a[b]("state-change",this.onFieldStateChange,this);a[b]("before-ajax",this.onBeforeAjax,this);a[b]("after-ajax",this.onAfterAjax,this);
a[b]("submit",this.onFieldSubmit,this);a[b]("destroy",this.onFieldDestroy,this);a[b]("error-change",this.onFieldErrorChange,this)},setGroupEvents:function(a,b){a[b]("state-change",this.onGroupStateChange,this)},initFields:function(){var a=this.el,b;if(this.isField)return this.add(a),this;a=L("input, textarea, select",a);var d=-1;for(b=a.length;++d<b;this.add(a[d]));return this},initForm:function(a){var b=this.el,e=b.getElementsByTagName("input"),d=L(".submit",b),m=L(".reset",b);a="bind"===a?O:da;
var p;var n=0;for(p=e.length;n<p;n++){var u=e[n];var r=u.type;"submit"===r?a(u,"click",this.onRealSubmitClickDelegate):"reset"===r&&a(u,"click",this.resetDelegate)}n=-1;for(p=d.length;++n<p;"submit"!==d[n].type&&a(d[n],"click",this.onSubmitClickDelegate));n=-1;for(p=m.length;++n<p;"reset"!==m[n].type&&a(m[n],"click",this.resetDelegate));this.isForm&&a(b,"submit",this.onFormSubmitDelegate)},onRealSubmitClick:function(a){a=aa(a||window.event);this.submitButton=a.target||a.srcElement;this.preventFormSubmit=
!1;return this.onSubmit(a)},onSubmitClick:function(a){this.preventFormSubmit=!1;return this.onSubmit(aa(a||window.event))},onFormSubmit:function(a){a=aa(a);if(!this.isValid()||this.preventFormSubmit)return a.preventDefault(),!1},onFieldSubmit:function(a,b){this.preventFormSubmit=!1;this.enableDisplayState();this.submitted=!0;return this.onSubmit(b)},onSubmit:function(a){this.enableDisplayState();this.isForm||(a&&a.preventDefault(),a&&a.stopPropagation());if(this.pending)return a&&a.preventDefault(),
!1;var b=!!this.submitButton;this.isForm&&(this.hidden&&(this.el.removeChild(this.hidden),this.hidden=null),this.submitButton&&/input|button/.test(this.submitButton.nodeName)&&(this.hidden=window.document.createElement("input"),this.hidden.type="hidden",M(this.hidden,"name",this.submitButton.name),this.hidden.value=this.submitButton.value,this.el.appendChild(this.hidden)));this.submitButton=null;if(!this.isValid()&&(this.check(),this.onFieldStateChange(),this.pending))return this.submitted=!0,a&&
a.preventDefault(),!1;if(!1===this.trigger("before-submit",this)||!this.isValid())return a&&(a.preventDefault(),a.stopPropagation()),this.pending||(this.focusInvalid(),this.submitted=!1),this.trigger("failed-submit",this,b),!1;this.pending||(this.submitted=!1);a=this.trigger("submit",this);this.preventFormSubmit=!1===a;return this.isForm?a:!1},onFieldDestroy:function(a){a=a.getElem();a=z(a,"name")||z(a,"id");delete this.fields[a]},onFieldErrorChange:function(a,b){this.trigger("field-error-change",
this,a,b)},onFieldStateChange:function(a,b){var e=this.invalid,d=this.fields;this.invalid=0;for(var f in d)this.invalid+=d[f].isValid()?0:1;a&&this.trigger("field-state-change",this,a,b);if(null===e||null!==e&&this.invalid!==e)this.doDisplayState(),this.trigger("state-change",this,this.isValid())},onGroupStateChange:function(){var a=this.groups,b=this.grps;this.grps=0;for(var d in a)this.grps+=a[d].isValid()?0:1;if(null===b||null!==b&&this.grps!==b)this.doDisplayState(),this.trigger("state-change",
this,this.isValid())},doDisplayState:function(){var a=this.cfg,b=this.isValid(),d=a.cls.error;a=a.cls.valid;var h=this.el;if(this.isField||!this.displayState)b=null;null===this.invalid&&(b=null);d&&(!1===b?N(h,d):S(h,d));a&&(!0===b?N(h,a):S(h,a));this.trigger("display-state",this,b)},onBeforeAjax:function(){this.pending++;this.cfg.cls.ajax&&N(this.el,this.cfg.cls.ajax)},onAfterAjax:function(){var a=this.fields,b=this.cfg;this.pending=0;for(var d in a)this.pending+=a[d].isPending()?1:0;this.doDisplayState();
b.cls.ajax&&S(this.el,b.cls.ajax);this.submitted&&0==this.pending&&(this.submitted=!1,this.isValid()?this.submit():this.focusInvalid())},onDestroy:function(){var b=this.groups,d=this.fields,k;this.reset();delete a[this.id];for(k in b)b.hasOwnProperty(k)&&b[k]&&(this.setGroupEvents(b[k],"un"),b[k].$destroy());for(k in d)d.hasOwnProperty(k)&&d[k]&&(this.setFieldEvents(d[k],"un"),d[k].$destroy());this.initForm("unbind");this.cfg=this.el=this.groups=this.fields=null}},{defaults:{},addMethod:function(a,
b,k){var e=na.get("MetaphorJs.validator.methods");e[a]||(e[a]=b,k&&(d.messages[a]=k))},getValidator:function(b){b=z(b,"data-validator");return a[b]||null}});return d}();n.validator.Component=C({node:null,scope:null,validator:null,scopeState:null,fields:null,formName:null,nodeCfg:null,$init:function(a,b,d,e){this.node=a;this.scope=b;this.scopeState={};this.fields=[];this.nodeCfg=e;this.validator=this.createValidator();this.formName=z(a,"name")||z(a,"id")||"$form";this.initScope();this.initScopeState();
this.initValidatorEvents();d.once("rendered",this.validator.check,this.validator);d.on("destroy",this.$destroy,this);b.$on("destroy",this.$destroy,this)},createValidator:function(){var a=this.node,b={},d;if(d=this.nodeCfg.get("submit"))b.callback=b.callback||{},b.callback.submit=function(a,b){return function(){try{return a(b)}catch(k){T(k)}}}(d,this.scope);return new gc(a,b)},initValidatorEvents:function(){var a=this.validator;a.on("field-state-change",this.onFieldStateChange,this);a.on("state-change",
this.onFormStateChange,this);a.on("display-state-change",this.onDisplayStateChange,this);a.on("field-error-change",this.onFieldErrorChange,this);a.on("reset",this.onFormReset,this)},initScope:function(){this.scope[this.formName]=this.scopeState},initScopeState:function(){var a=this.node,b=this.scopeState,d=this.fields,e;if(a.elements)var f=a.elements;else f=[],lb(a,function(a){eb(a)&&f.push(a)});a=-1;for(e=f.length;++a<e;){var k=f[a];(k=z(k,"name")||z(k,"id"))&&!b[k]&&(d.push(k),b[k]={$error:null,
$invalid:null,$pristine:!0,$errorMessage:null})}b.$$validator=this.validator;b.$invalid=!1;b.$pristine=!0;b.$isDestroyed=this.$isDestroyed.bind(this);b.$submit=this.validator.onSubmit.bind(this.validator);b.$reset=this.validator.reset.bind(this.validator)},onDisplayStateChange:function(a,b){if(b){b=this.scopeState;var d,e=this.fields;var f=0;for(d=e.length;f<d;f++){var k=b[e[f]];k.$real&&(b[e[f]]=k.$real)}b.$invalid=!a.isValid();b.$pristine=!1;this.scope.$check()}else this.onFormReset(a)},onFieldErrorChange:function(a,
b,d){this.onFieldStateChange(a,b,b.isValid())},onFormReset:function(a){a=this.scopeState;var b,d=this.fields;var e=0;for(b=d.length;e<b;e++){var f=a[d[e]];f.$error=null;f.$errorMessage=null;f.$invalid=null;f.$pristine=!0}a.$invalid=!1;a.$pristine=!0;this.scope.$check()},onFormStateChange:function(a,b){var d=this.scopeState;d.$invalid=!1===b&&a.isDisplayStateEnabled();d.$pristine=!1;this.scope.$check()},onFieldStateChange:function(a,b,d){var e=this.scopeState,f=b.getName();a=a.isDisplayStateEnabled();
b={$error:b.getErrorRule(),$errorMessage:b.getError(),$invalid:!1===d,$pristine:null===b.getExactValidState()};a?e[f]=b:e[f].$real=b;this.scope.$check()},onDestroy:function(){this.validator.$destroy();this.scope&&delete this.scope[this.formName]}});y.registerAttribute("validate",250,function(a,b,d,e,f){d.setProperty("value",{mode:D.MODE_STATIC,defaultValue:"MetaphorJs.validator.Component"});d.setMode("submit",D.MODE_FUNC);f=d.get("value");var k=na.get(f);if(k)return new k(b,a,e,d);T(Error("Class '"+
f+"' not found"))});(function(){var a={getNodePositions:function(a,d,e){for(var b=[],k,h,m,p={};a.firstChild;)a.removeChild(a.firstChild);k=0;for(h=d.length;k<h;k++)e&&e[k]&&(m=e[k].el.cloneNode(!0),a.appendChild(m)),m=d[k].el.cloneNode(!0),a.appendChild(m),b.push(m);k=0;for(h=b.length;k<h;k++)a=b[k],(e=d[k].renderer)&&(p[e.id]={left:a.offsetLeft,top:a.offsetTop});return p},calculateTranslates:function(a,d,e){var b=this.parentEl,k=b.parentNode,h=b.cloneNode(!0),m=b.offsetWidth,p=[],n=0,u=0;var r=
h.style;r.position="absolute";r.left="-10000px";r.visibility="hidden";r.width=m+"px";k.insertBefore(h,b);r.width=m-(h.offsetWidth-m)+"px";d=this.getNodePositions(h,d);e=this.getNodePositions(h,a,e);b=this.getNodePositions(h,a);k.removeChild(h);k=0;for(h=a.length;k<h;k++)m=a[k].el,r=a[k].renderer,r=r.id,0===k&&(n=m.offsetLeft,u=m.offsetTop),p.push([{left:b[r].left-n-(e[r].left-n),top:b[r].top-u-(e[r].top-u)},d[r]?{left:d[r].left-n-(e[r].left-n),top:d[r].top-u-(e[r].top-u)}:null]);return p},moveAnimation:function(a,
d,e,f,k){var b=a.style;k.done(function(){if(e){var a=Fa();b[a.transform]="translateX("+e.left+"px) translateY("+e.top+"px)"}});return fa(a,"move",f,function(a,e,h){0===e&&"start"!==h&&d&&(a=Fa(),b[a.transform]="translateX("+d.left+"px) translateY("+d.top+"px)")})},reflectChanges:function(a){var b=this,e=a.oldRenderers,f=a.newRenderers,k,h,m;b.doUpdate(a.updateStart,null,"enter");a.doesMove&&(k=b.calculateTranslates(a.newRenderers,a.origRenderers,a.oldRenderers));var p=[],n=new G,u=new G,r=new G,v=
G.counter(f.length),A=function(){v.countdown();return n};var q=0;for(h=e.length;q<h;q++)if(m=e[q])m.scope.$destroy(),wa(m.el),p.push(fa(m.el,"leave").done(function(a){a.style.visibility="hidden"}));q=0;for(h=f.length;q<h;q++)m=f[q],wa(m.el),"enter"===m.action?p.push(fa(m.el,"enter",A)):p.push(b.moveAnimation(m.el,a.doesMove?k[q][0]:null,a.doesMove?k[q][1]:null,A,u));v.done(function(){U(function(){u.resolve();b.applyDomPositions(e);a.doesMove||b.doUpdate(a.updateStart,null,"move");U(function(){n.resolve()});
b.trigger("change",b)})});G.all(p).always(function(){U(function(){var d=Fa();b.doUpdate(a.updateStart||0);b.removeOldElements(e);if(a.doesMove)for(b.doUpdate(a.updateStart,null,"move"),q=0,h=f.length;q<h;q++)m=f[q],m.el.style[d.transform]=null,m.el.style[d.transform]="";r.resolve()})});return r}};return C({$class:"MetaphorJs.plugin.ListAnimated",$init:function(b){b.$implement(a)}})})();var mb=n.dom.getScrollParent=function(){var a=/(auto|scroll)/,b,d=function(a){return(a=getStyle(a))?a.overflow+a.overflowY+
a.overflowY:""};return function(e){b||(b=window.document.body);for(;e&&e!==b;){if(a.test(d(e)))return e;e=e.parentNode}return window}}(),hc=n.dom.getOffsetParent=function(a){var b=window.document.documentElement;for(a=a.offsetParent||b;a&&a!=b&&"static"===za(a,"position");)a=a.offsetParent;return a||b};n.dom.getOffet=function(a){var b={top:0,left:0},d=window.document.documentElement;if(!Oa(a)||a===window)return b;a.getBoundingClientRect&&(b=a.getBoundingClientRect());return{top:b.top+Aa()-d.clientTop,
left:b.left+Ba()-d.clientLeft}};var nb=n.dom.getPosition=function(a,b){var d={top:0,left:0},e=window.document.documentElement;if(a===window||a===e)return d;if("fixed"==za(a,"position"))var f=a.getBoundingClientRect();else{if(b)return a=n.dom.getOffset(a),d=n.dom.getOffset(b),a={left:a.left-d.left,top:a.top-d.top},0>a.left&&(a.left=0),0>a.top&&(a.top=0),a;b=hc(a);f=n.dom.getOffset(a);b!==e&&(d=n.dom.getOffset(b));d.top+=za(b,"borderTopWidth",!0);d.left+=za(b,"borderLeftWidth",!0)}return{top:f.top-
d.top-za(a,"marginTop",!0),left:f.left-d.left-za(a,"marginLeft",!0)}};C({$class:"MetaphorJs.plugin.ListBuffered",list:null,enabled:!0,itemSize:null,itemsOffsite:5,bufferState:null,scrollOffset:0,horizontal:!1,dynamicOffset:!1,bufferEventDelegate:null,topStub:null,botStub:null,$init:function(a){var b=this;b.list=a;a.$intercept("afterInit",this.afterInit,this,"before");a.$intercept("doRender",this.doRender,this,"instead");a.$implement({scrollTo:b.$bind(b.scrollTo),reflectChanges:function(d){b.enabled?
(b.getScrollOffset(),a.removeOldElements(d.oldRenderers),a.queue.append(b.updateScrollBuffer,b,[!0]),a.trigger("change",a)):b.$super(d)}})},afterInit:function(){var a=this.list.attr;a=a?a.config:{};this.itemSize=a.itemSize;this.itemsOffsite=parseInt(a.itemsOffsite||5,10);this.horizontal=a.horizontal||!1;this.dynamicOffset=a.dynamicOffset||!1;this.initScrollParent(a);this.initScrollStubs(a);this.bufferEventDelegate=this.bufferUpdateEvent.bind(this);this.up();this.list.scope.$on("freeze",this.down,
this);this.list.scope.$on("unfreeze",this.up,this)},doRender:function(){this.getScrollOffset();this.updateScrollBuffer()},up:function(){O(this.scrollEl,"scroll",this.bufferEventDelegate);O(window,"resize",this.bufferEventDelegate)},down:function(){da(this.scrollEl,"scroll",this.bufferEventDelegate);da(window,"resize",this.bufferEventDelegate)},initScrollParent:function(a){this.scrollEl=mb(this.list.parentEl)},initScrollStubs:function(a){var b=this.list,d=b.parentEl,e=b.prevEl,f,k,h={fontSize:0,lineHeight:0,
padding:0,paddingTop:0,paddingLeft:0,paddingBottom:0,paddingRight:0,margin:0,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0};this.topStub=f=window.document.createElement(a.stub||"div");this.botStub=a=window.document.createElement(a.stub||"div");N(f,"mjs-buffer-top");N(a,"mjs-buffer-bottom");for(k in h)f.style[k]=h[k],a.style[k]=h[k];d.insertBefore(f,e?e.nextSibling:d.firstChild);d.insertBefore(a,b.nextEl);b.prevEl=f;b.nextEl=a},getItemsPerRow:function(){return 1},getRowHeight:function(){return this.itemSize},
getScrollOffset:function(){var a=nb(this.topStub,this.scrollEl);return this.scrollOffset=this.horizontal?a.left:a.top},getBufferState:function(a){var b=this.scrollEl,d=this.horizontal,e=window.document.documentElement;e=b===window?window[d?"innerWidth":"innerHeight"]||e[d?"clientWidth":"clientHeight"]:b[d?"offsetWidth":"offsetHeight"];d=d?Ba(b):Aa(b);b=b.scrollHeight;var f=this.getItemsPerRow(),k=this.getRowHeight(),h=this.itemsOffsite,m=a?this.getScrollOffset():this.scrollOffset;a=Math.ceil(this.list.renderers.length/
f);var p;var n=Math.ceil((d-m)/k);0>n&&(n=0);m=n;var u=p=n+Math.ceil(e/k);n=n>h?n-h:0;u+=h;u>a-1&&(u=a-1);b&&d+e>=b&&this.bufferState&&this.bufferState.last==u*f&&(u+=h);return n>u?this.bufferState:this.bufferState={first:n*f,viewFirst:m*f,last:u*f,viewLast:p*f,ot:n*k,ob:(a-u-1)*k}},updateStubs:function(a){var b=this.horizontal;this.topStub.style[b?"width":"height"]=a.ot+"px";this.botStub.style[b?"width":"height"]=a.ob+"px"},bufferUpdateEvent:function(){this.list.queue.add(this.updateScrollBuffer,
this)},updateScrollBuffer:function(a){var b=this,d=b.list,e=b.bufferState,f=d.parentEl,k=d.renderers,h=b.botStub,m=b.getBufferState(b.dynamicOffset),p=new G,n=window.document,u,r,v,q;if(!m)return null;e&&m.first==e.first&&m.last==e.last||d.trigger("buffer-change",b,m,e);U(function(){if(!b.$isDestroyed()){if(a||!e||m.last<e.first||m.first>e.last){if(e)for(r=e.first,v=e.last;r<=v;r++)(q=k[r])&&q.attached&&(f.removeChild(q.el),q.attached=!1);u=n.createDocumentFragment();r=m.first;for(v=m.last;r<=v;r++)if(q=
k[r])q.rendered||d.renderItem(r),u.appendChild(q.el),q.attached=!0;f.insertBefore(u,h)}else{if(e.first<m.first)for(r=e.first,v=m.first;r<v;r++)(q=k[r])&&q.attached&&(f.removeChild(q.el),q.attached=!1);else if(e.first>m.first){u=n.createDocumentFragment();r=m.first;for(v=e.first;r<v;r++)if(q=k[r])q.rendered||d.renderItem(r),u.appendChild(q.el),q.attached=!0;f.insertBefore(u,k[e.first].el)}if(e.last<m.last){u=n.createDocumentFragment();r=e.last+1;for(v=m.last;r<=v;r++)if(q=k[r])q.rendered||d.renderItem(r),
u.appendChild(q.el),q.attached=!0;f.insertBefore(u,h)}else if(e.last>m.last)for(r=m.last+1,v=e.last;r<=v;r++)(q=k[r])&&q.attached&&(f.removeChild(q.el),q.attached=!1)}b.updateStubs(m);d.trigger("buffer-update",b);b.onBufferStateChange(m,e);p.resolve()}});return p},scrollTo:function(a){var b=this.list,d=this.itemSize,e=this.scrollEl||mb(b.parentEl),f=this.horizontal,k=f?"scrollLeft":"scrollTop",h=new G,m;b.queue.append(function(){U(function(){m=d*a;e===window?window.scrollTo(f?m:Ba(),f?Aa():m):e[k]=
m;h.resolve()});return h});return h},onBufferStateChange:function(a,b){},$beforeHostDestroy:function(){var a=this.list.parentEl;a.removeChild(this.topStub);a.removeChild(this.botStub);this.down()}});n.plugin.ListBuffered.$extend({$class:"MetaphorJs.plugin.ListPullNext",buffered:!1,$init:function(a,b){var d=a.attr;d=d?d.config:{};d.bufferedPullNext&&(this.buffered=d.bufferedPullNext,a.buffered=!0);this.$super(a,b)},afterInit:function(){this.$super();this.getScrollOffset()},updateScrollBuffer:function(a){if(this.buffered)return this.$super(a);
a=this.bufferState;var b=this.getBufferState(this.dynamicOffset);a&&b.first==a.first&&b.last==a.last||(this.list.trigger("buffer-change",this,b,a),this.onBufferStateChange(b,a))},onBufferStateChange:function(a,b){var d=this.list,e=d.store.getLength();this.$super(a,b);e-a.last<(a.last-a.first)/3&&!d.store.loading&&!d.store.$destroyed&&(d.store.addNextPage(),d.trigger("pull",this))}});C({$class:"MetaphorJs.plugin.SrcDeferred",directive:null,queue:null,scrollEl:null,scrollDelegate:null,resizeDelegate:null,
position:null,sw:null,sh:null,checkVisibility:!0,$init:function(a){this.directive=a;a.$intercept("onChange",this.onChange,this,"instead");this.queue=a.queue||new ya({auto:!0,async:!0,mode:ya.REPLACE,thenable:!0})},$beforeHostInit:function(a,b){this.scrollEl=mb(b);this.scrollDelegate=this.onScroll.bind(this);this.resizeDelegate=this.onResize.bind(this);O(this.scrollEl,"scroll",this.scrollDelegate);O(window,"resize",this.resizeDelegate)},isVisible:function(){if(!this.checkVisibility)return!0;var a=
this.scrollEl,b=Aa(a),d=Ba(a),e=this.sw,f=this.sh;this.position||(this.position=nb(this.directive.node,a));e||(e=this.sw=jb(a),f=this.sh=kb(a));a=this.position.top;var k=this.position.left;return a>b&&a<b+f&&k>d&&k<d+e},onScroll:function(){this.directive.queue.add(this.changeIfVisible,this)},onResize:function(){this.sw=this.position=null;this.directive.queue.add(this.changeIfVisible,this)},onChange:function(){this.directive.queue.add(this.changeIfVisible,this)},changeIfVisible:function(){if(this.isVisible())return this.stopWatching(),
this.directive.doChange()},stopWatching:function(){this.scrollEl&&(da(this.scrollEl,"scroll",this.scrollDelegate),da(window,"resize",this.resizeDelegate),this.scrollEl=null,this.checkVisibility=!1)},$beforeHostDestroy:function(){this.stopWatching();this.queue.$destroy()}});C({$class:"MetaphorJs.plugin.SrcSize",directive:null,width:null,height:null,origOnChange:null,$init:function(a){this.directive=a;this.origOnChange=a.$intercept("onSrcChanged",this.onSrcChanged,this,"after")},$afterHostInit:function(a,
b){var d=self.directive.attr,e=(d?d.config:{}).preloadSize;d=b.style;"attr"!==e&&(e=F.parse(e)(a));a="attr"===e?parseInt(z(b,"width"),10):e.width;b="attr"===e?parseInt(z(b,"height"),10):e.height;if(a||b)d.display="block";a&&(d.width=a+"px");b&&(d.height=b+"px")},onSrcChanged:function(){var a=this.directive,b=a.node;a.onSrcChanged=this.origOnChange;Qa(b,"width");Qa(b,"height");Qa(b,"display");this.$destroy()}});y.registerAttribute("break-if",500,function(a,b,d){d.setType("value","bool");(a=d.get("value"))&&
b.parentNode.removeChild(b);return!a});y.registerAttribute("cmp-prop",200,["$parentCmp","$node","$nodeConfig",function(a,b,d){d.setDefaultMode("value",D.MODE_STATIC);a&&(a[d.get("value")]=b)}]);y.registerAttribute("ignore",0,Ma);y.registerAttribute("include-file",900,function(a,b,d){a=require("fs");d=d.get("value");b.innerHTML=a.readFileSync(d).toString()});y.registerTag("bind-html",function(a,b){var d=z(b,"value");a=F.get(d,a);a=ea(a);d=X(a.childNodes);b.parentNode.insertBefore(a,b);b.parentNode.removeChild(b);
return d});y.registerTag("bind",function(a,b){var d=z(b,"value");a=F.get(d,a);a=window.document.createTextNode(a);b.parentNode.insertBefore(a,b);b.parentNode.removeChild(b);return[a]});y.registerTag("if",y.attr.If.$extend({$class:"MetaphorJs.app.Directive.tag.If",autoOnChange:!1,children:null,childrenFrag:null,$init:function(a,b,d,e,f){this.children=X(b.childNodes);this.childrenFrag=ea(this.children);d.setType("once","bool",D.MODE_STATIC);d.setProperty("value",{expression:z(b,"value"),type:"bool"});
this.createCommentWrap();this.$super(a,b,d,e,f);b.parentNode&&b.parentNode.removeChild(b);a=d.get("value");this.onChange(a||!1,void 0)},getChildren:function(){return this.children},onChange:function(){var a=this.config.get("value"),b=this.wrapperOpen,d=this.wrapperClose,e=b.parentNode;if(a)e.insertBefore(this.childrenFrag,d);else if(!this.initial){a=[];for(this.childrenFrag=window.document.createDocumentFragment();b.nextSibling&&b.nextSibling!==d;){var f=b.nextSibling;e.removeChild(f);a.push(f);this.childrenFrag.appendChild(f)}this.children=
a}this.initial?this.initial=!1:this.config.get("once")&&this.$destroy()},onDestroy:function(){this.childrenFrag=this.children=null;this.$super()}}));y.registerTag("include",function(a,b,d,e,f){d.setType("asis","bool",D.MODE_STATIC);var k=new Ia({scope:a,node:b,url:z(b,"src"),parentRenderer:e,replace:!0,ownRenderer:!d.get("asis")});e.on("destroy",function(){k.$destroy();k=null});return!1});y.registerTag("tag",function(a,b){var d=getAttr(b,"value");a=F.get(d,a);if(a){for(var e=window.document.createElement(a),
f=b.nextSibling,k=b.attributes;b.firstChild;)e.appendChild(b.firstChild);a=0;for(d=k.length;a<d;a++){var h=k[a];"value"!==h.name&&M(e,h.name,h.value)}b.parentNode.insertBefore(e,f);b.parentNode.removeChild(b);return[e]}b.parentNode.removeChild(b);return!1});var ic=n.lib.LocalText=function(){var a=function(a,b){"pt_BR"===b&&(b="xbr");3<b.length&&(b=b.substr(0,-b.lastIndexOf("_")));switch(b){case "bo":case "dz":case "id":case "ja":case "jv":case "ka":case "km":case "kn":case "ko":case "ms":case "th":case "tr":case "vi":case "zh":return 0;
case "af":case "az":case "bn":case "bg":case "ca":case "da":case "de":case "el":case "en":case "eo":case "es":case "et":case "eu":case "fa":case "fi":case "fo":case "fur":case "fy":case "gl":case "gu":case "ha":case "he":case "hu":case "is":case "it":case "ku":case "lb":case "ml":case "mn":case "mr":case "nah":case "nb":case "ne":case "nl":case "nn":case "no":case "om":case "or":case "pa":case "pap":case "ps":case "pt":case "so":case "sq":case "sv":case "sw":case "ta":case "te":case "tk":case "ur":case "zu":return 1===
a?0:1;case "am":case "bh":case "fil":case "fr":case "gun":case "hi":case "ln":case "mg":case "nso":case "xbr":case "ti":case "wa":return 0===a||1===a?0:1;case "be":case "bs":case "hr":case "ru":case "sr":case "uk":return 1===a%10&&11!==a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2;case "cs":case "sk":return 1===a?0:2<=a&&4>=a?1:2;case "ga":return 1===a?0:2===a?1:2;case "lt":return 1===a%10&&11!==a%100?0:2<=a%10&&(10>a%100||20<=a%100)?1:2;case "sl":return 1===a%100?0:2===a%100?1:3===a%100||4===
a%100?2:3;case "mk":return 1===a%10?0:1;case "mt":return 1===a?0:0===a||1<a%100&&11>a%100?1:10<a%100&&20>a%100?2:3;case "lv":return 0===a?0:1===a%10&&11!==a%100?1:2;case "pl":return 1===a?0:2<=a%10&&4>=a%10&&(12>a%100||14<a%100)?1:2;case "cy":return 1===a?0:2===a?1:8===a||11===a?2:3;case "ro":return 1===a?0:0===a||0<a%100&&20>a%100?1:2;case "ar":return 0===a?0:1===a?1:2===a?2:3<=a&&10>=a?3:11<=a&&99>=a?4:5;default:return 0}},b=function(a){this.store={};a&&(this.locale=a)};q(b.prototype,{store:null,
locale:"en",setLocale:function(a){this.locale=a},set:function(a,b){var d=this.store;void 0===d[a]&&(d[a]=b)},load:function(a){q(this.store,a,!1,!1)},get:function(a){return this.store[a]||(this===d?"-- "+a+" --":d.get(a))},plural:function(b,d){b="string"===typeof b?this.get(b):b;var e=a(d,this.locale);return I(b)?b[e]:ia(b)?b[d]?b[d]:1===d&&void 0!==b.one?b.one:0>d&&void 0!==b.negative?b.negative:b.other:b},$destroy:function(){this.store=null}},!0,!1);var d=new b;b.global=function(){return d};return b}(),
jc=n.mixin.Provider={$$provider:null,$beforeInit:function(){this.$$provider=new Bb},value:function(){var a=this.$$provider;return a.value.apply(a,arguments)},constant:function(){var a=this.$$provider;return a.constant.apply(a,arguments)},factory:function(){var a=this.$$provider;return a.factory.apply(a,arguments)},service:function(){var a=this.$$provider;return a.service.apply(a,arguments)},provider:function(){var a=this.$$provider;return a.provider.apply(a,arguments)},resolve:function(){var a=this.$$provider;
return a.resolve.apply(a,arguments)},inject:function(){var a=this.$$provider;return a.inject.apply(a,arguments)},$afterDestroy:function(){this.$$provider.$destroy();this.$$provider=null}};n.app.App=C({$mixins:[ma,jc],lang:null,scope:null,renderer:null,cmpListeners:null,components:null,sourceObs:null,$init:function(a,b){var d=b instanceof ta?b:new ta(b);ka(a,"mjs-app");d.$app=this;this.$super();this.lang=new ic;this.scope=d;this.cmpListeners={};this.components={};this.factory("$parentCmp",["$node",
this.getParentCmp],this);this.value("$app",this);this.value("$rootScope",d.$root);this.value("$lang",this.lang);this.value("$locale",this.lang);this.renderer=new hb(a,d);this.renderer.on("rendered",this.afterRender,this);var e=X(arguments);e[1]=d;this.initApp.apply(this,e)},initApp:J,afterRender:function(){},run:function(){this.renderer.process()},createSource:function(a,b){a="source-"+a;this.$$observable.getEvent(a)||this.$$observable.createEvent(a,b||"nonempty")},registerSource:function(a,b,d){this.on("source-"+
a,b,d)},unregisterSource:function(a,b,d){this.un("source-"+a,b,d)},collect:function(a){arguments[0]="source-"+arguments[0];return this.trigger.apply(this,arguments)},getParentCmp:function(a,b){for(a=b?a:a.parentNode;a;){if(b=z(a,"cmp-id")||a.$$cmpId)return this.getCmp(b);a=a.parentNode}return null},onAvailable:function(a,b,d){var e=this.cmpListeners,f=this.components;e[a]||(e[a]=new G);b&&e[a].done(b,d);f[a]&&e[a].resolve(f[a]);return e[a]},getCmp:function(a){return this.components[a]||null},registerCmp:function(a,
b,d){var e=this,f=a[d];d=function(){delete e.cmpListeners[f];delete e.components[f]};e.components[f]=a;e.cmpListeners[f]&&e.cmpListeners[f].resolve(a);if(a.on)a.on("destroy",d);b.$on("destroy",d)},onDestroy:function(){this.renderer.$destroy();this.scope.$destroy();this.lang.$destroy();this.$super()}});var kc=n.regexp.location=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?::([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?::([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
pa=n.browser.parseLocation=function(a){var b=a.match(kc)||[],d=("undefined"!=typeof window?window.location:null)||{};return{protocol:b[4]||d.protocol||"http:",hostname:b[11]||d.hostname||"",host:(b[11]||"")+(b[12]?":"+b[12]:"")||d.host||"",username:b[8]||d.username||"",password:b[9]||d.password||"",port:parseInt(b[12],10)||d.port||"",href:a,path:(b[13]||"/")+(b[16]||""),pathname:b[13]||"/",search:b[16]||"",hash:b[17]&&"#"!=b[17]?b[17]:""}},ob=n.browser.joinLocation=function(a,b){var d="";b=b||{};
b.onlyPath||(d+=a.protocol+"//",a.username&&a.password&&(d+=a.username+":"+a.password+"@"),d+=a.hostname,a.hostname&&a.port&&(d+=":"+a.port));b.onlyHost||(d+=a.pathname||"/",a.search&&"?"!=a.search&&(d+=a.search),a.hash&&"#"!=a.hash&&(d+=a.hash));return d},Ka=n.lib.History=function(){var a,b,d,e=new la,f=W(),k="$$"+f,h=W(),m=new RegExp("#"+f+"=([A-Z0-9]+)"),p,n,u="undefined"==typeof window,r=null,v,w,y;e.createEvent("before-location-change",!1);e.createEvent("void-click",!1);var t=function(a){a=a||
{};a[k]||(a[k]=W());h=a[k];return a},x=function(a){a=a||{};a[k]||(a[k]=h);return a},B=function(a,b){"string"==typeof a&&(a=pa(a));"string"==typeof b&&(b=pa(b));var d=["protocol","host","port"],e;var h=0;for(e=d.length;h<e;h++){var f=d[h];if(a[f]&&b[f]&&a[f]!=b[f])return!0}return!1},D=function(a,b){"string"==typeof a&&(a=pa(a));"string"==typeof b&&(b=pa(b));return B(a,b)||a.pathname!=b.pathname||a.search!=b.search||a.hash!=b.hash},C=function(a){a=pa(a);return!v||y?a.path:ob(a,{onlyPath:!0})},G=function(a){var b=
null;a=a.replace(m,function(a,d){b=d;return""});return{hash:a,id:b}},I=function(a,b){a?("#"!=a.substr(0,1)&&(a=G(a).hash,a="!"+a+"#"+f+"="+h),d.hash=a):d.hash=""},F=function(){if(v)var a=ob(d);else{a=d.hash.substr(1);var b=q({},d,!0,!1);a&&(a=G(a).hash,"!"==a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a).split("?"),b.pathname=a[0],b.search=a[1]?"?"+a[1]:"");a=ob(b)}return a},M=function(a){r=q({},d,!0,!1);N("location-change",a)},L=function(){if(D(r,d)){var a=F();N("before-location-pop",a);h=
v?b.state?b.state[k]:null:G(d.hash).id;r=q({},d,!0,!1);N("location-change",a)}},N=function(a,b,d){b=b||F();var h=pa(b);return e.trigger(a,h.pathname+h.search+h.hash,d,b)},P=function(){a=window;b=a.history;d=a.location;v=!!b.pushState;w="onhashchange"in a;y=!1;r=q({},d,!0,!1);if(v)O(a,"popstate",L),p=function(a,d,e){if(!1===N("before-location-change",a,d))return!1;b.pushState(t(e),null,C(a));M(a)},n=function(a,d,e){b.replaceState(x(e),null,C(a));M(a)},n(F());else if(w)p=function(a,b,d){if(!1===N("before-location-change",
a,b))return!1;V(I,null,[C(a),t(d)])},n=function(a,b,d){V(I,null,[C(a),x(d)])},O(a,"hashchange",L);else{var h=null,f=!1;a.onIframeHistoryChange=function(a){f||V(function(){I(a);L()})};var m=function(a){var b=h.contentDocument?h.contentDocument:h.contentWindow.document;b.open();b.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+a+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');b.close()};p=function(a,
b,d){if(!1===N("before-location-change",a,b))return!1;m(C(a))};n=function(a,b,d){if(!1===N("before-location-change",a,b))return!1;h.contentWindow.hashValue=C(a)};var k=function(){h=window.document.createElement("iframe");h.src="about:blank";h.style.display="none";window.document.body.appendChild(h);f=!0;m(C(d.hash.substr(1)));f=!1};u?k():O(a,"load",k)}O(window.document.documentElement,"click",function(b){b=aa(b||a.event);for(var h=b.target,f;h&&"a"!=h.nodeName.toLowerCase();)h=h.parentNode;if(h&&
!b.isDefaultPrevented()){f=z(h,"href");if("#"==f&&!e.trigger("void-click",h))return b.preventDefault(),b.stopPropagation(),!1;if(f&&"#"!=f.substr(0,1)&&!z(h,"target")){var m=q({},d,!0,!1),k=pa(f);if(B(m,k))return null;D(m,k)?p(f,h):N("same-location",null,h);b.preventDefault();b.stopPropagation();return!1}}return null});P=J};O(window,"load",function(){u=!0});return q({},e.getApi(),{push:function(a,b){P();var e=q({},d,!0,!1),h=pa(a);if(B(e,h))return null;D(e,h)&&p(a,null,b)},replace:function(a,b){P();
n(a,null,b)},saveState:function(a){P();n(F(),null,a)},mergeState:function(a){this.saveState(q({},b.state,a,!0,!1))},getState:function(){return b.state},getCurrentStateId:function(){return h},current:function(){P();return F()},init:function(){return P()},polyfill:function(){P();window.history.pushState=function(a,b,d){p(d,null,a)};window.history.replaceState=function(a,b,d){n(d,null,a)}}})}(),lc=n.lib.UrlParam=function(){var a={},b=C({$mixins:[ma],id:null,name:null,extractor:null,context:null,regexp:null,
valueIndex:1,prev:null,value:null,enabled:!0,$init:function(a){q(this,a,!0,!1);this.regexp&&w(this.regexp)&&(this.regexp=Ta(this.regexp));!this.name||this.regexp||this.extractor||(this.regexp=Ta(this.name+"=([^&]+)"));if(!this.regexp&&!this.extractor)throw Error("Invalid UrlParam config, missing regexp or extractor");this.enabled&&(this.enabled=!1,this.enable())},enable:function(){if(!this.enabled){this.enabled=!0;Ka.on("location-change",this.onLocationChange,this);var a=currentUrl();a=pa(a);this.onLocationChange(a.pathname+
a.search+a.hash)}},disable:function(){this.enabled&&(this.enabled=!1,Ka.un("location-change",this.onLocationChange,this))},onLocationChange:function(a){a=this.extractValue(a);this.value!=a&&(this.prev=this.value,this.value=a,this.trigger("change",a,this.prev))},extractValue:function(a){if(this.regexp)return(a=a.match(this.regexp))?a[this.valueIndex]:null;if(this.extractor)return this.extractor.call(this.context,a)},getValue:function(){return this.value},getPrev:function(){return this.prev},destroyIfIdle:function(){this.$$observable.hasListener()||
this.$destroy()},onDestroy:function(){this.disable()}},{get:function(d){return d.id&&a[d.id]?a[d.id]:new b(d)}});return b}();n.app.Router=C({route:null,node:null,scope:null,cmp:null,id:null,currentViewId:null,currentComponent:null,cmpCache:null,domCache:null,currentView:null,routeMap:null,currentCls:null,currentHtmlCls:null,scrollOnChange:!0,animate:!1,$init:function(a){q(this,a,!0,!1);this.routeMap={};this.config||(this.config=new D(null,{scope:this.scope}));(a=this.node)&&a.firstChild&&P(a,"mjs-transclude",
ea(a.childNodes));this.id||(this.id=W());this.cmpCache={};this.domCache={};this.initView();this.scope.$app.registerCmp(this,this.scope,"id");this.route?(Ka.init(),Ka.on("location-change",this.onLocationChange,this),this.initRoutes(),this.onLocationChange()):this.config.hasExpression("cmp")&&(this.config.on("cmp",this.onCmpChange,this),this.onCmpChange())},initView:function(){},initRoutes:function(){var a=this.route,b,d;if(a){var e=0;for(b=a.length;e<b;e++){var f=a[e];f.id=f.id||W();if(f.params){var k=
{};var h=0;for(d=f.params.length;h<d;h++){var m=f.params[h];m.name&&(k[m.name]=new lc(q({},m,{enabled:!1},!0,!1)))}f.params=k}this.routeMap[f.id]=f}}},onCmpChange:function(){var a=this.config.get("cmp")||this.config.get("defaultCmp");a&&this.setComponent(a)},onLocationChange:function(){var a=this,b=Ka.current();b=pa(b);var d=b.pathname+b.search+b.hash,e=a.route,f,k,h;if(e){var m=0;for(k=e.length;m<k;m++){var p=e[m];if(p.regexp&&(h=b.pathname.match(p.regexp))){a.resolveRoute(p,h);return}if(p.regexpFull&&
(h=d.match(p.regexp))){a.resolveRoute(p,h);return}p["default"]&&!f&&(f=p)}}(h=a.onNoMatchFound(b))?Y(h)?(h.done(a.resolveRoute,a),h.fail(function(){a.finishOnLocationChange(f)})):a.resolveRoute(h):a.finishOnLocationChange(f)},finishOnLocationChange:function(a){a?this.resolveRoute(a):this.config.hasExpression("defaultCmp")&&this.setComponent(this.config.get("defaultCmp"))},resolveRoute:function(a,b){var d=this;b=b||[];if(a.resolve){var e=a.resolve.call(d,a,b);Y(e)?e.done(function(){d.setRouteComponent(a,
b)}):e&&d.setRouteComponent(a,b)}else d.setRouteComponent(a,b)},onNoMatchFound:function(){},clearComponent:function(){var a=this,b=a.node,d=a.currentView||{};a.currentCls&&S(a.node,a.currentCls);a.currentHtmlCls&&S(window.document.documentElement,a.currentHtmlCls);a.currentComponent&&fa(b,a.config.get("animate")?"leave":null).done(function(){if(d.keepAlive){a.currentComponent.freezeByView(a);for(var e=a.domCache[d.id];b.firstChild;)e.appendChild(b.firstChild);d.ttl&&(d.ttlTmt=V(a.onCmpTtl,a,[d],d.ttl))}else for(!a.currentComponent||
a.currentComponent.$destroyed||a.currentComponent.$destroying||a.currentComponent.$destroy();b.firstChild;)b.removeChild(b.firstChild);a.currentComponent=null})},onCmpTtl:function(a){var b=a.id;a.ttlTmt=null;this.cmpCache[b]&&(this.cmpCache[b].$destroy(),delete this.cmpCache[b],delete this.domCache[b])},toggleRouteParams:function(a,b){if(a.params)for(var d in a.params)a.params[d][b]()},setRouteClasses:function(a){a.cls&&(this.currentCls=a.cls,N(this.node,a.cls));a.htmlCls&&(this.currentHtmlCls=a.htmlCls,
N(window.document.documentElement,a.htmlCls))},onRouteFail:function(a){},setRouteComponent:function(a,b){var d=this,e=d.node,f=a.params,k=d.currentView||{};if(a.id==k.id){if(d.currentComponent&&d.currentComponent.onViewRepeat)d.currentComponent.onViewRepeat()}else a.ttlTmt&&clearTimeout(a.ttlTmt),d.beforeRouteCmpChange(a),d.toggleRouteParams(k,"disable"),d.toggleRouteParams(a,"enable"),wa(d.node),d.clearComponent(),k.teardown&&k.teardown(k,a,b),d.setRouteClasses(a),d.currentView=a,fa(e,d.config.get("animate")?
"enter":null,function(){var h=b||[],m={destroyEl:!1,node:e,destroyScope:!0,scope:a.$isolateScope?d.scope.$newIsolated():d.scope.$new()};a.as&&(m.as=a.as);a.template&&(m.template=a.template);h.shift();f&&q(m,f,!1,!1);h.unshift(m);if(d.cmpCache[a.id])d.currentComponent=d.cmpCache[a.id],e.appendChild(d.domCache[a.id]),d.currentComponent.unfreezeByView(d),d.afterRouteCmpChange(),d.afterCmpChange();else if(a.setup)a.setup(a,b);else return xa(a.cmp||"MetaphorJs.app.Component",m,m.scope,e,h).done(function(b){d.currentComponent=
b;a.keepAlive&&(b[d.id]=a.id,d.cmpCache[a.id]=b,d.domCache[a.id]=window.document.createDocumentFragment(),b.on("destroy",d.onCmpDestroy,d));d.afterRouteCmpChange();d.afterCmpChange()}).fail(function(){if(a.onFail)a.onFail.call(d);else d.onRouteFail(a)})})},onCmpDestroy:function(a){(a=a[this.id])&&this.cmpCache[a]&&(delete this.cmpCache[a],delete this.domCache[a])},setComponent:function(a){var b=this,d=b.node;b.beforeCmpChange(a);wa(b.node);b.clearComponent();b.currentView=null;fa(d,b.config.get("animate")?
"enter":null,function(){var e=La(a)?a:{},f=(w(a)?a:null)||"MetaphorJs.app.Component",k=e.scope||b.scope.$new();e.destroyEl=!1;return xa(f,e,k,d,[e]).done(function(a){b.currentComponent=a;b.afterCmpChange()})})},beforeRouteCmpChange:function(a){},afterRouteCmpChange:function(){},beforeCmpChange:function(a){},afterCmpChange:function(){var a=this;a.config.get("scrollOnChange")&&U(function(){a.node.scrollTop=0})},onDestroy:function(){this.clearComponent();if(this.route){Ka.un("location-change",this.onLocationChange,
this);var a,b;var d=0;for(a=this.route.length;d<a;d++)if(this.route[d].params)for(b in this.route[d].params)this.route[d].params[b].$destroy();this.route=null}this.watchable&&(this.watchable.unsubscribe(this.onCmpChange,this),this.watchable.$destroy(!0),this.watchable=null);this.node&&P(this.node,"mjs-transclude",null,"remove");this.currentComponent=this.scope=null;this.$super()}});var mc=n.dom.htmlTags="a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link main map mark math menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rb rp rt rtc ruby s samp script section select slot small source span strong style sub summary sup svg table tbody td template textarea tfoot th thead time title tr track u ul var video wbr".split(" "),
nc=n.app.Component=C({$mixins:[ma],id:null,originalId:!1,node:null,_nodeReplaced:!1,cls:null,renderTo:null,autoRender:!0,rendered:!1,hidden:!1,destroyEl:!0,destroyScope:!1,scope:null,template:null,templateUrl:null,tag:null,as:null,$init:function(a){a=a||{};this.$super(a);q(this,a,!0,!1);this.scope||(this.scope=new ta);this.config?this.config instanceof D||(this.config=new D(this.config,{scope:this.scope})):this.config=new D(null,{scope:this.scope});this._initConfig();this.config.hasExpression("as")&&
(this.scope[this.config.get("as")]=this);if(this.node){var b=z(this.node,"id");b&&(this.originalId=!0,this.id||(this.id=b))}this.id=this.id||"cmp-"+W();this.node||!1===this.node||this._createNode();this.beforeInitComponent.apply(this,arguments);this.initComponent.apply(this,arguments);this.scope.$app&&this.scope.$app.registerCmp(this,this.scope,"id");b=this.template;var d=this.templateUrl;this._nodeReplaced=-1===mc.indexOf(this.node.tagName.toLowerCase());b&&b instanceof Ia?b instanceof Ia&&(this.template.node=
this.node):(this.template=b=new Ia({scope:this.scope,node:this.node,deferRendering:!b||this._nodeReplaced,ownRenderer:!0,replace:this._nodeReplaced,tpl:b,url:d,shadow:this.constructor.$shadow,animate:!this.hidden&&!!this.animate,passAttrs:this.passAttrs}),this.template.on("first-node",this.onFirstNodeReported,this));this.afterInitComponent.apply(this,arguments);this.template.on("rendered",this.onRenderingFinished,this);if(this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,
this);this.node&&this._initElement();this.autoRender&&(b.initPromise?b.initPromise.done(this.render,this):this.render())},_initConfig:function(){this.config.setDefaultMode("as",D.MODE_STATIC)},_createNode:function(){this.node=window.document.createElement(this.tag||"div")},_initElement:function(){var a=this.node;this.originalId||M(a,"id",this.id);this.initNode()},releaseNode:function(){var a=this.node;ka(a,"cmp-id");this.cls&&S(a,this.cls)},onFirstNodeReported:function(a){this._nodeReplaced&&(M(a,
"cmp-id",this.id),a.$$cmpId=this.id)},initNode:function(){var a=this.node;M(a,"cmp-id",this.id);a.$$cmpId=this.id;this.cls&&N(a,this.cls);this.hidden&&(a.style.display="none")},replaceNodeWithTemplate:function(){this._nodeReplaced&&this.node.parentNode&&ka(this.node,"id");this.node=this.template.node;if(11===this.node.nodeType||I(this.node)){var a=11===this.node.nodeType?this.node.childNodes:this.node,b;var d=0;for(b=a.length;d<b;d++)if(1===a[d].nodeType){this.node=a[d];break}}this._initElement()},
render:function(){this.rendered||((this._nodeReplaced&&this.node!==this.template.node||!this.node)&&this.replaceNodeWithTemplate(),this.trigger("render",this),this.template.startRendering())},onRenderingFinished:function(){(this._nodeReplaced&&this.node!==this.template.node||!this.node)&&this.replaceNodeWithTemplate();this.renderTo?this.renderTo.appendChild(this.node):Oa(this.node)||window.document.body.appendChild(this.node);this.rendered=!0;this.afterRender();this.trigger("after-render",this)},
show:function(){if(this.hidden){if(!1===this.trigger("before-show",this))return!1;this.rendered||this.render();this.template.setAnimation(!0);this.showApply();this.hidden=!1;this.onShow();this.trigger("show",this)}},showApply:function(){this.node&&(this.node.style.display="block")},hide:function(){if(!this.hidden){if(!1===this.trigger("before-hide",this))return!1;this.template.setAnimation(!1);this.hideApply();this.hidden=!0;this.onHide();this.trigger("hide",this)}},hideApply:function(){this.node&&
(this.node.style.display="none")},freezeByView:function(a){this.releaseNode();this.scope.$freeze();this.trigger("view-freeze",this,a)},unfreezeByView:function(a){this.initNode();this.scope.$unfreeze();this.trigger("view-unfreeze",this,a);this.scope.$check()},isHidden:function(){return this.hidden},isRendered:function(){return this.rendered},isDestroyed:function(){return this.destroyed},getEl:function(){return this.node},beforeInitComponent:J,initComponent:J,afterInitComponent:J,afterRender:J,onShow:J,
onHide:J,onParentRendererDestroy:function(){this.$destroy()},onDestroy:function(){this.template&&this.template.$destroy();this.destroyEl?this.node&&Oa(this.node)&&this.node.parentNode.removeChild(this.node):this.node&&(this.originalId||ka(this.node,"id"),this.releaseNode());this.destroyScope&&this.scope&&this.scope.$destroy();this.$super()}},{registerDirective:function(a){"string"===typeof a?y.registerComponent(a):y.registerComponent(a.prototype.$class,a)}});n.dialog=n.dialog||{pointer:{},position:{}};
var qa=n.dom.setStyle=function(a,b,d){if(a&&a.style){var e=a.style,f;"string"===typeof b?(a={},a[b]=d):a=b;for(f in a)e[f]=a[f]}},oc=n.dom.isVisible=function(a){return a&&!(0>=a.offsetWidth||0>=a.offsetHeight)},pb=n.dom.is=function(a,b){b=L(b,a.parentNode);var d;var e=-1;for(d=b.length;++e<d;)if(b[e]===a)return!0;return!1},Za=n.dom.getOuterWidth=Wa("outer","Width"),$a=n.dom.getOuterHeight=Wa("outer","Height"),pc=n.dom.delegate=function(a,b,d,e){var f=Da.global().get("dom/delegates",[]),k=b+"-"+d,
h=function(a){a=aa(a);for(var d=a.target;d;){if(pb(d,b))return e(a);d=d.parentNode}return null};f[k]||(f[k]=[]);f[k].push({el:a,ls:h,fn:e});O(a,d,h)},qb=n.dialog.position.Abstract=C({dialog:null,positionBase:null,correct:"solid",$init:function(a){this.dialog=a;q(this,a.getCfg().position,!0,!1);this.onWindowResizeDelegate=this.onWindowResize.bind(this);this.onWindowScrollDelegate=this.onWindowScroll.bind(this);var b=this.preferredType||this.type;if("string"==typeof b){var d=this.getAllPositions(),
e;-1!=(e=d.indexOf(b))&&(d.splice(e,1),d.unshift(b));this.preferredType=d}else b||(this.preferredType=this.getAllPositions());a.on("reposition",this.onReposition,this);a.on("show-after-delay",this.onShowAfterDelay,this);a.on("hide-after-delay",this.onHideAfterDelay,this);if(a.isVisible())this.onShowAfterDelay()},getPositionBase:function(){if(this.positionBase)return this.positionBase;var a;return(a=this.dialog.getCfg().position.base)?this.positionBase="string"==typeof a?L(a).shift():a:null},getBoundary:function(){var a=
this.getPositionBase(),b=this.screenX||0,d=this.screenY||0;if(a){var e=n.dom.getOffset(a);var f=Za(a);a=$a(a);return{x:e.left+b,y:e.top+d,x1:e.left+f-b,y1:e.top+a-d,w:f,h:a}}f=jb(window);a=kb(window);e=Aa(window);var k=Ba(window);return{x:k+b,y:e+d,x1:k+f-b,y1:e+a-d,w:f,h:a}},getPrimaryPosition:function(a){return!1},getSecondaryPosition:function(a){return!1},getAllPositions:function(){return[]},correctPosition:function(a){var b=this.getPrimaryPosition(),d=this.correct;if(b&&d){var e=this.dialog;b=
this.getBoundary();e=e.getDialogSize();var f=this.preferredType,k=f[0];if(d&&"solid"!=d){if(this.type!=k&&this.checkIfFits(a,k,b,e,!1))return this.changeType(k),this.fitToBoundary(this.getCoords(a),b,e);if(this.checkIfFits(a,this.type,b,e,!1))return this.fitToBoundary(this.getCoords(a),b,e)}if(d&&"position-only"!=d)for(d=0,k=f.length;d<k;d++)if(this.checkIfFits(a,f[d],b,e,!0)){this.changeType(f[d]);break}return this.getCoords(a)}},checkIfFits:function(a,b,d,e,f){a=this.getCoords(a,b,!0);if(!f&&this.getSecondaryPosition(b))return!1;
if(f)return!(a.x<d.x||a.y<d.y||a.x+e.width>d.x1||a.y+e.height>d.y1);switch(this.getPrimaryPosition(b)){case "t":return a.y>=d.y;case "r":return a.x+e.width<=d.x1;case "b":return a.y+e.height<=d.y1;case "l":return a.x>=d.x}},fitToBoundary:function(a,b,d){var e=this.getPositionBase(),f=e?0:b.x,k=e?0:b.y,h=e?b.w:b.x1;b=e?b.h:b.y1;var m=e=0,p=this.dialog.getPointer();a.x<f&&(e=a.x-f,a.x=f);a.y<k&&(m=a.y-k,a.y=k);a.x+d.width>h&&(e=a.x+d.width-h,a.x-=e);a.y+d.height>b&&(m=a.y+d.height-b,a.y-=m);p.setCorrectionOffset(e,
m);p.reposition();return a},changeType:function(a){var b=this.dialog.getPointer();this.type=a;b.setType(null,null)},onReposition:function(a,b){a=!1!==this.screenX||!1!==this.screenY?this.correctPosition(b):this.getCoords(b);this.apply(a)},getCoords:function(a){return{left:0,top:0}},apply:function(a){if(a&&!isNaN(a.x)&&!isNaN(a.y)){var b=this.dialog,d=b.getCfg().position.axis,e={};"y"!=d&&(e.left=a.x+"px");"x"!=d&&(e.top=a.y+"px");qa(b.getElem(),e)}},onWindowResize:function(a){this.dialog.reposition(aa(a))},
onWindowScroll:function(a){this.dialog.reposition(aa(a))},onShowAfterDelay:function(){(this.resize||this.screenX||this.screenY)&&O(window,"resize",this.onWindowResizeDelegate);(this.scroll||this.screenX||this.screenY)&&O(this.dialog.getScrollEl(this.scroll),"scroll",this.onWindowScrollDelegate)},onHideAfterDelay:function(){(this.resize||this.screenX||this.screenY)&&da(window,"resize",this.onWindowResizeDelegate);(this.scroll||this.screenX||this.screenY)&&da(this.dialog.getScrollEl(this.scroll),"scroll",
this.onWindowScrollDelegate)},onDestroy:function(){var a=this.dialog;da(window,"resize",this.onWindowResizeDelegate);da(a.getScrollEl(this.scroll),"scroll",this.onWindowScrollDelegate);a.un("reposition",this.onReposition,this);a.un("show-after-delay",this.onShowAfterDelay,this);a.un("hide-after-delay",this.onHideAfterDelay,this);if(a.isVisible())this.onHideAfterDelay()}}),qc=n.dialog.position.Target=qb.$extend({getCoords:function(a,b,d){var e=this.dialog,f=e.getCfg(),k=e.getTarget();if(!k)return null;
b=b||this.type;var h=this.getPositionBase();a=e.getDialogSize();d=h&&!d?nb(k,h):n.dom.getOffset(k);k=e.getTargetSize();h={};var m=b.substr(0,1),p=b.substr(1),q=f.position.offsetX;f=f.position.offsetY;b=e.pointer.getDialogPositionOffset(b);switch(m){case "t":h.y=d.top-a.height-f;break;case "r":h.x=d.left+k.width+q;break;case "b":h.y=d.top+k.height+f;break;case "l":h.x=d.left-a.width-q}switch(p){case "t":h.y=d.top+f;break;case "r":h.x=d.left+k.width-a.width-q;break;case "b":h.y=d.top+k.height-a.height-
f;break;case "l":h.x=d.left+q;break;case "rc":h.x=d.left+k.width+q;break;case "lc":h.x=d.left-a.width-q;break;case "":switch(m){case "t":case "b":h.x=d.left+k.width/2-a.width/2;break;case "r":case "l":h.y=d.top+k.height/2-a.height/2}}b&&(h.x+=b.x,h.y+=b.y);return h},getPrimaryPosition:function(a){return(a||this.type).substr(0,1)},getSecondaryPosition:function(a){return(a||this.type).substr(1)},getAllPositions:function(){return"t r b l tl tr rt rb br bl lb lt tlc trc brc blc".split(" ")}});n.dialog.position.Mouse=
qc.$extend({correct:"position",$init:function(a){this.onMouseMoveDelegate=this.onMouseMove.bind(this);this.$super(a)},getCoords:function(a,b,d){if(!a)return null;var e=b||this.type,f=this.dialog,k=f.getCfg(),h=f.getDialogSize(),m=this.getPositionBase(),p={};b=(b||this.type).substr(1);var q=k.position.offsetX,u=k.position.offsetY;k=k.position.axis;e=f.getPointer().getDialogPositionOffset(e);var r=0,v=0;!d&&m&&(m=n.dom.getOffset(m),r=m.left,v=m.top);switch(b){case "":p=this.get.call(f.$$callbackContext,
f,a,b,d);break;case "c":p.y=a.pageY-v-h.height/2;p.x=a.pageX-r-h.width/2;break;case "t":p.y=a.pageY-v-h.height-u;p.x=a.pageX-r-h.width/2;break;case "r":p.y=a.pageY-v-h.height/2;p.x=a.pageX-r+q;break;case "b":p.y=a.pageY-v+u;p.x=a.pageX-r-h.width/2;break;case "l":p.y=a.pageY-v-h.height/2;p.x=a.pageX-r-h.width-q;break;case "rt":p.y=a.pageY-v-h.height-u;p.x=a.pageX-r+q;break;case "rb":p.y=a.pageY-v+u;p.x=a.pageX-r+q;break;case "lt":p.y=a.pageY-v-h.height-u;p.x=a.pageX-r-h.width-q;break;case "lb":p.y=
a.pageY-v+u,p.x=a.pageX-r-h.width-q}e&&(p.x+=e.x,p.y+=e.y);k&&(a=this.$super(a,b))&&("x"==k?p.y=a.y:p.x=a.x);return p},onShowAfterDelay:function(){this.$super();O(window.document.documentElement,"mousemove",this.onMouseMoveDelegate)},onHideAfterDelay:function(){this.$super();da(window.document.documentElement,"mousemove",this.onMouseMoveDelegate)},onMouseMove:function(a){this.dialog.reposition(aa(a))},getPrimaryPosition:function(a){return(a||this.type).substr(1,1)},getSecondaryPosition:function(a){return(a||
this.type).substr(2)},getAllPositions:function(){return"mt mr mb ml mrt mrb mlb mlt".split(" ")}});n.dialog.position.Window=qb.$extend({getCoords:function(a,b){var d=this.dialog;a=this.getPositionBase()||window;d=d.getDialogSize();var e={};b=(b||this.type).substr(1);var f=this.offsetX,k=this.offsetY,h=Aa(a),m=Ba(a),p=Za(a);a=$a(a);switch(b){case "c":e.y=a/2-d.height/2+h;e.x=p/2-d.width/2+m;break;case "t":e.y=h+k;e.x=p/2-d.width/2+m;break;case "r":e.y=a/2-d.height/2+h;e.x=p-d.width+m-f;break;case "b":e.y=
a-d.height+h-k;e.x=p/2-d.width/2+m;break;case "l":e.y=a/2-d.height/2+h;e.x=m+f;break;case "rt":e.y=h+k;e.x=p-d.width+m-f;break;case "rb":e.y=a-d.height+h-k;e.x=p-d.width+m-f;break;case "lt":e.y=h+k;e.x=m+f;break;case "lb":e.y=a-d.height+h-k,e.x=m+f}return e},getPrimaryPosition:function(a){return(a||this.type).substr(1,1)},getSecondaryPosition:function(a){return(a||this.type).substr(2)},getAllPositions:function(){return"wt wr wb wl wrt wrb wlb wlt wc".split(" ")},correctPosition:function(a){return this.getCoords(a)}});
n.dialog.position.Custom=qb.$extend({getCoords:function(a){var b=this.dialog;return this.get.call(b.$$callbackContext,b,a)}});var rc=n.dialog.pointer.Abstract=C({enabled:null,node:null,correctX:0,correctY:0,$init:function(a,b){q(this,b,!0,!1);this.origCfg=b;this.dialog=a;this.opposite={t:"b",r:"l",b:"t",l:"r"};this.names={t:"top",r:"right",b:"bottom",l:"left"};this.sides={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]};this.enabled=!1!==this.enabled&&b.size?!0:!1},enable:function(){this.enabled||
(this.enabled=!0,this.render(),this.dialog.isVisible()&&this.dialog.reposition())},disable:function(){this.enabled&&(this.remove(),this.enabled=!1,this.dialog.isVisible()&&this.dialog.reposition())},getElem:function(){return this.node},getSize:function(){return this.enabled?this.size:0},setCorrectionOffset:function(a,b){this.correctX=a;this.correctY=b},getCorrectionValue:function(a,b,d){if(!b)return 0;var e=d.substr(0,1);d=d.substr(1,1);var f=this.dialog.getDialogSize(),k=this.width,h="t"==e||"b"==
e?"width":"height";switch(d){case "":var m=f[h]/2-k/2;var p=-m;break;case "l":p=0;m=f[h]-k/2;break;case "r":p=-(f[h]-k/2),m=0}b=0>b?Math.max(p,b):Math.min(m,b);return("t"==e||"b"==e)&&"x"==a||("l"==e||"r"==e)&&"y"==a?b:0},getDialogPositionOffset:function(a){var b=(this.detectPointerPosition(a)||"").substr(0,1);a=this.dialog.getPosition().getPrimaryPosition(a);var d={x:0,y:0};if(!this.enabled)return d;b==this.opposite[a]&&(d["t"==b||"b"==b?"y":"x"]="b"==b||"r"==b?-this.size:this.size);return d},detectPointerPosition:function(a){if(this.position&&
!a)return B(this.position)?this.position.call(this.dialog.$$callbackContext,this.dialog,this.origCfg):this.position;var b=this.dialog.getPosition().getPrimaryPosition(a);a=this.dialog.getPosition().getSecondaryPosition(a);var d=a.substr(1,1);if(!b)return null;b=this.opposite[b];a&&(a=a.substr(0,1),b="c"==d?b+this.opposite[a]:b+a);return b},detectPointerDirection:function(a){return this.direction?B(this.direction)?this.direction.call(this.dialog.$$callbackContext,this.dialog,a,this.origCfg):this.direction:
a},update:function(){this.remove();this.render();this.append();this.dialog.isVisible()&&this.dialog.reposition()},setType:function(a,b){this.position=a;this.direction=b;this.update();this.reposition()},render:function(){},onDestroy:function(){this.remove()},reposition:function(){},append:function(){if(this.enabled&&(this.node||this.render(),this.node)){this.reposition();var a=this.dialog.getElem();a&&a.appendChild(this.node)}},remove:function(){var a=this.node;a&&(a.parentNode&&a.parentNode.removeChild(a),
this.node=null)}});n.dialog.pointer.Html=function(){var a=null,b={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"};return rc.$extend({node:null,sub:null,$init:function(b,e){null===a&&(a=window.document.all&&!window.XMLHttpRequest);this.$super(b,e);this.width=this.width||2*this.size;this.inner&&(this.enabled=!0)},createInner:function(){var a=q({},this.origCfg);a.size=this.size-2*this.border;a.width=this.width-4*this.border;a.border=0;a.borderColor=
null;a.borderCls=null;a.offset=0;a.inner=this.border;this.sub=new n.dialog.pointer.Html(this.dialog,a)},getBorders:function(b,e,f){var d={},h=b.substr(0,1);b=e.substr(0,1);var m=e.substr(1);e=a?"dotted":"solid";var p=this.names,n=this.sides,u=this.opposite;d["border"+ra(p[u[h]])]=this.size+"px solid "+f;d["border"+ra(p[h])]="0 "+e+" transparent";m?(d["border"+ra(p[m])]="0 solid transparent",d["border"+ra(p[u[m]])]=this.width+"px "+e+" transparent"):(f=Math.floor(this.width/2),d["border"+ra(p[n[b][0]])]=
f+"px "+e+" transparent",d["border"+ra(p[n[b][1]])]=f+"px "+e+" transparent");return d},getOffsets:function(a,b){var d={},e=this.names,h=this.opposite,m=a.substr(0,1),p="t"==m||"b"==m?"r":"b";d[e[m]]=this.inner?"auto":-this.size+"px";d[e[p]]="auto";if(this.inner)a=b.substr(0,1),b=b.substr(1),d[e[h[p]]]=b?"l"==b||"t"==b?this.inner+"px":-this.width-this.inner+"px":Math.floor(-this.width/2)+"px",d[e[h[a]]]=-(this.size+2*this.inner)+"px";else{switch(a){case "t":case "r":case "b":case "l":b=b!=a?"l"==
b||"t"==b?this.offset:-this.width+this.offset:-this.width/2+this.offset;break;case "bl":case "tl":case "lt":case "rt":b=this.offset;break;default:b=-this.width-this.offset}d["margin"+ra(e[h[p]])]=b+"px";switch(a){case "t":case "r":case "b":case "l":b="50%";break;case "tr":case "rb":case "br":case "lb":b="100%";break;default:b=0}d[e[h[p]]]=b;e=Fa().transform;h="";p=this.correctX;b=this.correctY;e&&(p&&(h+=" translateX("+this.getCorrectionValue("x",p,a)+"px)"),b&&(h+=" translateY("+this.getCorrectionValue("y",
b,a)+"px)"),d[e]=h)}return d},render:function(){if(this.enabled&&!this.node&&this.detectPointerPosition()){this.border&&!this.sub&&this.createInner();this.node=window.document.createElement("div");var a=window.document.createComment(" ");this.node.appendChild(a);setStyle(this.node,b);N(this.node,this.borderCls||this.cls);this.sub&&(this.sub.render(),this.node.appendChild(this.sub.getElem()))}},reposition:function(){var a=this.detectPointerPosition(),b=this.detectPointerDirection(a);this.node&&(qa(this.node,
this.getBorders(a,b,this.borderColor||this.color)),qa(this.node,this.getOffsets(a,b)),this.sub&&this.sub.reposition())},update:function(){this.sub&&(this.sub.$destroy(),this.sub=null);this.remove();this.node=null;this.render();this.append();this.dialog.isVisible()&&this.dialog.reposition()},onDestroy:function(){this.sub&&(this.sub.$destroy(),this.sub=null);this.$super()},remove:function(){this.sub&&this.sub.remove();this.$super()}})}();var sc=n.dialog.Overlay=C({dialog:null,enabled:!1,color:"#000",
opacity:.5,cls:null,animateShow:!1,animateHide:!1,$mixins:[ma],$init:function(a){this.dialog=a;this.onClickDelegate=this.onClick.bind(this);q(this,a.getCfg().overlay,!0,!1);this.$$observable.createEvent("click",!1);this.enabled&&(this.enabled=!1,this.enable())},getElem:function(){this.enabled&&!this.node&&this.render();return this.node},enable:function(){this.enabled||(this.enabled=!0)},disable:function(){this.enabled&&(this.remove(),this.enabled=!1)},show:function(a){this.enabled&&(this.animateShow?
this.animate("show",a):this.node.style.display="block")},hide:function(a){this.node&&(this.animateHide?this.animate("hide",a):this.node.style.display="none")},render:function(){if(this.enabled){var a=window.document.createElement("div"),b=this.dialog.getCfg();qa(a,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:this.opacity,backgroundColor:this.color});O(a,"click",this.onClickDelegate);b.render.zIndex&&qa(a,"zIndex",b.render.zIndex);this.cls&&n.dom.addClass(a,this.cls);this.node=
a}},remove:function(){var a=this.node;a&&U(function(){a.parentNode&&a.parentNode.removeChild(a)})},append:function(){var a=this.dialog.getCfg().render.appendTo||window.document.body;this.enabled&&(this.node||this.render(),a.appendChild(this.node))},animate:function(a,b){var d=this.node;var e="show"==a?this.animateShow:this.animateHide;B(e)&&(e=e(this,b));sa(e)?e=a:w(e)&&(e=[e]);return fa(d,e,function(){if("show"==a)return new G(function(a,b){U(function(){d.style.display="";a()})})},!1)},onClick:function(a){return!1===
this.trigger("click",this.dialog,this,a)?null:this.modal?(a=aa(a),a.preventDefault(),a.stopPropagation(),!1):null},onDestroy:function(){this.remove()}}),tc=n.dialog.Manager=C({all:null,groups:null,$init:function(){this.all={};this.groups={}},register:function(a){var b=a.getInstanceId(),d=a.getGroup(),e=this.groups,f;this.all[b]=a;var k=0;for(f=d.length;k<f;k++){var h=d[k];e[h]||(e[h]={});e[h][b]=!0}a.on("destroy",this.unregister,this)},unregister:function(a){a=a.getInstanceId();delete this.all[a]},
hideAll:function(a){var b=a.getInstanceId();a=a.getGroup();var d=this.all,e=this.groups,f,k;var h=0;for(f=a.length;h<f;h++){var m=a[h];m=e[m];for(k in m)d[k]?k==b||d[k].isHideAllIgnored()||d[k].hide(null,!0,!0):delete m[k]}}}),uc=n.dialog.Dialog=function(){var a=new tc,b=function(a,b,d,e){if("show"===d||!e)return b.preventDefault(),b.stopPropagation(),!1},d=function(a,b,d,e){var h=a[b],f=!1;if(void 0!==h){switch(e){case "string":f=w(h);break;case "function":f=B(h);break;case "number":f=1===ha(h)||
h==parseInt(h);break;case "dom":f=h&&(h.tagName||h.nodeName)?!0:!1;break;case "jquery":(f=h&&h.jquery?!0:!1)&&(h=h.get(0));break;case "boolean":if(!0===h||!1===h)f=!0;break;default:!0===e&&!0===h&&(f=!0),!1===e&&!1===h&&(f=!0)}f&&(a[b]={},a[b][d]=h)}},e=function(a){if(!a)return{};d(a,"content","value","string");d(a,"content","value","boolean");d(a,"content","fn","function");d(a,"ajax","url","string");d(a,"cls","dialog","string");d(a,"render","tpl","string");d(a,"render","fn","function");d(a,"render",
"el","dom");d(a,"render","el","jquery");d(a,"show","events",!1);d(a,"show","events","string");d(a,"hide","events",!1);d(a,"hide","events","string");d(a,"toggle","events",!1);d(a,"toggle","events","string");d(a,"position","type","string");d(a,"position","type",!1);d(a,"position","get","function");d(a,"overlay","enabled","boolean");d(a,"pointer","position","string");d(a,"pointer","size","number");return a},f={target:null,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},
ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{"*":{preventDefault:!1,stopPropagation:!1,returnValue:null,process:b}},hide:{"*":{preventDefault:!1,stopPropagation:!1,returnValue:null,process:b}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,
focus:!1,preventScroll:!1,display:"block"},hide:{delay:null,timeout:null,events:null,destroy:!1,remove:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",preferredType:null,offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,base:null,scroll:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1},
callback:{context:null,"content-change":null,"before-show":null,show:null,"before-hide":null,hide:null,render:null,lifetime:null,"target-change":null,button:null}},k=C({$mixins:[ma],id:null,node:null,overlay:null,pointer:null,cfg:null,position:null,target:null,dynamicTarget:!1,dynamicTargetEl:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,bindSelfOnRender:!1,hideTimeout:null,hideDelay:null,showDelay:null,destroyDelay:null,images:0,positionGetType:null,positionClass:null,positionAttempt:0,$constructor:function(){this.$$events=
{"before-show":{returnResult:!1},"before-hide":{returnResult:!1}};this.$super.apply(this,arguments)},$init:function(b){b=b||{};var d=b.preset;b.preset=null;this.cfg=b=q({},f,e(k.defaults),e(k[d]),e(b),!0,!0);this.id=W();this.onPreventScrollDelegate=this.onPreventScroll.bind(this);this.onButtonClickDelegate=this.onButtonClick.bind(this);this.onButtonKeyupDelegate=this.onButtonKeyup.bind(this);this.showDelegate=this.show.bind(this);this.hideDelegate=this.hide.bind(this);this.toggleDelegate=this.toggle.bind(this);
this.onImageLoadDelegate=this.onImageLoad.bind(this);a.register(this);b.modal&&(b.overlay.enabled=!0);this.overlay=new sc(this);d=ra(b.pointer.$class||"Html");this.pointer=C.factory("MetaphorJs.dialog.pointer."+d,this,b.pointer);B(b.position.type)&&(this.positionGetType=b.position.type);this.setTarget(b.target);b.target&&b.useHref&&(d=z(this.getTarget(),"href"),"#"===d.substr(0,1)?b.render.el=d:b.ajax.url=d);b.render.lazy||this.render();this.trigger("init",this);this.setHandlers("bind")},getElem:function(){return this.node},
getInstanceId:function(){return this.id},getCfg:function(){return this.cfg},getPointer:function(){return this.pointer},getOverlay:function(){return this.overlay},isEnabled:function(){return this.enabled},isVisible:function(){return this.visible},isHideAllIgnored:function(){return this.cfg.show.ignoreHideAll},isFrozen:function(){return this.frozen},isRendered:function(){return this.rendered},enable:function(){this.enabled=!0},disable:function(){this.hide();this.enabled=!1},freeze:function(){this.frozen=
!0},unfreeze:function(){this.frozen=!1},getGroup:function(){var a=this.cfg;return a.group?w(a.group)?[a.group]:a.group:[""]},toggle:function(a,b){return a&&a.stopPropagation&&this.dynamicTarget&&this.visible&&this.isDynamicTargetChanged(a)?this.show(a):this[this.visible?"hide":"show"](a,b)},resetHandlers:function(a,b){this.setHandlers("unbind");this.bindSelfOnRender=!1;a&&a.call(b,this,this.getCfg());this.setHandlers("bind")},setHandlers:function(a,b){var d=this.cfg,e=["show","hide","toggle"],h="bind"===
a?O:da;a="bind"===a?pc:n.dom.undelegate;for(var f,m,k,q,t,x,y,z,B,C;f=e.shift();)if(m=d[f].events,!1!==m){if(w(m)||I(m))this.dynamicTarget?(t={},t[m]=d.target,m={_html:t}):m={_target:m};for(k in m){if(b)if("_self"===b){if("_self"!==k&&"_overlay"!==k&&">"!==k.substr(0,1))continue}else if(k!==b)continue;if("_self"!==k&&"_overlay"!==k&&">"!==k.substr(0,1)||this.node){if(y=m[k]){switch(k){case "_target":z=[this.getTarget()];break;case "_self":z=[this.node];break;case "_window":z=[window];break;case "_document":z=
[window.document];break;case "_html":z=[window.document.documentElement];break;case "_overlay":z=[this.overlay.getElem()];break;default:z=">"===k.substr(0,1)?L(k.substr(1),this.node):L(k)}if(z&&z.length)if(w(y)&&(y=[y]),I(y))for(t=0,x=y.length;t<x;t++)for(B=-1,C=z.length;++B<C;h(z[B],y[t],this[f+"Delegate"]));else for(q in y)for(B=-1,C=z.length;++B<C;a(z[B],y[q],q,this[f+"Delegate"]));}}else this.bindSelfOnRender=!0}}},onPreventScroll:function(a){aa(a).preventDefault()},onButtonClick:function(a){var b=
aa(a).target;(b=P(b,"metaphorjsTooltip-button-id"))&&this.trigger("button",this,b,a)},onButtonKeyup:function(a){if(13===a.keyCode||32===a.keyCode){var b=P(a.target,"metaphorjsTooltip-button-id");b&&this.trigger("button",this,b,aa(a))}},getEventConfig:function(a,b){var d=this.node;for(var e=a.type,h=a.target,f=null,k;h&&h!==d;){if(k=z(h,"data-"+b+"-"+e)){f=F.parse(k)({});break}h=h.parentNode}d=f;e=this.cfg;!d&&e.events[b]&&(d=e.events[b][a.type]||e.events[b]["*"]);return d},show:function(b,d){var e=
this.cfg,f=null,h=e.show,k=null;b&&(b=aa(b));this.isEnabled()||(k="disabled");!k&&this.visible&&this.hideTimeout&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=V(this.hide,this,null,e.hide.timeout),k="hidetimeout");!k&&this.hideDelay&&(window.clearTimeout(this.hideDelay),this.hideDelay=null,this.visible=!0,k="hidedelay");!k&&this.frozen&&(k="frozen");this.destroyDelay&&(window.clearTimeout(this.destroyDelay),this.destroyDelay=null);e=!1;b&&this.dynamicTarget&&(e=this.changeDynamicTarget(b));
this.visible&&(e?(this.reposition(b),k="reposition"):k=k||"visible");if(!k||e)this.node?e&&this.changeDynamicContent():this.render();k||!1!==this.trigger("before-show",this,b)||(k="beforeshow");var m;b&&(m=this.getEventConfig(b,"show"))&&(m.process?f=m.process(this,b,"show",k):(m.stopPropagation&&b.stopPropagation(),m.preventDefault&&b.preventDefault(),f=m.returnValue));if(k)return f;wa(this.node);this.visible=!0;h.single&&a.hideAll(this);this.toggleTitleAttribute(!1);h.delay&&!d?this.showDelay=V(this.showAfterDelay,
this,[b],h.delay):this.showAfterDelay(b,d);return f},showAfterDelay:function(a,b){var d=this,e=d.cfg;d.showDelay=null;if(d.visible){d.trigger("show-after-delay",d,a);e.hide.remove&&d.appendElem();d.reposition(a);if(e.show.preventScroll){var f=e.show.preventScroll,h;!0===f&&(f="body");f=L(f);var k=-1;for(h=f.length;++k<h;O(f[k],"mousewheel",d.onPreventScrollDelegate)&&O(f[k],"touchmove",d.onPreventScrollDelegate));}d.overlay.show();e.show.animate&&!b?d.animate("show").done(function(){d.showAfterAnimation(a)}):
U(function(){d.showAfterAnimation(a)})}},showAfterAnimation:function(a){var b=this.cfg,d=this.node;this.visible&&(S(d,b.cls.hidden),N(d,b.cls.visible),b.render.keepVisible||(d.style.display=b.show.display||"block"),b.hide.timeout&&(this.hideTimeout=V(this.hide,this,null,b.hide.timeout)),b.show.focus&&V(this.setFocus,this,null,20),this.trigger("show",this,a))},hide:function(a,b,d){var e=null,f=null,h=this.cfg;this.hideTimeout=null;!this.visible&&this.hideDelay&&b&&(window.clearTimeout(this.hideDelay),
this.hideDelay=null,this.visible=!0);this.node&&this.visible&&this.isEnabled()||(f=this.node?this.visible?"disabled":"hidden":"noelem");this.showDelay&&!f&&(h.hide.cancelShowDelay||d?(window.clearTimeout(this.showDelay),this.showDelay=null,this.visible=!1,f="cancel"):f="delay");this.frozen&&!f&&(f="frozen");f||!1!==this.trigger("before-hide",this,a)||(f="beforehide");var k;a&&a.stopPropagation&&(k=this.getEventConfig(a,"hide"))&&(k.process?e=k.process(this,a,"hide",f):(k.stopPropagation&&a.stopPropagation(),
k.preventDefault&&a.preventDefault(),e=k.returnValue));if(f)return e;wa(this.node);this.visible=!1;this.toggleTitleAttribute(!0);this.dynamicTarget&&this.resetDynamicTarget();h.hide.delay&&!b?this.hideDelay=V(this.hideAfterDelay,this,[a],h.hide.delay):this.hideAfterDelay(a,b);return e},hideAfterDelay:function(a,b){var d=this,e=d.cfg;d.hideDelay=null;if(!d.visible){d.trigger("hide-after-delay",d,a);if(e.show.preventScroll){var f=e.show.preventScroll,h;!0===f&&(f="body");f=L(f);var k=-1;for(h=f.length;++k<
h;da(f[k],"mousewheel",d.onPreventScrollDelegate)&&da(f[k],"touchmove",d.onPreventScrollDelegate));}d.overlay.hide();e.hide.animate&&!b?d.animate("hide").done(function(){d.hideAfterAnimation(a)}):U(function(){d.hideAfterAnimation(a)})}},hideAfterAnimation:function(a){var b=this,d=b.cfg,e=b.node;b.visible||(S(e,d.cls.visible),N(e,d.cls.hidden),d.render.keepVisible||(e.style.display="none"),b.trigger("hide",b,a),a=d.render.lifetime,null!==a&&(0===a?b.destroyElem():b.destroyDelay=V(b.destroyElem,b,null,
a)),e&&d.hide.destroy?U(function(){P(e,d.instanceName,null);b.$destroy()}):e&&d.hide.remove&&U(function(){b.removeElem()}))},render:function(){var a=this.cfg;if(!this.node){var b=a.render,d=a.cls;if(b.fn){var e=b.fn.call(this.$$callbackContext,this);b[w(e)?"tpl":"el"]=e}b.el?w(b.el)?(e=L(b.el).shift(),b.keepInDOM=!0):e=b.el:(e=window.document.createElement("div"),e.innerHTML=b.tpl,e=e.firstChild);e||(e=window.document.createElement("div"));this.node=e;b.id&&M(e,"id",b.id);a.render.keepVisible||(e.style.display=
"none");N(e,d.dialog);N(e,d.hidden);b.style&&qa(e,b.style);this.overlay.render();a.hide.remove?e.parentNode&&e.parentNode.removeChild(e):this.appendElem();b.zIndex&&qa(e,{zIndex:b.zIndex});b=a.content;if(!1!==b.value)if(b.value)this.setContent(b.value);else if(b.fn)this.setContent(b.fn.call(this.$$callbackContext,this));else this[a.ajax.url?"loadContent":"readContent"]();this.pointer.render();this.pointer.append();if(a.buttons)for(var f in a.buttons)if(b=L(a.buttons[f],e).shift())P(b,"metaphorjsTooltip-button-id",
f),O(b,"click",this.onButtonClickDelegate),O(b,"keyup",this.onButtonKeyupDelegate);this.bindSelfOnRender&&(this.setHandlers("bind","_self"),this.bindSelfOnRender=!1);this.rendered=!0;this.trigger("render",this)}},setPositionType:function(a){var b=this.getPositionClass(a);this.cfg.position.type=a;this.positionClass===b&&this.position?this.position.type=a:(this.position&&(this.position.$destroy(),this.position=null),b&&(this.position=C.factory(b,this)));this.isVisible()&&this.reposition()},getPosition:function(a){var b=
this.cfg.position;if(!this.position){!this.positionGetType&&"custom"!==b.type&&B(b.get)&&"m"!==b.type&&(b.type="custom");a=this.positionGetType?this.positionGetType.call(this.$$callbackContext,this,a):b.type;var d=this.getPositionClass(a);b.type=a;if(!1===d)return;this.positionClass!==d?this.position=C.factory(d,this):this.position.type=a}return this.position},getPositionClass:function(a){return a?B(a)||"custom"===a?"MetaphorJs.dialog.position.Custom":(a=a.substr(0,1))?"w"===a?"MetaphorJs.dialog.position.Window":
"m"===a?"MetaphorJs.dialog.position.Mouse":"MetaphorJs.dialog.position.Target":!1:!1},reposition:function(a){this.repositioning||(this.repositioning=!0,a&&(a=aa(a)),this.getPosition(a),this.trigger("before-reposition",this,a),this.getPosition(a),this.trigger("reposition",this,a),this.repositioning=!1)},getTarget:function(){return this.dynamicTarget?this.dynamicTargetEl:this.target},setTarget:function(a){if(a){var b=!1,d=this.target;this.target?(this.setHandlers("unbind","_target"),b=!0):this.dynamicTarget&&
(b=!0);var e=w(a);e&&"#"!==a.substr(0,1)?(this.dynamicTarget=!0,this.target=null):(e&&(a=L(a).shift()),this.dynamicTarget=!1,this.target=a);b&&(this.setHandlers("bind","_target"),this.trigger("target-change",this,a,d))}},resetDynamicTarget:function(){var a=this.dynamicTargetEl;a&&(this.setHandlers("unbind","_target"),this.trigger("target-change",this,null,a))},isDynamicTargetChanged:function(a){var b=this.cfg.target;a=a.target;for(var d=this.dynamicTargetEl;a&&!pb(a,b);)a=a.parentNode;return a?!d||
d!==a:!1},changeDynamicTarget:function(a){var b=this.cfg.target;a=a.target;for(var d=this.dynamicTargetEl;a&&!pb(a,b);)a=a.parentNode;if(!a||d&&d===a)return!1;d&&this.setHandlers("unbind","_target");this.dynamicTargetEl=a;this.setHandlers("bind","_target");this.trigger("target-change",this,a,d);return!0},getContentElem:function(){var a=this.node;return a?this.cfg.selector.content?L(this.cfg.selector.content,a).shift()||a:a:null},setContent:function(a,b){b=b||"";var d=this.node,e=this.cfg,f=this.pointer;
if(!d)return e.content.value=a,this;e.content.prepare&&(a=e.content.prepare.call(this.$$callbackContext,this,b,a));var h=this.getContentElem(),k=this.rendered&&!e.selector.content&&f;f=k&&f.getElem();if(k&&f)try{d.removeChild(f)}catch(t){T(t)}if(w(a))h.innerHTML=a;else for(var m in a){var n=e.selector[m];n&&(n=L(n,h).shift())&&(n.innerHTML=a[m])}if(k&&f)try{d.appendChild(f)}catch(t){T(t)}d=L("img",h);this.images=d.length;m=-1;for(e=d.length;++m<e;O(d[m],"load",this.onImageLoadDelegate));this.trigger("content-change",
this,a,b);this.onContentChange()},readContent:function(){var a=this.cfg,b=this.getTarget(),d;b&&(d=a.content.attr?z(b,a.content.attr):z(b,"tooltip")||z(b,"title")||z(b,"alt"));d&&this.setContent(d,"attribute")},loadContent:function(a){var b=this.cfg;N(this.node,b.cls.loading);a=q({},b.ajax,a,!0,!0);this.trigger("before-ajax",this,a);return Ha(a).done(this.onAjaxLoad,this)},onAjaxLoad:function(a){S(this.node,this.cfg.cls.loading);this.setContent(a,"ajax")},onImageLoad:function(){this.images--;this.onContentChange()},
onContentChange:function(){this.visible&&this.reposition()},changeDynamicContent:function(){var a=this.cfg;a.content.fn?this.setContent(a.content.fn.call(this.$$callbackContext,this)):a.content.attr&&this.readContent()},toggleTitleAttribute:function(a){var b=this.getTarget(),d;b&&(!1===a?(P(b,"tmp-title",z(b,"title")),ka(b,"title")):(d=P(b,"tmp-title"))&&M(b,"title",d))},getDialogSize:function(){this.rendered||this.render();var a=this.cfg,b=this.node,d=a.cls.hidden?Va(b,a.cls.hidden):!oc(b),e=b.style.left;
d&&(qa(b,{left:"-1000px"}),b.style.display=a.show.display);a={width:Za(b),height:$a(b)};d&&(qa(b,{left:e}),b.style.display="none");return a},getTargetSize:function(){var a=this.getTarget();return a?{width:Za(a),height:$a(a)}:null},setFocus:function(){var a=this.cfg,b=a.show.focus,d=this.node,e;if(!0===b)if(b=L("input",d).concat(L("textarea",d)),0<b.length)b[0].focus();else{if(a.buttons)for(e in a.buttons){(a=L(a.buttons[e],d).shift())&&a.focus();break}}else(a=L(b,d).shift())&&a.focus()},getScrollEl:function(a){return!0===
a||!1===a?window:"string"===typeof a?L(a).shift():a},animate:function(a,b){var d=this.cfg,e=this.node;var f=d[a].animate;B(f)&&(f=f(this,b));var h=f.skipDisplayChange||!1;sa(f)?f=a:w(f)&&(f=[f]);return fa(e,f,function(){if("show"===a&&!h)return new G(function(a,b){U(function(){e.style.display=d.show.display||"block";a()})})},!1)},removeElem:function(){var a=this,b=a.node;a.overlay.remove();b&&b.parentNode&&U(function(){a.visible||b.parentNode.removeChild(b)})},appendElem:function(){var a=this.cfg,
b=window.document.body;b=a.render.appendTo||b;this.overlay.append();this.node&&!1!==a.render.appendTo&&b.appendChild(this.node)},destroyElem:function(){var a=this.node;this.setHandlers("unbind","_self");this.bindSelfOnRender=!0;this.pointer.remove();this.overlay.remove();a&&(this.cfg.render.keepInDOM||a.parentNode&&a.parentNode.removeChild(a),this.node=null);this.trigger("lifetime",this)},onDestroy:function(){this.setHandlers("unbind");this.trigger("destroy",this);this.destroyElem();this.overlay&&
this.overlay.$destroy();this.pointer&&this.pointer.$destroy();this.position&&this.position.$destroy()}},{defaults:null});return k}(),vc=n.dialog.Component=nc.$extend({dialog:null,dialogPreset:null,dialogCfg:null,dialogNode:null,hidden:!0,target:null,isTooltip:!1,$init:function(a){this.isTooltip&&(this.target=a.node,a.node=null);this.$super(a)},initComponent:function(){this.$super();this._createDialog()},_getDialogCfg:function(){return q({},this.dialogCfg,{preset:this.dialogPreset,render:{el:this.dialogNode||
this.node,keepInDOM:!0}},!0,!0)},_createDialog:function(){this.dialog=new uc(this._getDialogCfg());this.dialog.on("show",this.onDialogShow,this);this.dialog.on("hide",this.onDialogHide,this);this.dialog.on("before-show",this.onBeforeDialogShow,this);this.dialog.on("before-hide",this.onBeforeDialogHide,this);this.dialog.on("destroy",this.onDialogDestroy,this)},getDialog:function(){return this.dialog},onRenderingFinished:function(){this.rendered=!0;this.afterRender();this.trigger("after-render",this)},
show:function(a){!a||a instanceof gb||(a=null);this.dialog.show(a)},hide:function(a){!a||a instanceof gb||(a=null);this.dialog.hide(a)},onBeforeDialogShow:function(){this.rendered||this.render();this.template.setAnimation(!0);this.hidden=!1},onDialogShow:function(){this.onShow();this.trigger("show",this)},onBeforeDialogHide:function(){},onDialogHide:function(){this.$destroyed||(this.template.setAnimation(!1),this.hidden=!0,this.onHide(),this.trigger("hide",this))},onDialogDestroy:function(){this.$destroying||
(this.dialog=null,this.$destroy())},onDestroy:function(){this.dialog&&this.dialog.$destroy();this.$super()}});na.register("Test",{});C({$class:"Test.MyApp2",$extends:"MetaphorJs.app.App",initApp:function(a,b,d){var e=this,f=0,k=["(level 3 value: {{.b}})","(level 3 value: {{.c}})"];e.scope.resolved=d;e.scope.level1="[ and here comes level 2: {{.level2}} ]";e.scope.level2=k[f];e.scope.b=1;e.scope.c="variable c";e.scope.changeLevel2=function(a){f=0==f?1:0;e.scope.level2=k[f]};e.scope.increaseB=function(){e.scope.b++};
e.scope.people=0;e.lang.setLocale("ru");e.lang.set("key","text value");e.lang.set("plr",["\u043a\u043e\u0442\u0438\u043a","\u043a\u043e\u0442\u0438\u043a\u0430","\u043a\u043e\u0442\u0438\u043a\u043e\u0432"]);e.lang.set("subkey1","subkey: {{'subkey2' | l}}");e.lang.set("subkey2","text value");e.lang.set("viewing",{0:"Nobody is viewing",1:"One person is viewing",2:"Two people are viewing",other:"{{.people}} people are viewing",negative:""})}},{inject:["$node","$scope","someValue"],resolve:{someValue:function(){var a=
new G;setTimeout(function(){a.resolve((new Date).getTime())},100);return a}}});C({$class:"Test.MyView",$extends:"MetaphorJs.app.Router",route:[{template:"test-template","default":!0},{regexp:/^\/1$/,cmp:"Test.MyComponent"},{regexp:/^\/2\/(\d+)$/,params:["param"],cmp:"Test.MyComponent2"},{regexp:/^\/2$/,cmp:"Test.MyComponent2"},{regexp:/^\/3$/,template:"a+b"}]});C({$class:"Test.MyRecord",$extends:"MetaphorJs.model.Record"});C({$class:"Test.MyComponent",$extends:"MetaphorJs.app.Component",initComponent:function(){this.scope.title=
"My Component"+(new Date).getTime();var a=new oa({type:"Test.MyRecord",id:"id",root:"record",total:"total",store:{load:"data.json"}});this.scope.store=new Ib({model:a});this.scope.deferred=this.deferred},afterRender:function(){this.para&&window.console&&window.console.log&&console.log("got child property 'para': ",this.para)},reverse:function(){this.scope.title=this.scope.title.split("").reverse().join("")},createNew:function(){var a=document.getElementById("newComponent");xa("Test.DynamicComponent",
{},this.scope,a)},createRender:function(){var a=document.getElementById("renderToComponent");xa("Test.DynamicComponent",{renderTo:a},this.scope)},createDialog:function(){(new vc({dialogCfg:{cls:{dialog:"dialog"},position:"wc",show:{animate:!0},hide:{destroy:!0}},config:{as:"dlg"},scope:this.scope,template:'<p>This is a dialog. <a href="#" (click)="this.dlg.hide()">close</a></p>'})).show()},loadStore:function(){this.scope.store.load().done(function(){this.scope.$check()},this).fail(function(a){console.log("failed",
a)})}},{template:"cmp1-template",resolve:{deferred:["$node","$scope","test",function(a,b,d){return new G(function(a,b){setTimeout(function(){a((new Date).getTime())},1E3)})}]}});C({$class:"Test.MyComponent2",$extends:"MetaphorJs.app.Component",template:"cmp1-template",initComponent:function(a,b){a.param&&alert("received param: "+a.param);this.scope.title="My Component2 "+(new Date).getTime()}});C({$class:"Test.TplComponent",$extends:"MetaphorJs.app.Component",initComponent:function(){this.scope.title=
"Tpl Component";this.scope.tpl="a+b";this.scope.$app.onAvailable("myComponent1").done(function(a){window.console&&window.console.log&&console.log("on available myComponent1")})}});C({$class:"Test.StringTemplate",$extends:"MetaphorJs.app.Component"},{template:"<p>This template is inlined in components definition ({{this.$root.a}})</p>"});C({$class:"Test.DynamicComponent",$extends:"MetaphorJs.app.Component"},{template:"<p>This component was created dynamically</p><div {transclude}></div>"});C({$class:"Test.ChangeTemplate",
$extends:"MetaphorJs.app.Component",template:"this.tpl",initComponent:function(){var a=this.scope;a.tpl1="<p>Template 1</p><div {transclude}></div>";a.tpl2="<p>Template 2</p><div {transclude}></div>";a.tpl=a.tpl1}});C({$class:"Test.ViewComponent1",$extends:"MetaphorJs.app.Component",template:"<p>View template 1</p><div {transclude}></div>"});C({$class:"Test.ViewComponent2",$extends:"MetaphorJs.app.Component",template:"<p>View template 2</p><div {transclude}></div>"});C({$class:"Test.TagComponent",
$extends:"MetaphorJs.app.Component",$alias:"MetaphorJs.directive.component.tagc",template:"tagc"});Kb(function(){var a={linkified:"Linkified text aaa http://www.kuindji.com bbb",newItem:"",date:new Date,num:1E4,list:[{bool:!0,txt:"item 1"},{bool:!1,txt:"item 2"},{bool:!1,txt:"item 3"}]},b=(new Date).getTime(),d=document.getElementById("render");d&&(Jb(d,null,a,!1).done(function(a){a.value("test","123");a.run();window.mainApp=a;window.MetaphorJs=n}),a=(new Date).getTime(),window.console&&console.log("render time: ",
a-b))})})();
